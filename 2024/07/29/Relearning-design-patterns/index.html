

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=auto>



<head>
  <meta name="google-site-verification" content="7TXW9ttER52MwKw3U6lTa3NKEZw2koxmAO7iJcMTT8c" />
  <meta name="baidu-site-verification" content="codeva-1kmvb8u2lB" />
  <meta charset="UTF-8">
  <!-- 通过 CDN 引入霞鹜文楷字体 -->
  <link rel="stylesheet" href="https://npm.elemecdn.com/lxgw-wenkai-screen-webfont/style.css" media="print" onload="this.media='all'">
  <link rel="apple-touch-icon" sizes="76x76" href="https://kolin-blog.oss-cn-shanghai.aliyuncs.com/blog/202309302055622.jpg">
  <link rel="icon" href="https://kolin-blog.oss-cn-shanghai.aliyuncs.com/blog/202309302055622.jpg">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Kolin">
  <meta name="keywords" content="">
  
    <meta name="description" content="重学设计模式，案例+源码实践">
<meta property="og:type" content="article">
<meta property="og:title" content="Relearning Design Pattern">
<meta property="og:url" content="https://www.renkelin.vip/2024/07/29/Relearning-design-patterns/index.html">
<meta property="og:site_name" content="Kolin&#39;s space">
<meta property="og:description" content="重学设计模式，案例+源码实践">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2024-07-28T15:00:00.000Z">
<meta property="article:modified_time" content="2024-07-29T08:14:30.234Z">
<meta property="article:author" content="Kolin">
<meta property="article:tag" content="Design Pattern">
<meta name="twitter:card" content="summary_large_image">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>Relearning Design Pattern - Kolin&#39;s space</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"www.renkelin.vip","root":"/","version":"1.9.5-a","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Kolin's space" type="application/atom+xml">
</head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Kolin&#39;s space</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>Home</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>Archives</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>Categories</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>Tags</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>About</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                <span>Links</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('https://kolin-blog.oss-cn-shanghai.aliyuncs.com/blog/202309302057061.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Relearning Design Pattern"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-07-29 00:00" pubdate>
          July 29, 2024 am
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          148k words
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          1233 mins
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">Relearning Design Pattern</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="重学设计模式"><a href="#重学设计模式" class="headerlink" title="重学设计模式"></a>重学设计模式</h1><h2 id="单一职责原则"><a href="#单一职责原则" class="headerlink" title="单一职责原则"></a>单一职责原则</h2><blockquote>
<p>又称单一功能原则，面向对象五个基本原则之一</p>
</blockquote>
<ul>
<li>原则定义：一个类应该只有一个发生变化的原因</li>
<li>模拟场景：访客用户，普通用户，VIP用户</li>
<li>编码实现：if-else，判断实现，不易维护</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 视频用户服务</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VideoUserService</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serveGrade</span><span class="hljs-params">(String userType)</span>&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;VIP用户&quot;</span>.equals(userType))&#123;<br>            System.out.println(<span class="hljs-string">&quot;VIP用户，视频1080P蓝光&quot;</span>);<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;普通用户&quot;</span>.equals(userType))&#123;<br>            System.out.println(<span class="hljs-string">&quot;普通用户，视频720P超清&quot;</span>);<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;访客用户&quot;</span>.equals(userType))&#123;<br>            System.out.println(<span class="hljs-string">&quot;访客用户，视频480P高清&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 测试验证</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApiTest</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">VideoUserService</span> <span class="hljs-variable">service</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">VideoUserService</span>();<br>        service.serveGrade(<span class="hljs-string">&quot;VIP用户&quot;</span>);<br>        service.serveGrade(<span class="hljs-string">&quot;普通用户&quot;</span>);<br>        service.serveGrade(<span class="hljs-string">&quot;访客用户&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<p><strong>代码重构</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 视频用户服务接口</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">IVideoUserService</span> &#123;<br><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">definition</span><span class="hljs-params">()</span>;<br><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">advertisement</span><span class="hljs-params">()</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>



<p><strong>impl包下拆分成三个互不影响的类</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 访客用户</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GuestVideoUserService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IVideoUserService</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">definition</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;访客用户，视频480P高清&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">advertisement</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;访客用户，视频有广告&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 普通用户</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrdinaryVideoUserService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IVideoUserService</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">definition</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;普通用户，视频720P超清&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">advertisement</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;普通用户，视频有广告&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * VIP 用户</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VipVideoUserService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IVideoUserService</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">definition</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;VIP用户，视频1080P蓝光&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">advertisement</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;VIP会员，视频无广告&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 测试验证</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApiTest</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">// 访客用户</span><br>        <span class="hljs-type">IVideoUserService</span> <span class="hljs-variable">guest</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GuestVideoUserService</span>();<br>        guest.advertisement();<br>        guest.definition();<br>        <span class="hljs-comment">// 普通用户</span><br>        <span class="hljs-type">IVideoUserService</span> <span class="hljs-variable">ordinary</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrdinaryVideoUserService</span>();<br>        ordinary.advertisement();<br>        ordinary.definition();<br>        <span class="hljs-comment">// VIP用户</span><br>        <span class="hljs-type">IVideoUserService</span> <span class="hljs-variable">vip</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">VipVideoUserService</span>();<br>        vip.advertisement();<br>        vip.definition();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="开闭原则"><a href="#开闭原则" class="headerlink" title="开闭原则"></a>开闭原则</h2><blockquote>
<p>软件中的对象（类，模块，函数等）应该对于扩展时开放的，但是对于修改是封闭的</p>
</blockquote>
<ul>
<li>开闭原则：扩展开放，修改封闭</li>
<li>面积计算：长方形，三角形，圆形</li>
<li>编码实现：破坏方法，继承扩展</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 面积计算接口</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ICalculationArea</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 计算面积，长方形</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> x 长</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> y 宽</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 面积</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-type">double</span> <span class="hljs-title function_">rectangle</span><span class="hljs-params">(<span class="hljs-type">double</span> x, <span class="hljs-type">double</span> y)</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 计算面积，三角形</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> x 边长x</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> y 边长y</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> z 边长z</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span>  面积</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * 海伦公式：S=√[p(p-a)(p-b)(p-c)] 其中：p=(a+b+c)/2</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-type">double</span> <span class="hljs-title function_">triangle</span><span class="hljs-params">(<span class="hljs-type">double</span> x, <span class="hljs-type">double</span> y, <span class="hljs-type">double</span> z)</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 计算面积，圆形</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> r 半径</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 面积</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * 圆面积公式：S=πr²</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-type">double</span> <span class="hljs-title function_">circular</span><span class="hljs-params">(<span class="hljs-type">double</span> r)</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 面积计算实现</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CalculationArea</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ICalculationArea</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> <span class="hljs-type">double</span> π = <span class="hljs-number">3.14D</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">double</span> <span class="hljs-title function_">rectangle</span><span class="hljs-params">(<span class="hljs-type">double</span> x, <span class="hljs-type">double</span> y)</span> &#123;<br>        <span class="hljs-keyword">return</span> x * y;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">double</span> <span class="hljs-title function_">triangle</span><span class="hljs-params">(<span class="hljs-type">double</span> x, <span class="hljs-type">double</span> y, <span class="hljs-type">double</span> z)</span> &#123;<br>        <span class="hljs-type">double</span> <span class="hljs-variable">p</span> <span class="hljs-operator">=</span> (x + y + z) / <span class="hljs-number">2</span>;<br>        <span class="hljs-keyword">return</span> Math.sqrt(p * (p - x) * (p - y) * (p - z));<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">double</span> <span class="hljs-title function_">circular</span><span class="hljs-params">(<span class="hljs-type">double</span> r)</span> &#123;<br>        <span class="hljs-keyword">return</span> π * r * r;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<p><strong>开闭原则扩展功能</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 扩展继承，实现自己的需求</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CalculationAreaExt</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">CalculationArea</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> <span class="hljs-type">double</span> π = <span class="hljs-number">3.141592653D</span>;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">double</span> <span class="hljs-title function_">circular</span><span class="hljs-params">(<span class="hljs-type">double</span> r)</span> &#123;<br>        <span class="hljs-keyword">return</span> π * r * r;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 功能测试</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApiTest</span> &#123;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test_CalculationAreaExt</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-type">ICalculationArea</span> <span class="hljs-variable">area</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CalculationAreaExt</span>();<br>        <span class="hljs-type">double</span> <span class="hljs-variable">circular</span> <span class="hljs-operator">=</span> area.circular(<span class="hljs-number">10</span>);<br>        System.out.println(circular);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="里氏替换原则"><a href="#里氏替换原则" class="headerlink" title="里氏替换原则"></a>里氏替换原则</h2><blockquote>
<p>继承必须确保超类所拥有的性质在子类中依然成立</p>
</blockquote>
<ul>
<li>里氏替换原则：兼容性，维护性，扩展性</li>
<li>银行卡：信用卡，储蓄卡，地铁卡</li>
<li>编码实现：银行卡类，正向，逆向</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 模拟储蓄卡功能</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CashCard</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(CashCard.class);<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 提现</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> orderId 单号</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> amount  金额</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 状态码 0000成功、0001失败、0002重复</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">withdrawal</span><span class="hljs-params">(String orderId, BigDecimal amount)</span> &#123;<br>        <span class="hljs-comment">// 模拟支付成功</span><br>        logger.info(<span class="hljs-string">&quot;提现成功，单号：&#123;&#125; 金额：&#123;&#125;&quot;</span>, orderId, amount);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;0000&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 储蓄</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> orderId 单号</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> amount  金额</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">recharge</span><span class="hljs-params">(String orderId, BigDecimal amount)</span> &#123;<br>        <span class="hljs-comment">// 模拟充值成功</span><br>        logger.info(<span class="hljs-string">&quot;储蓄成功，单号：&#123;&#125; 金额：&#123;&#125;&quot;</span>, orderId, amount);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;0000&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 交易流水查询</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 交易流水</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title function_">tradeFlow</span><span class="hljs-params">()</span> &#123;<br>        logger.info(<span class="hljs-string">&quot;交易流水查询成功&quot;</span>);<br>        List&lt;String&gt; tradeList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;String&gt;();<br>        tradeList.add(<span class="hljs-string">&quot;100001,100.00&quot;</span>);<br>        tradeList.add(<span class="hljs-string">&quot;100001,80.00&quot;</span>);<br>        tradeList.add(<span class="hljs-string">&quot;100001,76.50&quot;</span>);<br>        tradeList.add(<span class="hljs-string">&quot;100001,126.00&quot;</span>);<br>        <span class="hljs-keyword">return</span> tradeList;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 模拟信用卡功能</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CreditCard</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">CashCard</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(CashCard.class);<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">withdrawal</span><span class="hljs-params">(String orderId, BigDecimal amount)</span> &#123;<br>        <span class="hljs-comment">// 校验</span><br>        <span class="hljs-keyword">if</span> (amount.compareTo(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-number">1000</span>)) &gt;= <span class="hljs-number">0</span>)&#123;<br>            logger.info(<span class="hljs-string">&quot;贷款金额校验(限额1000元)，单号：&#123;&#125; 金额：&#123;&#125;&quot;</span>, orderId, amount);<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;0001&quot;</span>;<br>        &#125;<br>        <span class="hljs-comment">// 模拟生成贷款单</span><br>        logger.info(<span class="hljs-string">&quot;生成贷款单，单号：&#123;&#125; 金额：&#123;&#125;&quot;</span>, orderId, amount);<br>        <span class="hljs-comment">// 模拟支付成功</span><br>        logger.info(<span class="hljs-string">&quot;贷款成功，单号：&#123;&#125; 金额：&#123;&#125;&quot;</span>, orderId, amount);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;0000&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">recharge</span><span class="hljs-params">(String orderId, BigDecimal amount)</span> &#123;<br>        <span class="hljs-comment">// 模拟生成还款单</span><br>        logger.info(<span class="hljs-string">&quot;生成还款单，单号：&#123;&#125; 金额：&#123;&#125;&quot;</span>, orderId, amount);<br>        <span class="hljs-comment">// 模拟还款成功</span><br>        logger.info(<span class="hljs-string">&quot;还款成功，单号：&#123;&#125; 金额：&#123;&#125;&quot;</span>, orderId, amount);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;0000&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title function_">tradeFlow</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.tradeFlow();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 测试验证</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApiTest</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(ApiTest.class);<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test_CashCard</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">CashCard</span> <span class="hljs-variable">cashCard</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CashCard</span>();<br>        <span class="hljs-comment">// 提现</span><br>        cashCard.withdrawal(<span class="hljs-string">&quot;100001&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-number">100</span>));<br>        <span class="hljs-comment">// 储蓄</span><br>        cashCard.recharge(<span class="hljs-string">&quot;100001&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-number">100</span>));<br>        <span class="hljs-comment">// 交易流水</span><br>        List&lt;String&gt; tradeFlow = cashCard.tradeFlow();<br>        logger.info(<span class="hljs-string">&quot;查询交易流水，&#123;&#125;&quot;</span>, JSON.toJSONString(tradeFlow));<br>    &#125;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test_CreditCard</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">CreditCard</span> <span class="hljs-variable">creditCard</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CreditCard</span>();<br>        <span class="hljs-comment">// 支付</span><br>        creditCard.withdrawal(<span class="hljs-string">&quot;100001&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-number">100</span>));<br>        <span class="hljs-comment">// 还款</span><br>        creditCard.recharge(<span class="hljs-string">&quot;100001&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-number">100</span>));<br>        <span class="hljs-comment">// 交易流水</span><br>        List&lt;String&gt; tradeFlow = creditCard.tradeFlow();<br>        logger.info(<span class="hljs-string">&quot;查询交易流水，&#123;&#125;&quot;</span>, JSON.toJSONString(tradeFlow));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<p><strong>抽象提取相同功能</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 银行卡</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BankCard</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(BankCard.class);<br><br>    <span class="hljs-keyword">private</span> String cardNo;   <span class="hljs-comment">// 卡号</span><br>    <span class="hljs-keyword">private</span> String cardDate; <span class="hljs-comment">// 开卡时间</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">BankCard</span><span class="hljs-params">(String cardNo, String cardDate)</span> &#123;<br>        <span class="hljs-built_in">this</span>.cardNo = cardNo;<br>        <span class="hljs-built_in">this</span>.cardDate = cardDate;<br>    &#125;<br><br>    <span class="hljs-keyword">abstract</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">rule</span><span class="hljs-params">(BigDecimal amount)</span>;<br><br>    <span class="hljs-comment">// 正向入账，+ 钱</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">positive</span><span class="hljs-params">(String orderId, BigDecimal amount)</span> &#123;<br>        <span class="hljs-comment">// 入款成功，存款、还款</span><br>        logger.info(<span class="hljs-string">&quot;卡号&#123;&#125; 入款成功，单号：&#123;&#125; 金额：&#123;&#125;&quot;</span>, cardNo, orderId, amount);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;0000&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// 逆向入账，- 钱</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">negative</span><span class="hljs-params">(String orderId, BigDecimal amount)</span> &#123;<br>        <span class="hljs-comment">// 入款成功，存款、还款</span><br>        logger.info(<span class="hljs-string">&quot;卡号&#123;&#125; 出款成功，单号：&#123;&#125; 金额：&#123;&#125;&quot;</span>, cardNo, orderId, amount);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;0000&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 交易流水查询</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 交易流水</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title function_">tradeFlow</span><span class="hljs-params">()</span> &#123;<br>        logger.info(<span class="hljs-string">&quot;交易流水查询成功&quot;</span>);<br>        List&lt;String&gt; tradeList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;String&gt;();<br>        tradeList.add(<span class="hljs-string">&quot;100001,100.00&quot;</span>);<br>        tradeList.add(<span class="hljs-string">&quot;100001,80.00&quot;</span>);<br>        tradeList.add(<span class="hljs-string">&quot;100001,76.50&quot;</span>);<br>        tradeList.add(<span class="hljs-string">&quot;100001,126.00&quot;</span>);<br>        <span class="hljs-keyword">return</span> tradeList;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getCardNo</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> cardNo;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getCardDate</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> cardDate;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 模拟储蓄卡功能</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CashCard</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BankCard</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(CashCard.class);<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">CashCard</span><span class="hljs-params">(String cardNo, String cardDate)</span> &#123;<br>        <span class="hljs-built_in">super</span>(cardNo, cardDate);<br>    &#125;<br><br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">rule</span><span class="hljs-params">(BigDecimal amount)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 提现</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> orderId 单号</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> amount  金额</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 状态码 0000成功、0001失败、0002重复</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">withdrawal</span><span class="hljs-params">(String orderId, BigDecimal amount)</span> &#123;<br>        <span class="hljs-comment">// 模拟支付成功</span><br>        logger.info(<span class="hljs-string">&quot;提现成功，单号：&#123;&#125; 金额：&#123;&#125;&quot;</span>, orderId, amount);<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.negative(orderId, amount);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 储蓄</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> orderId 单号</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> amount  金额</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">recharge</span><span class="hljs-params">(String orderId, BigDecimal amount)</span> &#123;<br>        <span class="hljs-comment">// 模拟充值成功</span><br>        logger.info(<span class="hljs-string">&quot;储蓄成功，单号：&#123;&#125; 金额：&#123;&#125;&quot;</span>, orderId, amount);<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.positive(orderId, amount);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 风险校验</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> cardNo  卡号</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> orderId 单号</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> amount  金额</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 状态</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">checkRisk</span><span class="hljs-params">(String cardNo, String orderId, BigDecimal amount)</span> &#123;<br>        <span class="hljs-comment">// 模拟风控校验</span><br>        logger.info(<span class="hljs-string">&quot;风控校验，卡号：&#123;&#125; 单号：&#123;&#125; 金额：&#123;&#125;&quot;</span>, cardNo, orderId, amount);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 信用卡</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CreditCard</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">CashCard</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(CreditCard.class);<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">CreditCard</span><span class="hljs-params">(String cardNo, String cardDate)</span> &#123;<br>        <span class="hljs-built_in">super</span>(cardNo, cardDate);<br>    &#125;<br><br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">rule2</span><span class="hljs-params">(BigDecimal amount)</span> &#123;<br>        <span class="hljs-keyword">return</span> amount.compareTo(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-number">1000</span>)) &lt;= <span class="hljs-number">0</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 提现，信用卡贷款</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> orderId 单号</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> amount  金额</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 状态码</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">loan</span><span class="hljs-params">(String orderId, BigDecimal amount)</span> &#123;<br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">rule</span> <span class="hljs-operator">=</span> rule2(amount);<br>        <span class="hljs-keyword">if</span> (!rule) &#123;<br>            logger.info(<span class="hljs-string">&quot;生成贷款单失败，金额超限。单号：&#123;&#125; 金额：&#123;&#125;&quot;</span>, orderId, amount);<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;0001&quot;</span>;<br>        &#125;<br>        <span class="hljs-comment">// 模拟生成贷款单</span><br>        logger.info(<span class="hljs-string">&quot;生成贷款单，单号：&#123;&#125; 金额：&#123;&#125;&quot;</span>, orderId, amount);<br>        <span class="hljs-comment">// 模拟支付成功</span><br>        logger.info(<span class="hljs-string">&quot;贷款成功，单号：&#123;&#125; 金额：&#123;&#125;&quot;</span>, orderId, amount);<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.negative(orderId, amount);<br><br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 还款，信用卡还款</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> orderId 单号</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> amount  金额</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 状态码</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">repayment</span><span class="hljs-params">(String orderId, BigDecimal amount)</span> &#123;<br>        <span class="hljs-comment">// 模拟生成还款单</span><br>        logger.info(<span class="hljs-string">&quot;生成还款单，单号：&#123;&#125; 金额：&#123;&#125;&quot;</span>, orderId, amount);<br>        <span class="hljs-comment">// 模拟还款成功</span><br>        logger.info(<span class="hljs-string">&quot;还款成功，单号：&#123;&#125; 金额：&#123;&#125;&quot;</span>, orderId, amount);<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.positive(orderId, amount);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 测试</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApiTest</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(ApiTest.class);<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test_bankCard</span><span class="hljs-params">()</span> &#123;<br>        logger.info(<span class="hljs-string">&quot;里氏替换前，CashCard类：&quot;</span>);<br>        <span class="hljs-type">CashCard</span> <span class="hljs-variable">bankCard</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CashCard</span>(<span class="hljs-string">&quot;6214567800989876&quot;</span>, <span class="hljs-string">&quot;2022-03-05&quot;</span>);<br>        <span class="hljs-comment">// 提现</span><br>        bankCard.withdrawal(<span class="hljs-string">&quot;100001&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-number">100</span>));<br>        <span class="hljs-comment">// 储蓄</span><br>        bankCard.recharge(<span class="hljs-string">&quot;100001&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-number">100</span>));<br><br>        logger.info(<span class="hljs-string">&quot;里氏替换后，CreditCard类：&quot;</span>);<br>        <span class="hljs-type">CashCard</span> <span class="hljs-variable">creditCard</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CreditCard</span>(<span class="hljs-string">&quot;6214567800989876&quot;</span>, <span class="hljs-string">&quot;2022-03-05&quot;</span>);<br>        <span class="hljs-comment">// 提现</span><br>        creditCard.withdrawal(<span class="hljs-string">&quot;100001&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-number">1000000</span>));<br>        <span class="hljs-comment">// 储蓄</span><br>        creditCard.recharge(<span class="hljs-string">&quot;100001&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-number">100</span>));<br>    &#125;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test_CreditCard</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-type">CreditCard</span> <span class="hljs-variable">creditCard</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CreditCard</span>(<span class="hljs-string">&quot;6214567800989876&quot;</span>, <span class="hljs-string">&quot;2022-03-05&quot;</span>);<br>        <span class="hljs-comment">// 支付，贷款</span><br>        creditCard.loan(<span class="hljs-string">&quot;100001&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-number">100</span>));<br>        <span class="hljs-comment">// 还款</span><br>        creditCard.repayment(<span class="hljs-string">&quot;100001&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-number">100</span>));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="迪米特法则"><a href="#迪米特法则" class="headerlink" title="迪米特法则"></a>迪米特法则</h2><blockquote>
<p>意义在于降低类之间的耦合。由于每个对象尽量减少对其他对象的了解，因此，很容易使得系统的功能模块功能独立，相互之间不存在（或很少有）依赖关系</p>
</blockquote>
<ul>
<li>迪米特法则：最少知道，减少依赖</li>
<li>学生成绩&amp;排名：校长，教师，学生，成绩，排名</li>
<li>编码实现：高内聚，低耦合</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 校长</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Principal</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Teacher</span> <span class="hljs-variable">teacher</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Teacher</span>(<span class="hljs-string">&quot;丽华&quot;</span>, <span class="hljs-string">&quot;3年1班&quot;</span>);<br><br>    <span class="hljs-comment">// 查询班级信息，总分数、学生人数、平均值</span><br>    <span class="hljs-keyword">public</span> Map&lt;String, Object&gt; <span class="hljs-title function_">queryClazzInfo</span><span class="hljs-params">(String clazzId)</span> &#123;<br>        <span class="hljs-comment">// 获取班级信息；学生总人数、总分、平均分</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">stuCount</span> <span class="hljs-operator">=</span> clazzStudentCount();<br>        <span class="hljs-type">double</span> <span class="hljs-variable">totalScore</span> <span class="hljs-operator">=</span> clazzTotalScore();<br>        <span class="hljs-type">double</span> <span class="hljs-variable">averageScore</span> <span class="hljs-operator">=</span> clazzAverageScore();<br><br>        <span class="hljs-comment">// 组装对象，实际业务开发会有对应的类</span><br>        Map&lt;String, Object&gt; mapObj = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        mapObj.put(<span class="hljs-string">&quot;班级&quot;</span>, teacher.getClazz());<br>        mapObj.put(<span class="hljs-string">&quot;老师&quot;</span>, teacher.getName());<br>        mapObj.put(<span class="hljs-string">&quot;学生人数&quot;</span>, stuCount);<br>        mapObj.put(<span class="hljs-string">&quot;班级总分数&quot;</span>, totalScore);<br>        mapObj.put(<span class="hljs-string">&quot;班级平均分&quot;</span>, averageScore);<br>        <span class="hljs-keyword">return</span> mapObj;<br>    &#125;<br><br>    <span class="hljs-comment">// 总分</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">double</span> <span class="hljs-title function_">clazzTotalScore</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">double</span> <span class="hljs-variable">totalScore</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span> (Student stu : Teacher.getStudentList()) &#123;<br>            totalScore += stu.getGrade();<br>        &#125;<br>        <span class="hljs-keyword">return</span> totalScore;<br>    &#125;<br><br>    <span class="hljs-comment">// 平均分</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">double</span> <span class="hljs-title function_">clazzAverageScore</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-type">double</span> <span class="hljs-variable">totalScore</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span> (Student stu : Teacher.getStudentList()) &#123;<br>            totalScore += stu.getGrade();<br>        &#125;<br>        <span class="hljs-keyword">return</span> totalScore / Teacher.getStudentList().size();<br>    &#125;<br><br>    <span class="hljs-comment">// 班级人数</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">clazzStudentCount</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> Teacher.getStudentList().size();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 学生</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> &#123;<br><br>    <span class="hljs-keyword">private</span> String name;    <span class="hljs-comment">// 学生姓名</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> rank;       <span class="hljs-comment">// 考试排名(总排名)</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">double</span> grade;   <span class="hljs-comment">// 考试分数(总分)</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> rank, <span class="hljs-type">double</span> grade)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>        <span class="hljs-built_in">this</span>.rank = rank;<br>        <span class="hljs-built_in">this</span>.grade = grade;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getRank</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> rank;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setRank</span><span class="hljs-params">(<span class="hljs-type">int</span> rank)</span> &#123;<br>        <span class="hljs-built_in">this</span>.rank = rank;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">double</span> <span class="hljs-title function_">getGrade</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> grade;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setGrade</span><span class="hljs-params">(<span class="hljs-type">double</span> grade)</span> &#123;<br>        <span class="hljs-built_in">this</span>.grade = grade;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 老师</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Teacher</span> &#123;<br><br>    <span class="hljs-keyword">private</span> String name;                <span class="hljs-comment">// 老师名称</span><br>    <span class="hljs-keyword">private</span> String clazz;               <span class="hljs-comment">// 班级</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> List&lt;Student&gt; studentList;  <span class="hljs-comment">// 学生</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Teacher</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Teacher</span><span class="hljs-params">(String name, String clazz)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>        <span class="hljs-built_in">this</span>.clazz = clazz;<br>    &#125;<br><br>    <span class="hljs-keyword">static</span> &#123;<br>        studentList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        studentList.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>(<span class="hljs-string">&quot;花花&quot;</span>, <span class="hljs-number">10</span>, <span class="hljs-number">589</span>));<br>        studentList.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>(<span class="hljs-string">&quot;豆豆&quot;</span>, <span class="hljs-number">54</span>, <span class="hljs-number">356</span>));<br>        studentList.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>(<span class="hljs-string">&quot;秋雅&quot;</span>, <span class="hljs-number">23</span>, <span class="hljs-number">439</span>));<br>        studentList.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>(<span class="hljs-string">&quot;皮皮&quot;</span>, <span class="hljs-number">2</span>, <span class="hljs-number">665</span>));<br>        studentList.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>(<span class="hljs-string">&quot;蛋蛋&quot;</span>, <span class="hljs-number">19</span>, <span class="hljs-number">502</span>));<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> List&lt;Student&gt; <span class="hljs-title function_">getStudentList</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> studentList;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getClazz</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> clazz;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 测试</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApiTest</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(ApiTest.class);<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test_Principal</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">Principal</span> <span class="hljs-variable">principal</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Principal</span>();<br>        Map&lt;String, Object&gt; map = principal.queryClazzInfo(<span class="hljs-string">&quot;3年1班&quot;</span>);<br>        logger.info(<span class="hljs-string">&quot;查询结果：&#123;&#125;&quot;</span>, JSON.toJSONString(map));<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>



<p><strong>重构，越少人知道越好</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 学生</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> &#123;<br><br>    <span class="hljs-keyword">private</span> String name;    <span class="hljs-comment">// 学生姓名</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> rank;       <span class="hljs-comment">// 考试排名(总排名)</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">double</span> grade;   <span class="hljs-comment">// 考试分数(总分)</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> rank, <span class="hljs-type">double</span> grade)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>        <span class="hljs-built_in">this</span>.rank = rank;<br>        <span class="hljs-built_in">this</span>.grade = grade;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getRank</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> rank;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setRank</span><span class="hljs-params">(<span class="hljs-type">int</span> rank)</span> &#123;<br>        <span class="hljs-built_in">this</span>.rank = rank;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">double</span> <span class="hljs-title function_">getGrade</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> grade;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setGrade</span><span class="hljs-params">(<span class="hljs-type">double</span> grade)</span> &#123;<br>        <span class="hljs-built_in">this</span>.grade = grade;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 老师</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Teacher</span> &#123;<br><br>    <span class="hljs-keyword">private</span> String name;                <span class="hljs-comment">// 老师名称</span><br>    <span class="hljs-keyword">private</span> String clazz;               <span class="hljs-comment">// 班级</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> List&lt;Student&gt; studentList;  <span class="hljs-comment">// 学生</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Teacher</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Teacher</span><span class="hljs-params">(String name, String clazz)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>        <span class="hljs-built_in">this</span>.clazz = clazz;<br>    &#125;<br><br>    <span class="hljs-keyword">static</span> &#123;<br>        studentList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        studentList.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>(<span class="hljs-string">&quot;花花&quot;</span>, <span class="hljs-number">10</span>, <span class="hljs-number">589</span>));<br>        studentList.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>(<span class="hljs-string">&quot;豆豆&quot;</span>, <span class="hljs-number">54</span>, <span class="hljs-number">356</span>));<br>        studentList.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>(<span class="hljs-string">&quot;秋雅&quot;</span>, <span class="hljs-number">23</span>, <span class="hljs-number">439</span>));<br>        studentList.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>(<span class="hljs-string">&quot;皮皮&quot;</span>, <span class="hljs-number">2</span>, <span class="hljs-number">665</span>));<br>        studentList.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>(<span class="hljs-string">&quot;蛋蛋&quot;</span>, <span class="hljs-number">19</span>, <span class="hljs-number">502</span>));<br>    &#125;<br><br>    <span class="hljs-comment">// 总分</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">double</span> <span class="hljs-title function_">clazzTotalScore</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">double</span> <span class="hljs-variable">totalScore</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span> (Student stu : studentList) &#123;<br>            totalScore += stu.getGrade();<br>        &#125;<br>        <span class="hljs-keyword">return</span> totalScore;<br>    &#125;<br><br>    <span class="hljs-comment">// 平均分</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">double</span> <span class="hljs-title function_">clazzAverageScore</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-type">double</span> <span class="hljs-variable">totalScore</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span> (Student stu : studentList) &#123;<br>            totalScore += stu.getGrade();<br>        &#125;<br>        <span class="hljs-keyword">return</span> totalScore / studentList.size();<br>    &#125;<br><br>    <span class="hljs-comment">// 班级人数</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">clazzStudentCount</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> studentList.size();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> List&lt;Student&gt; <span class="hljs-title function_">getStudentList</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> studentList;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getClazz</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> clazz;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 校长</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Principal</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Teacher</span> <span class="hljs-variable">teacher</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Teacher</span>(<span class="hljs-string">&quot;丽华&quot;</span>, <span class="hljs-string">&quot;3年1班&quot;</span>);<br><br>    <span class="hljs-comment">// 查询班级信息，总分数、学生人数、平均值</span><br>    <span class="hljs-keyword">public</span> Map&lt;String, Object&gt; <span class="hljs-title function_">queryClazzInfo</span><span class="hljs-params">(String clazzId)</span> &#123;<br>        <span class="hljs-comment">// 获取班级信息；学生总人数、总分、平均分</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">stuCount</span> <span class="hljs-operator">=</span> teacher.clazzStudentCount();<br>        <span class="hljs-type">double</span> <span class="hljs-variable">totalScore</span> <span class="hljs-operator">=</span> teacher.clazzTotalScore();<br>        <span class="hljs-type">double</span> <span class="hljs-variable">averageScore</span> <span class="hljs-operator">=</span> teacher.clazzAverageScore();<br><br>        <span class="hljs-comment">// 组装对象，实际业务开发会有对应的类</span><br>        Map&lt;String, Object&gt; mapObj = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        mapObj.put(<span class="hljs-string">&quot;班级&quot;</span>, teacher.getClazz());<br>        mapObj.put(<span class="hljs-string">&quot;老师&quot;</span>, teacher.getName());<br>        mapObj.put(<span class="hljs-string">&quot;学生人数&quot;</span>, stuCount);<br>        mapObj.put(<span class="hljs-string">&quot;班级总分数&quot;</span>, totalScore);<br>        mapObj.put(<span class="hljs-string">&quot;班级平均分&quot;</span>, averageScore);<br>        <span class="hljs-keyword">return</span> mapObj;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 测试</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApiTest</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(ApiTest.class);<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test_Principal</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">Principal</span> <span class="hljs-variable">principal</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Principal</span>();<br>        Map&lt;String, Object&gt; map = principal.queryClazzInfo(<span class="hljs-string">&quot;3年1班&quot;</span>);<br>        logger.info(<span class="hljs-string">&quot;查询结果：&#123;&#125;&quot;</span>, JSON.toJSONString(map));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="接口隔离原则"><a href="#接口隔离原则" class="headerlink" title="接口隔离原则"></a>接口隔离原则</h2><blockquote>
<p>要求程序员尽量将臃肿庞大的接口拆分为更小的和更具体的接口，让接口中只包含客户感兴趣的方法</p>
</blockquote>
<ul>
<li>接口隔离原则：更下的接口，更具体的接口</li>
<li>王者荣耀：射箭，隐袭，沉默，眩晕</li>
<li>编码实现：高内聚，低耦合</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 王者英雄，英雄技能接口</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ISkill</span> &#123;<br><br>    <span class="hljs-comment">// 射箭</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">doArchery</span><span class="hljs-params">()</span>;<br><br>    <span class="hljs-comment">// 隐袭</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">doInvisible</span><span class="hljs-params">()</span>;<br><br>    <span class="hljs-comment">// 沉默</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">doSilent</span><span class="hljs-params">()</span>;<br><br>    <span class="hljs-comment">// 眩晕</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">doVertigo</span><span class="hljs-params">()</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 王者英雄，廉颇</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HeroLianPo</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ISkill</span>&#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doArchery</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// 无此技能的实现</span><br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doInvisible</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;廉颇的隐身技能&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doSilent</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;廉颇的沉默技能&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doVertigo</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;廉颇的眩晕技能&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 王者英雄，后裔</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HeroHouYi</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ISkill</span>&#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doArchery</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;后裔的灼日之矢&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doInvisible</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;后裔的隐身技能&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doSilent</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;后裔的沉默技能&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doVertigo</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// 无此技能的实现</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 单元测试</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApiTest</span> &#123;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test_ISkill</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-comment">// 后裔</span><br>        <span class="hljs-type">HeroHouYi</span> <span class="hljs-variable">heroHouYi</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HeroHouYi</span>();<br>        heroHouYi.doArchery();<br><br>        <span class="hljs-comment">// 廉颇</span><br>        <span class="hljs-type">HeroLianPo</span> <span class="hljs-variable">heroLianPo</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HeroLianPo</span>();<br>        heroLianPo.doInvisible();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<p><strong>接口单独抽取</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 射箭接口</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ISkillArchery</span> &#123;<br><br>    <span class="hljs-comment">// 射箭</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">doArchery</span><span class="hljs-params">()</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 隐袭</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ISkillInvisible</span> &#123;<br><br>    <span class="hljs-comment">// 隐袭</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">doInvisible</span><span class="hljs-params">()</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 沉默</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ISkillSilent</span> &#123;<br><br>    <span class="hljs-comment">// 沉默</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">doSilent</span><span class="hljs-params">()</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 眩晕</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ISkillVertigo</span> &#123;<br><br>    <span class="hljs-comment">// 眩晕</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">doVertigo</span><span class="hljs-params">()</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>



<p><strong>实现各个接口</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 王者英雄，后裔</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HeroHouYi</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ISkillArchery</span>, ISkillInvisible, ISkillSilent &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doArchery</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;后裔的灼日之矢&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doInvisible</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;后裔的隐身技能&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doSilent</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;后裔的沉默技能&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 王者英雄，廉颇</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HeroLianPo</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ISkillInvisible</span>, ISkillSilent, ISkillVertigo &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doInvisible</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;廉颇的隐身技能&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doSilent</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;廉颇的沉默技能&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doVertigo</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;廉颇的眩晕技能&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="依赖倒置原则"><a href="#依赖倒置原则" class="headerlink" title="依赖倒置原则"></a>依赖倒置原则</h2><blockquote>
<p>程序要依赖于抽象接口，不要依赖于具体实现。简单的说就是要求对抽象进行编程，不要对实现进行编程，这样就降低了客户与实现模块间的耦合</p>
</blockquote>
<ul>
<li>依赖倒置原则：依赖接口，降低耦合</li>
<li>用户抽奖：随机抽奖，权重抽奖</li>
<li>编码实现：高内聚，低耦合</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 投注用户</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BetUser</span> &#123;<br><br>    <span class="hljs-keyword">private</span> String userName;  <span class="hljs-comment">// 用户姓名</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> userWeight;   <span class="hljs-comment">// 用户权重</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">BetUser</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">BetUser</span><span class="hljs-params">(String userName, <span class="hljs-type">int</span> userWeight)</span> &#123;<br>        <span class="hljs-built_in">this</span>.userName = userName;<br>        <span class="hljs-built_in">this</span>.userWeight = userWeight;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getUserName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> userName;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUserName</span><span class="hljs-params">(String userName)</span> &#123;<br>        <span class="hljs-built_in">this</span>.userName = userName;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getUserWeight</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> userWeight;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUserWeight</span><span class="hljs-params">(<span class="hljs-type">int</span> userWeight)</span> &#123;<br>        <span class="hljs-built_in">this</span>.userWeight = userWeight;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 抽奖控制</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DrawControl</span> &#123;<br><br>    <span class="hljs-comment">// 随机抽取指定数量的用户，作为中奖用户</span><br>    <span class="hljs-keyword">public</span> List&lt;BetUser&gt; <span class="hljs-title function_">doDrawRandom</span><span class="hljs-params">(List&lt;BetUser&gt; list, <span class="hljs-type">int</span> count)</span> &#123;<br>        <span class="hljs-comment">// 集合数量很小直接返回</span><br>        <span class="hljs-keyword">if</span> (list.size() &lt;= count) <span class="hljs-keyword">return</span> list;<br>        <span class="hljs-comment">// 乱序集合</span><br>        Collections.shuffle(list);<br>        <span class="hljs-comment">// 取出指定数量的中奖用户</span><br>        List&lt;BetUser&gt; prizeList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(count);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; count; i++) &#123;<br>            prizeList.add(list.get(i));<br>        &#125;<br>        <span class="hljs-keyword">return</span> prizeList;<br>    &#125;<br><br>    <span class="hljs-comment">// 权重排名获取指定数量的用户，作为中奖用户</span><br>    <span class="hljs-keyword">public</span> List&lt;BetUser&gt; <span class="hljs-title function_">doDrawWeight</span><span class="hljs-params">(List&lt;BetUser&gt; list, <span class="hljs-type">int</span> count)</span> &#123;<br>        <span class="hljs-comment">// 按照权重排序</span><br>        list.sort((o1, o2) -&gt; &#123;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">e</span> <span class="hljs-operator">=</span> o2.getUserWeight() - o1.getUserWeight();<br>            <span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> == e) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>            <span class="hljs-keyword">return</span> e &gt; <span class="hljs-number">0</span> ? <span class="hljs-number">1</span> : -<span class="hljs-number">1</span>;<br>        &#125;);<br>        <span class="hljs-comment">// 取出指定数量的中奖用户</span><br>        List&lt;BetUser&gt; prizeList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(count);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; count; i++) &#123;<br>            prizeList.add(list.get(i));<br>        &#125;<br>        <span class="hljs-keyword">return</span> prizeList;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 单元测试</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApiTest</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(ApiTest.class);<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test_DrawControl</span><span class="hljs-params">()</span>&#123;<br>        List&lt;BetUser&gt; betUserList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        betUserList.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BetUser</span>(<span class="hljs-string">&quot;花花&quot;</span>, <span class="hljs-number">65</span>));<br>        betUserList.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BetUser</span>(<span class="hljs-string">&quot;豆豆&quot;</span>, <span class="hljs-number">43</span>));<br>        betUserList.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BetUser</span>(<span class="hljs-string">&quot;小白&quot;</span>, <span class="hljs-number">72</span>));<br>        betUserList.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BetUser</span>(<span class="hljs-string">&quot;笨笨&quot;</span>, <span class="hljs-number">89</span>));<br>        betUserList.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BetUser</span>(<span class="hljs-string">&quot;丑蛋&quot;</span>, <span class="hljs-number">10</span>));<br><br>        <span class="hljs-type">DrawControl</span> <span class="hljs-variable">drawControl</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DrawControl</span>();<br>        List&lt;BetUser&gt; prizeRandomUserList = drawControl.doDrawRandom(betUserList, <span class="hljs-number">3</span>);<br>        logger.info(<span class="hljs-string">&quot;随机抽奖，中奖用户名单：&#123;&#125;&quot;</span>, JSON.toJSON(prizeRandomUserList));<br><br>        List&lt;BetUser&gt; prizeWeightUserList = drawControl.doDrawWeight(betUserList, <span class="hljs-number">3</span>);<br>        logger.info(<span class="hljs-string">&quot;权重抽奖，中奖用户名单：&#123;&#125;&quot;</span>, JSON.toJSON(prizeWeightUserList));<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>



<p><strong>代码重构</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 抽奖接口</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">IDraw</span> &#123;<br><br>    List&lt;BetUser&gt; <span class="hljs-title function_">prize</span><span class="hljs-params">(List&lt;BetUser&gt; list, <span class="hljs-type">int</span> count)</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 抽奖控制</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DrawControl</span> &#123;<br><br>    <span class="hljs-keyword">private</span> IDraw draw;<br><br>    <span class="hljs-keyword">public</span> List&lt;BetUser&gt; <span class="hljs-title function_">doDraw</span><span class="hljs-params">(IDraw draw, List&lt;BetUser&gt; betUserList, <span class="hljs-type">int</span> count)</span> &#123;<br>        <span class="hljs-keyword">return</span> draw.prize(betUserList, count);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 随机抽奖</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DrawRandom</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IDraw</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> List&lt;BetUser&gt; <span class="hljs-title function_">prize</span><span class="hljs-params">(List&lt;BetUser&gt; list, <span class="hljs-type">int</span> count)</span> &#123;<br>        <span class="hljs-comment">// 集合数量很小直接返回</span><br>        <span class="hljs-keyword">if</span> (list.size() &lt;= count) <span class="hljs-keyword">return</span> list;<br>        <span class="hljs-comment">// 乱序集合</span><br>        Collections.shuffle(list);<br>        <span class="hljs-comment">// 取出指定数量的中奖用户</span><br>        List&lt;BetUser&gt; prizeList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(count);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; count; i++) &#123;<br>            prizeList.add(list.get(i));<br>        &#125;<br>        <span class="hljs-keyword">return</span> prizeList;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 权重抽奖</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DrawWeightRank</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IDraw</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> List&lt;BetUser&gt; <span class="hljs-title function_">prize</span><span class="hljs-params">(List&lt;BetUser&gt; list, <span class="hljs-type">int</span> count)</span> &#123;<br>        <span class="hljs-comment">// 按照权重排序</span><br>        list.sort((o1, o2) -&gt; &#123;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">e</span> <span class="hljs-operator">=</span> o2.getUserWeight() - o1.getUserWeight();<br>            <span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> == e) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>            <span class="hljs-keyword">return</span> e &gt; <span class="hljs-number">0</span> ? <span class="hljs-number">1</span> : -<span class="hljs-number">1</span>;<br>        &#125;);<br>        <span class="hljs-comment">// 取出指定数量的中奖用户</span><br>        List&lt;BetUser&gt; prizeList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(count);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; count; i++) &#123;<br>            prizeList.add(list.get(i));<br>        &#125;<br>        <span class="hljs-keyword">return</span> prizeList;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 单元测试</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApiTest</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(ApiTest.class);<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test_DrawControl</span><span class="hljs-params">()</span> &#123;<br>        List&lt;BetUser&gt; betUserList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        betUserList.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BetUser</span>(<span class="hljs-string">&quot;花花&quot;</span>, <span class="hljs-number">65</span>));<br>        betUserList.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BetUser</span>(<span class="hljs-string">&quot;豆豆&quot;</span>, <span class="hljs-number">43</span>));<br>        betUserList.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BetUser</span>(<span class="hljs-string">&quot;小白&quot;</span>, <span class="hljs-number">72</span>));<br>        betUserList.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BetUser</span>(<span class="hljs-string">&quot;笨笨&quot;</span>, <span class="hljs-number">89</span>));<br>        betUserList.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BetUser</span>(<span class="hljs-string">&quot;丑蛋&quot;</span>, <span class="hljs-number">10</span>));<br><br>        <span class="hljs-type">DrawControl</span> <span class="hljs-variable">drawControl</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DrawControl</span>();<br>        List&lt;BetUser&gt; prizeRandomUserList = drawControl.doDraw(<span class="hljs-keyword">new</span> <span class="hljs-title class_">DrawRandom</span>(), betUserList, <span class="hljs-number">3</span>);<br>        logger.info(<span class="hljs-string">&quot;随机抽奖，中奖用户名单：&#123;&#125;&quot;</span>, JSON.toJSON(prizeRandomUserList));<br><br>        List&lt;BetUser&gt; prizeWeightUserList = drawControl.doDraw(<span class="hljs-keyword">new</span> <span class="hljs-title class_">DrawWeightRank</span>(), betUserList, <span class="hljs-number">3</span>);<br>        logger.info(<span class="hljs-string">&quot;权重抽奖，中奖用户名单：&#123;&#125;&quot;</span>, JSON.toJSON(prizeWeightUserList));<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="工厂方法模式"><a href="#工厂方法模式" class="headerlink" title="工厂方法模式"></a>工厂方法模式</h2><blockquote>
<p>工厂模式又称工厂方法模式，是一种创建型设计模式，其在父类中提供一个创建对象的方法，允许子类决定实例化对象的类型</p>
</blockquote>
<ul>
<li>多种类型商品不同接口，统一发奖服务搭建场景</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 发奖请求对象</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AwardReq</span> &#123;<br><br>    <span class="hljs-keyword">private</span> String uId;                 <span class="hljs-comment">// 用户唯一ID</span><br>    <span class="hljs-keyword">private</span> Integer awardType;          <span class="hljs-comment">// 奖品类型(可以用枚举定义)；1优惠券、2实物商品、3第三方兑换卡(爱奇艺)</span><br>    <span class="hljs-keyword">private</span> String awardNumber;         <span class="hljs-comment">// 奖品编号；sku、couponNumber、cardId</span><br>    <span class="hljs-keyword">private</span> String bizId;               <span class="hljs-comment">// 业务ID，防重复</span><br>    <span class="hljs-keyword">private</span> Map&lt;String, String&gt; extMap; <span class="hljs-comment">// 扩展信息</span><br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getuId</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> uId;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setuId</span><span class="hljs-params">(String uId)</span> &#123;<br>        <span class="hljs-built_in">this</span>.uId = uId;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">getAwardType</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> awardType;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAwardType</span><span class="hljs-params">(Integer awardType)</span> &#123;<br>        <span class="hljs-built_in">this</span>.awardType = awardType;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getAwardNumber</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> awardNumber;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAwardNumber</span><span class="hljs-params">(String awardNumber)</span> &#123;<br>        <span class="hljs-built_in">this</span>.awardNumber = awardNumber;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getBizId</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> bizId;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setBizId</span><span class="hljs-params">(String bizId)</span> &#123;<br>        <span class="hljs-built_in">this</span>.bizId = bizId;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Map&lt;String, String&gt; <span class="hljs-title function_">getExtMap</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> extMap;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setExtMap</span><span class="hljs-params">(Map&lt;String, String&gt; extMap)</span> &#123;<br>        <span class="hljs-built_in">this</span>.extMap = extMap;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 发奖结果反馈对象</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AwardRes</span> &#123;<br><br>    <span class="hljs-keyword">private</span> String code; <span class="hljs-comment">// 编码</span><br>    <span class="hljs-keyword">private</span> String info; <span class="hljs-comment">// 描述</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">AwardRes</span><span class="hljs-params">(String code, String info)</span> &#123;<br>        <span class="hljs-built_in">this</span>.code = code;<br>        <span class="hljs-built_in">this</span>.info = info;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getCode</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> code;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setCode</span><span class="hljs-params">(String code)</span> &#123;<br>        <span class="hljs-built_in">this</span>.code = code;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getInfo</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> info;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setInfo</span><span class="hljs-params">(String info)</span> &#123;<br>        <span class="hljs-built_in">this</span>.info = info;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 模拟发奖服务</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PrizeController</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(PrizeController.class);<br><br>    <span class="hljs-keyword">public</span> AwardRes <span class="hljs-title function_">awardToUser</span><span class="hljs-params">(AwardReq req)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">reqJson</span> <span class="hljs-operator">=</span> JSON.toJSONString(req);<br>        <span class="hljs-type">AwardRes</span> <span class="hljs-variable">awardRes</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            logger.info(<span class="hljs-string">&quot;奖品发放开始&#123;&#125;。req:&#123;&#125;&quot;</span>, req.getuId(), reqJson);<br>            <span class="hljs-comment">// 按照不同类型方法商品[1优惠券、2实物商品、3第三方兑换卡(爱奇艺)]</span><br>            <span class="hljs-keyword">if</span> (req.getAwardType() == <span class="hljs-number">1</span>) &#123;<br>                <span class="hljs-type">CouponService</span> <span class="hljs-variable">couponService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CouponService</span>();<br>                <span class="hljs-type">CouponResult</span> <span class="hljs-variable">couponResult</span> <span class="hljs-operator">=</span> couponService.sendCoupon(req.getuId(), req.getAwardNumber(), req.getBizId());<br>                <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;0000&quot;</span>.equals(couponResult.getCode())) &#123;<br>                    awardRes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AwardRes</span>(<span class="hljs-string">&quot;0000&quot;</span>, <span class="hljs-string">&quot;发放成功&quot;</span>);<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    awardRes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AwardRes</span>(<span class="hljs-string">&quot;0001&quot;</span>, couponResult.getInfo());<br>                &#125;<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (req.getAwardType() == <span class="hljs-number">2</span>) &#123;<br>                <span class="hljs-type">GoodsService</span> <span class="hljs-variable">goodsService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GoodsService</span>();<br>                <span class="hljs-type">DeliverReq</span> <span class="hljs-variable">deliverReq</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DeliverReq</span>();<br>                deliverReq.setUserName(queryUserName(req.getuId()));<br>                deliverReq.setUserPhone(queryUserPhoneNumber(req.getuId()));<br>                deliverReq.setSku(req.getAwardNumber());<br>                deliverReq.setOrderId(req.getBizId());<br>                deliverReq.setConsigneeUserName(req.getExtMap().get(<span class="hljs-string">&quot;consigneeUserName&quot;</span>));<br>                deliverReq.setConsigneeUserPhone(req.getExtMap().get(<span class="hljs-string">&quot;consigneeUserPhone&quot;</span>));<br>                deliverReq.setConsigneeUserAddress(req.getExtMap().get(<span class="hljs-string">&quot;consigneeUserAddress&quot;</span>));<br>                <span class="hljs-type">Boolean</span> <span class="hljs-variable">isSuccess</span> <span class="hljs-operator">=</span> goodsService.deliverGoods(deliverReq);<br>                <span class="hljs-keyword">if</span> (isSuccess) &#123;<br>                    awardRes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AwardRes</span>(<span class="hljs-string">&quot;0000&quot;</span>, <span class="hljs-string">&quot;发放成功&quot;</span>);<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    awardRes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AwardRes</span>(<span class="hljs-string">&quot;0001&quot;</span>, <span class="hljs-string">&quot;发放失败&quot;</span>);<br>                &#125;<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (req.getAwardType() == <span class="hljs-number">3</span>) &#123;<br>                <span class="hljs-type">String</span> <span class="hljs-variable">bindMobileNumber</span> <span class="hljs-operator">=</span> queryUserPhoneNumber(req.getuId());<br>                <span class="hljs-type">IQiYiCardService</span> <span class="hljs-variable">iQiYiCardService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IQiYiCardService</span>();<br>                iQiYiCardService.grantToken(bindMobileNumber, req.getAwardNumber());<br>                awardRes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AwardRes</span>(<span class="hljs-string">&quot;0000&quot;</span>, <span class="hljs-string">&quot;发放成功&quot;</span>);<br>            &#125;<br>            logger.info(<span class="hljs-string">&quot;奖品发放完成&#123;&#125;。&quot;</span>, req.getuId());<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            logger.error(<span class="hljs-string">&quot;奖品发放失败&#123;&#125;。req:&#123;&#125;&quot;</span>, req.getuId(), reqJson, e);<br>            awardRes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AwardRes</span>(<span class="hljs-string">&quot;0001&quot;</span>, e.getMessage());<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> awardRes;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">queryUserName</span><span class="hljs-params">(String uId)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;花花&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">queryUserPhoneNumber</span><span class="hljs-params">(String uId)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;15200101232&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 单元测试</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApiTest</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(ApiTest.class);<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test_awardToUser</span><span class="hljs-params">()</span> &#123;<br><br>        <span class="hljs-type">PrizeController</span> <span class="hljs-variable">prizeController</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PrizeController</span>();<br><br>        System.out.println(<span class="hljs-string">&quot;\r\n模拟发放优惠券测试\r\n&quot;</span>);<br>        <span class="hljs-comment">// 模拟发放优惠券测试</span><br>        <span class="hljs-type">AwardReq</span> <span class="hljs-variable">req01</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AwardReq</span>();<br>        req01.setuId(<span class="hljs-string">&quot;10001&quot;</span>);<br>        req01.setAwardType(<span class="hljs-number">1</span>);<br>        req01.setAwardNumber(<span class="hljs-string">&quot;EGM1023938910232121323432&quot;</span>);<br>        req01.setBizId(<span class="hljs-string">&quot;791098764902132&quot;</span>);<br>        <span class="hljs-type">AwardRes</span> <span class="hljs-variable">awardRes01</span> <span class="hljs-operator">=</span> prizeController.awardToUser(req01);<br><br>        logger.info(<span class="hljs-string">&quot;请求参数：&#123;&#125;&quot;</span>, JSON.toJSON(req01));<br>        logger.info(<span class="hljs-string">&quot;测试结果：&#123;&#125;&quot;</span>, JSON.toJSON(awardRes01));<br><br>        System.out.println(<span class="hljs-string">&quot;\r\n模拟方法实物商品\r\n&quot;</span>);<br>        <span class="hljs-comment">// 模拟方法实物商品</span><br>        <span class="hljs-type">AwardReq</span> <span class="hljs-variable">req02</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AwardReq</span>();<br>        req02.setuId(<span class="hljs-string">&quot;10001&quot;</span>);<br>        req02.setAwardType(<span class="hljs-number">2</span>);<br>        req02.setAwardNumber(<span class="hljs-string">&quot;9820198721311&quot;</span>);<br>        req02.setBizId(<span class="hljs-string">&quot;1023000020112221113&quot;</span>);<br>        req02.setExtMap(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;String, String&gt;() &#123;&#123;<br>            put(<span class="hljs-string">&quot;consigneeUserName&quot;</span>, <span class="hljs-string">&quot;谢飞机&quot;</span>);<br>            put(<span class="hljs-string">&quot;consigneeUserPhone&quot;</span>, <span class="hljs-string">&quot;15200292123&quot;</span>);<br>            put(<span class="hljs-string">&quot;consigneeUserAddress&quot;</span>, <span class="hljs-string">&quot;吉林省.长春市.双阳区.XX街道.檀溪苑小区.#18-2109&quot;</span>);<br>        &#125;&#125;);<br><br>        <span class="hljs-type">AwardRes</span> <span class="hljs-variable">awardRes02</span> <span class="hljs-operator">=</span> prizeController.awardToUser(req02);<br>        logger.info(<span class="hljs-string">&quot;请求参数：&#123;&#125;&quot;</span>, JSON.toJSON(req02));<br>        logger.info(<span class="hljs-string">&quot;测试结果：&#123;&#125;&quot;</span>, JSON.toJSON(awardRes02));<br><br>        System.out.println(<span class="hljs-string">&quot;\r\n第三方兑换卡(爱奇艺)\r\n&quot;</span>);<br>        <span class="hljs-type">AwardReq</span> <span class="hljs-variable">req03</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AwardReq</span>();<br>        req03.setuId(<span class="hljs-string">&quot;10001&quot;</span>);<br>        req03.setAwardType(<span class="hljs-number">3</span>);<br>        req03.setAwardNumber(<span class="hljs-string">&quot;AQY1xjkUodl8LO975GdfrYUio&quot;</span>);<br><br>        <span class="hljs-type">AwardRes</span> <span class="hljs-variable">awardRes03</span> <span class="hljs-operator">=</span> prizeController.awardToUser(req03);<br>        logger.info(<span class="hljs-string">&quot;请求参数：&#123;&#125;&quot;</span>, JSON.toJSON(req03));<br>        logger.info(<span class="hljs-string">&quot;测试结果：&#123;&#125;&quot;</span>, JSON.toJSON(awardRes03));<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<p><strong>接口实现</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 爱奇艺兑换卡</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CardCommodityService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ICommodity</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(CardCommodityService.class);<br><br>    <span class="hljs-comment">// 模拟注入</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">IQiYiCardService</span> <span class="hljs-variable">iQiYiCardService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IQiYiCardService</span>();<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendCommodity</span><span class="hljs-params">(String uId, String commodityId, String bizId, Map&lt;String, String&gt; extMap)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">mobile</span> <span class="hljs-operator">=</span> queryUserMobile(uId);<br>        iQiYiCardService.grantToken(mobile, bizId);<br>        logger.info(<span class="hljs-string">&quot;请求参数[爱奇艺兑换卡] =&gt; uId：&#123;&#125; commodityId：&#123;&#125; bizId：&#123;&#125; extMap：&#123;&#125;&quot;</span>, uId, commodityId, bizId, JSON.toJSON(extMap));<br>        logger.info(<span class="hljs-string">&quot;测试结果[爱奇艺兑换卡]：success&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">queryUserMobile</span><span class="hljs-params">(String uId)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;15200101232&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 优惠券</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CouponCommodityService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ICommodity</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(CouponCommodityService.class);<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">CouponService</span> <span class="hljs-variable">couponService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CouponService</span>();<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendCommodity</span><span class="hljs-params">(String uId, String commodityId, String bizId, Map&lt;String, String&gt; extMap)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">CouponResult</span> <span class="hljs-variable">couponResult</span> <span class="hljs-operator">=</span> couponService.sendCoupon(uId, commodityId, bizId);<br>        logger.info(<span class="hljs-string">&quot;请求参数[优惠券] =&gt; uId：&#123;&#125; commodityId：&#123;&#125; bizId：&#123;&#125; extMap：&#123;&#125;&quot;</span>, uId, commodityId, bizId, JSON.toJSON(extMap));<br>        logger.info(<span class="hljs-string">&quot;测试结果[优惠券]：&#123;&#125;&quot;</span>, JSON.toJSON(couponResult));<br>        <span class="hljs-keyword">if</span> (!<span class="hljs-string">&quot;0000&quot;</span>.equals(couponResult.getCode())) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(couponResult.getInfo());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 实物商品</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GoodsCommodityService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ICommodity</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(GoodsCommodityService.class);<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">GoodsService</span> <span class="hljs-variable">goodsService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GoodsService</span>();<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendCommodity</span><span class="hljs-params">(String uId, String commodityId, String bizId, Map&lt;String, String&gt; extMap)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">DeliverReq</span> <span class="hljs-variable">deliverReq</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DeliverReq</span>();<br>        deliverReq.setUserName(queryUserName(uId));<br>        deliverReq.setUserPhone(queryUserPhoneNumber(uId));<br>        deliverReq.setSku(commodityId);<br>        deliverReq.setOrderId(bizId);<br>        deliverReq.setConsigneeUserName(extMap.get(<span class="hljs-string">&quot;consigneeUserName&quot;</span>));<br>        deliverReq.setConsigneeUserPhone(extMap.get(<span class="hljs-string">&quot;consigneeUserPhone&quot;</span>));<br>        deliverReq.setConsigneeUserAddress(extMap.get(<span class="hljs-string">&quot;consigneeUserAddress&quot;</span>));<br><br>        <span class="hljs-type">Boolean</span> <span class="hljs-variable">isSuccess</span> <span class="hljs-operator">=</span> goodsService.deliverGoods(deliverReq);<br><br>        logger.info(<span class="hljs-string">&quot;请求参数[实物商品] =&gt; uId：&#123;&#125; commodityId：&#123;&#125; bizId：&#123;&#125; extMap：&#123;&#125;&quot;</span>, uId, commodityId, bizId, JSON.toJSON(extMap));<br>        logger.info(<span class="hljs-string">&quot;测试结果[实物商品]：&#123;&#125;&quot;</span>, isSuccess);<br><br>        <span class="hljs-keyword">if</span> (!isSuccess) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;实物商品发放失败&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">queryUserName</span><span class="hljs-params">(String uId)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;花花&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">queryUserPhoneNumber</span><span class="hljs-params">(String uId)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;15200101232&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 发放商品接口</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ICommodity</span> &#123;<br><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendCommodity</span><span class="hljs-params">(String uId, String commodityId, String bizId, Map&lt;String, String&gt; extMap)</span> <span class="hljs-keyword">throws</span> Exception;<br><br>&#125;<br></code></pre></td></tr></table></figure>



<p><strong>引入工厂模式</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 工厂</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StoreFactory</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 奖品类型方式实例化</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> commodityType 奖品类型</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span>              实例化对象</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> ICommodity <span class="hljs-title function_">getCommodityService</span><span class="hljs-params">(Integer commodityType)</span> &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> == commodityType) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-number">1</span> == commodityType) <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CouponCommodityService</span>();<br>        <span class="hljs-keyword">if</span> (<span class="hljs-number">2</span> == commodityType) <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GoodsCommodityService</span>();<br>        <span class="hljs-keyword">if</span> (<span class="hljs-number">3</span> == commodityType) <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CardCommodityService</span>();<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;不存在的奖品服务类型&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 奖品类信息方式实例化</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> clazz 奖品类</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span>      实例化对象</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> ICommodity <span class="hljs-title function_">getCommodityService</span><span class="hljs-params">(Class&lt;? extends ICommodity&gt; clazz)</span> <span class="hljs-keyword">throws</span> IllegalAccessException, InstantiationException &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> == clazz) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">return</span> clazz.newInstance();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 单元测试</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApiTest</span> &#123;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test_StoreFactory_01</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">StoreFactory</span> <span class="hljs-variable">storeFactory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StoreFactory</span>();<br><br>        <span class="hljs-comment">// 1. 优惠券</span><br>        <span class="hljs-type">ICommodity</span> <span class="hljs-variable">commodityService_1</span> <span class="hljs-operator">=</span> storeFactory.getCommodityService(<span class="hljs-number">1</span>);<br>        commodityService_1.sendCommodity(<span class="hljs-string">&quot;10001&quot;</span>, <span class="hljs-string">&quot;EGM1023938910232121323432&quot;</span>, <span class="hljs-string">&quot;791098764902132&quot;</span>, <span class="hljs-literal">null</span>);<br><br>        <span class="hljs-comment">// 2. 实物商品</span><br>        <span class="hljs-type">ICommodity</span> <span class="hljs-variable">commodityService_2</span> <span class="hljs-operator">=</span> storeFactory.getCommodityService(<span class="hljs-number">2</span>);<br>        commodityService_2.sendCommodity(<span class="hljs-string">&quot;10001&quot;</span>, <span class="hljs-string">&quot;9820198721311&quot;</span>, <span class="hljs-string">&quot;1023000020112221113&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;String, String&gt;() &#123;&#123;<br>            put(<span class="hljs-string">&quot;consigneeUserName&quot;</span>, <span class="hljs-string">&quot;谢飞机&quot;</span>);<br>            put(<span class="hljs-string">&quot;consigneeUserPhone&quot;</span>, <span class="hljs-string">&quot;15200292123&quot;</span>);<br>            put(<span class="hljs-string">&quot;consigneeUserAddress&quot;</span>, <span class="hljs-string">&quot;吉林省.长春市.双阳区.XX街道.檀溪苑小区.#18-2109&quot;</span>);<br>        &#125;&#125;);<br><br>        <span class="hljs-comment">// 3. 第三方兑换卡(模拟爱奇艺)</span><br>        <span class="hljs-type">ICommodity</span> <span class="hljs-variable">commodityService_3</span> <span class="hljs-operator">=</span> storeFactory.getCommodityService(<span class="hljs-number">3</span>);<br>        commodityService_3.sendCommodity(<span class="hljs-string">&quot;10001&quot;</span>, <span class="hljs-string">&quot;AQY1xjkUodl8LO975GdfrYUio&quot;</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);<br><br>    &#125;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test_StoreFactory_02</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">StoreFactory</span> <span class="hljs-variable">storeFactory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StoreFactory</span>();<br>        <span class="hljs-comment">// 1. 优惠券</span><br>        <span class="hljs-type">ICommodity</span> <span class="hljs-variable">commodityService</span> <span class="hljs-operator">=</span> storeFactory.getCommodityService(CouponCommodityService.class);<br>        commodityService.sendCommodity(<span class="hljs-string">&quot;10001&quot;</span>, <span class="hljs-string">&quot;EGM1023938910232121323432&quot;</span>, <span class="hljs-string">&quot;791098764902132&quot;</span>, <span class="hljs-literal">null</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="抽象工厂模式"><a href="#抽象工厂模式" class="headerlink" title="抽象工厂模式"></a>抽象工厂模式</h2><blockquote>
<p>围绕一个超级工厂创建其他工厂。该超级工厂又称为其他工厂的工厂。这种类型的设计模式属于创建型模式，它提供了一种创建对象的最佳方式</p>
</blockquote>
<ul>
<li>替换Redis双集群升级，代理类抽象场景</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">CacheService</span> &#123;<br><br>    String <span class="hljs-title function_">get</span><span class="hljs-params">(<span class="hljs-keyword">final</span> String key)</span>;<br><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">set</span><span class="hljs-params">(String key, String value)</span>;<br><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">set</span><span class="hljs-params">(String key, String value, <span class="hljs-type">long</span> timeout, TimeUnit timeUnit)</span>;<br><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">del</span><span class="hljs-params">(String key)</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CacheServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">CacheService</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">RedisUtils</span> <span class="hljs-variable">redisUtils</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RedisUtils</span>();<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">get</span><span class="hljs-params">(String key)</span> &#123;<br>        <span class="hljs-keyword">return</span> redisUtils.get(key);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">set</span><span class="hljs-params">(String key, String value)</span> &#123;<br>        redisUtils.set(key, value);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">set</span><span class="hljs-params">(String key, String value, <span class="hljs-type">long</span> timeout, TimeUnit timeUnit)</span> &#123;<br>        redisUtils.set(key, value, timeout, timeUnit);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">del</span><span class="hljs-params">(String key)</span> &#123;<br>        redisUtils.del(key);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<p><strong>提供集群</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 模拟Redis缓存服务，EGM</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EGM</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(EGM.class);<br><br>    <span class="hljs-keyword">private</span> Map&lt;String, String&gt; dataMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;String, String&gt;();<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">gain</span><span class="hljs-params">(String key)</span> &#123;<br>        logger.info(<span class="hljs-string">&quot;EGM获取数据 key：&#123;&#125;&quot;</span>, key);<br>        <span class="hljs-keyword">return</span> dataMap.get(key);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">set</span><span class="hljs-params">(String key, String value)</span> &#123;<br>        logger.info(<span class="hljs-string">&quot;EGM写入数据 key：&#123;&#125; val：&#123;&#125;&quot;</span>, key, value);<br>        dataMap.put(key, value);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setEx</span><span class="hljs-params">(String key, String value, <span class="hljs-type">long</span> timeout, TimeUnit timeUnit)</span> &#123;<br>        logger.info(<span class="hljs-string">&quot;EGM写入数据 key：&#123;&#125; val：&#123;&#125; timeout：&#123;&#125; timeUnit：&#123;&#125;&quot;</span>, key, value, timeout, timeUnit.toString());<br>        dataMap.put(key, value);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">delete</span><span class="hljs-params">(String key)</span> &#123;<br>        logger.info(<span class="hljs-string">&quot;EGM删除数据 key：&#123;&#125;&quot;</span>, key);<br>        dataMap.remove(key);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 模拟Redis缓存服务，IIR</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">IIR</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(IIR.class);<br><br>    <span class="hljs-keyword">private</span> Map&lt;String, String&gt; dataMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;String, String&gt;();<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">get</span><span class="hljs-params">(String key)</span> &#123;<br>        logger.info(<span class="hljs-string">&quot;IIR获取数据 key：&#123;&#125;&quot;</span>, key);<br>        <span class="hljs-keyword">return</span> dataMap.get(key);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">set</span><span class="hljs-params">(String key, String value)</span> &#123;<br>        logger.info(<span class="hljs-string">&quot;IIR写入数据 key：&#123;&#125; val：&#123;&#125;&quot;</span>, key, value);<br>        dataMap.put(key, value);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setExpire</span><span class="hljs-params">(String key, String value, <span class="hljs-type">long</span> timeout, TimeUnit timeUnit)</span> &#123;<br>        logger.info(<span class="hljs-string">&quot;IIR写入数据 key：&#123;&#125; val：&#123;&#125; timeout：&#123;&#125; timeUnit：&#123;&#125;&quot;</span>, key, value, timeout, timeUnit.toString());<br>        dataMap.put(key, value);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">del</span><span class="hljs-params">(String key)</span> &#123;<br>        logger.info(<span class="hljs-string">&quot;IIR删除数据 key：&#123;&#125;&quot;</span>, key);<br>        dataMap.remove(key);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 模拟最开始使用的Redis服务，单机的。</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisUtils</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(RedisUtils.class);<br><br>    <span class="hljs-keyword">private</span> Map&lt;String, String&gt; dataMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">get</span><span class="hljs-params">(String key)</span> &#123;<br>        logger.info(<span class="hljs-string">&quot;Redis获取数据 key：&#123;&#125;&quot;</span>, key);<br>        <span class="hljs-keyword">return</span> dataMap.get(key);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">set</span><span class="hljs-params">(String key, String value)</span> &#123;<br>        logger.info(<span class="hljs-string">&quot;Redis写入数据 key：&#123;&#125; val：&#123;&#125;&quot;</span>, key, value);<br>        dataMap.put(key, value);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">set</span><span class="hljs-params">(String key, String value, <span class="hljs-type">long</span> timeout, TimeUnit timeUnit)</span> &#123;<br>        logger.info(<span class="hljs-string">&quot;Redis写入数据 key：&#123;&#125; val：&#123;&#125; timeout：&#123;&#125; timeUnit：&#123;&#125;&quot;</span>, key, value, timeout, timeUnit.toString());<br>        dataMap.put(key, value);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">del</span><span class="hljs-params">(String key)</span> &#123;<br>        logger.info(<span class="hljs-string">&quot;Redis删除数据 key：&#123;&#125;&quot;</span>, key);<br>        dataMap.remove(key);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<p><strong>升级</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 升级后，使用多套Redis集群服务，同时兼容以前单体Redis服务</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CacheClusterServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">CacheService</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">RedisUtils</span> <span class="hljs-variable">redisUtils</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RedisUtils</span>();<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">EGM</span> <span class="hljs-variable">egm</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">EGM</span>();<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">IIR</span> <span class="hljs-variable">iir</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IIR</span>();<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">get</span><span class="hljs-params">(String key, <span class="hljs-type">int</span> redisType)</span> &#123;<br><br>        <span class="hljs-keyword">if</span> (<span class="hljs-number">1</span> == redisType) &#123;<br>            <span class="hljs-keyword">return</span> egm.gain(key);<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (<span class="hljs-number">2</span> == redisType) &#123;<br>            <span class="hljs-keyword">return</span> iir.get(key);<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> redisUtils.get(key);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">set</span><span class="hljs-params">(String key, String value, <span class="hljs-type">int</span> redisType)</span> &#123;<br><br>        <span class="hljs-keyword">if</span> (<span class="hljs-number">1</span> == redisType) &#123;<br>            egm.set(key, value);<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (<span class="hljs-number">2</span> == redisType) &#123;<br>            iir.set(key, value);<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br><br>        redisUtils.set(key, value);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">set</span><span class="hljs-params">(String key, String value, <span class="hljs-type">long</span> timeout, TimeUnit timeUnit, <span class="hljs-type">int</span> redisType)</span> &#123;<br><br>        <span class="hljs-keyword">if</span> (<span class="hljs-number">1</span> == redisType) &#123;<br>            egm.setEx(key, value, timeout, timeUnit);<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (<span class="hljs-number">2</span> == redisType) &#123;<br>            iir.setExpire(key, value, timeout, timeUnit);<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br><br>        redisUtils.set(key, value, timeout, timeUnit);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">del</span><span class="hljs-params">(String key, <span class="hljs-type">int</span> redisType)</span> &#123;<br><br>        <span class="hljs-keyword">if</span> (<span class="hljs-number">1</span> == redisType) &#123;<br>            egm.delete(key);<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (<span class="hljs-number">2</span> == redisType) &#123;<br>            iir.del(key);<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br><br>        redisUtils.del(key);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * 测试</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApiTest</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(ApiTest.class);<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test_CacheServiceAfterImpl</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">CacheService</span> <span class="hljs-variable">cacheService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CacheClusterServiceImpl</span>();<br><br>        cacheService.set(<span class="hljs-string">&quot;user_name_01&quot;</span>, <span class="hljs-string">&quot;小明&quot;</span>, <span class="hljs-number">1</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">val01</span> <span class="hljs-operator">=</span> cacheService.get(<span class="hljs-string">&quot;user_name_01&quot;</span>, <span class="hljs-number">1</span>);<br>        logger.info(<span class="hljs-string">&quot;缓存集群升级，测试结果：&#123;&#125;&quot;</span>, val01);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<p><strong>提供适配类</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 车间适配器</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ICacheAdapter</span> &#123;<br><br>    String <span class="hljs-title function_">get</span><span class="hljs-params">(<span class="hljs-keyword">final</span> String key)</span>;<br><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">set</span><span class="hljs-params">(String key, String value)</span>;<br><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">set</span><span class="hljs-params">(String key, String value, <span class="hljs-type">long</span> timeout, TimeUnit timeUnit)</span>;<br><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">del</span><span class="hljs-params">(String key)</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EGMCacheAdapter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ICacheAdapter</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">EGM</span> <span class="hljs-variable">egm</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">EGM</span>();<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">get</span><span class="hljs-params">(String key)</span> &#123;<br>        <span class="hljs-keyword">return</span> egm.gain(key);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">set</span><span class="hljs-params">(String key, String value)</span> &#123;<br>        egm.set(key, value);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">set</span><span class="hljs-params">(String key, String value, <span class="hljs-type">long</span> timeout, TimeUnit timeUnit)</span> &#123;<br>        egm.setEx(key, value, timeout, timeUnit);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">del</span><span class="hljs-params">(String key)</span> &#123;<br>        egm.delete(key);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">IIRCacheAdapter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ICacheAdapter</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">IIR</span> <span class="hljs-variable">iir</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IIR</span>();<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">get</span><span class="hljs-params">(String key)</span> &#123;<br>        <span class="hljs-keyword">return</span> iir.get(key);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">set</span><span class="hljs-params">(String key, String value)</span> &#123;<br>        iir.set(key, value);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">set</span><span class="hljs-params">(String key, String value, <span class="hljs-type">long</span> timeout, TimeUnit timeUnit)</span> &#123;<br>        iir.setExpire(key, value, timeout, timeUnit);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">del</span><span class="hljs-params">(String key)</span> &#123;<br>        iir.del(key);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * 工具类</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ClassLoaderUtils</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Class&lt;?&gt;[] getClazzByArgs(Object[] args) &#123;<br>        Class&lt;?&gt;[] parameterTypes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[args.length];<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; args.length; i++) &#123;<br>            <span class="hljs-keyword">if</span> (args[i] <span class="hljs-keyword">instanceof</span> ArrayList) &#123;<br>                parameterTypes[i] = List.class;<br>                <span class="hljs-keyword">continue</span>;<br>            &#125;<br>            <span class="hljs-keyword">if</span> (args[i] <span class="hljs-keyword">instanceof</span> LinkedList) &#123;<br>                parameterTypes[i] = List.class;<br>                <span class="hljs-keyword">continue</span>;<br>            &#125;<br>            <span class="hljs-keyword">if</span> (args[i] <span class="hljs-keyword">instanceof</span> HashMap) &#123;<br>                parameterTypes[i] = Map.class;<br>                <span class="hljs-keyword">continue</span>;<br>            &#125;<br>            <span class="hljs-keyword">if</span> (args[i] <span class="hljs-keyword">instanceof</span> Long)&#123;<br>                parameterTypes[i] = <span class="hljs-type">long</span>.class;<br>                <span class="hljs-keyword">continue</span>;<br>            &#125;<br>            <span class="hljs-keyword">if</span> (args[i] <span class="hljs-keyword">instanceof</span> Double)&#123;<br>                parameterTypes[i] = <span class="hljs-type">double</span>.class;<br>                <span class="hljs-keyword">continue</span>;<br>            &#125;<br>            <span class="hljs-keyword">if</span> (args[i] <span class="hljs-keyword">instanceof</span> TimeUnit)&#123;<br>                parameterTypes[i] = TimeUnit.class;<br>                <span class="hljs-keyword">continue</span>;<br>            &#125;<br>            parameterTypes[i] = args[i].getClass();<br>        &#125;<br>        <span class="hljs-keyword">return</span> parameterTypes;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<p><strong>抽象工厂实现</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 代理对象</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JDKProxyFactory</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; T <span class="hljs-title function_">getProxy</span><span class="hljs-params">(Class&lt;T&gt; cacheClazz, Class&lt;? extends ICacheAdapter&gt; cacheAdapter)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">InvocationHandler</span> <span class="hljs-variable">handler</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JDKInvocationHandler</span>(cacheAdapter.newInstance());<br>        <span class="hljs-type">ClassLoader</span> <span class="hljs-variable">classLoader</span> <span class="hljs-operator">=</span> Thread.currentThread().getContextClassLoader();<br>        <span class="hljs-keyword">return</span> (T) Proxy.newProxyInstance(classLoader, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;cacheClazz&#125;, handler);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 抽象工厂</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JDKInvocationHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InvocationHandler</span> &#123;<br><br>    <span class="hljs-keyword">private</span> ICacheAdapter cacheAdapter;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">JDKInvocationHandler</span><span class="hljs-params">(ICacheAdapter cacheAdapter)</span> &#123;<br>        <span class="hljs-built_in">this</span>.cacheAdapter = cacheAdapter;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(Object proxy, Method method, Object[] args)</span> <span class="hljs-keyword">throws</span> Throwable &#123;<br>        <span class="hljs-keyword">return</span> ICacheAdapter.class.getMethod(method.getName(), ClassLoaderUtils.getClazzByArgs(args)).invoke(cacheAdapter, args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 单元测试</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApiTest</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(ApiTest.class);<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test_CacheService</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">CacheService</span> <span class="hljs-variable">proxy_EGM</span> <span class="hljs-operator">=</span> JDKProxyFactory.getProxy(CacheService.class, EGMCacheAdapter.class);<br>        proxy_EGM.set(<span class="hljs-string">&quot;user_name_01&quot;</span>, <span class="hljs-string">&quot;小明&quot;</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">val01</span> <span class="hljs-operator">=</span> proxy_EGM.get(<span class="hljs-string">&quot;user_name_01&quot;</span>);<br>        logger.info(<span class="hljs-string">&quot;缓存服务 EGM 测试，proxy_EGM.get 测试结果：&#123;&#125;&quot;</span>, val01);<br><br>        <span class="hljs-type">CacheService</span> <span class="hljs-variable">proxy_IIR</span> <span class="hljs-operator">=</span> JDKProxyFactory.getProxy(CacheService.class, IIRCacheAdapter.class);<br>        proxy_IIR.set(<span class="hljs-string">&quot;user_name_01&quot;</span>, <span class="hljs-string">&quot;小明&quot;</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">val02</span> <span class="hljs-operator">=</span> proxy_IIR.get(<span class="hljs-string">&quot;user_name_01&quot;</span>);<br>        logger.info(<span class="hljs-string">&quot;缓存服务 IIR 测试，proxy_IIR.get 测试结果：&#123;&#125;&quot;</span>, val02);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="建造者模式"><a href="#建造者模式" class="headerlink" title="建造者模式"></a>建造者模式</h2><blockquote>
<p>指将一个复杂对象的构造与它的表示分离，是同样的构造过程可以创建不同的表示。它是将一个复杂的对象分解为多个简单的对象，然后一步一步构建而成</p>
</blockquote>
<ul>
<li>各项装修物料组合套餐选配场景</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">IMenu</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 吊顶</span><br><span class="hljs-comment">     */</span><br>    IMenu <span class="hljs-title function_">appendCeiling</span><span class="hljs-params">(Matter matter)</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 涂料</span><br><span class="hljs-comment">     */</span><br>    IMenu <span class="hljs-title function_">appendCoat</span><span class="hljs-params">(Matter matter)</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 地板</span><br><span class="hljs-comment">     */</span><br>    IMenu <span class="hljs-title function_">appendFloor</span><span class="hljs-params">(Matter matter)</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 地砖</span><br><span class="hljs-comment">     */</span><br>    IMenu <span class="hljs-title function_">appendTile</span><span class="hljs-params">(Matter matter)</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 明细</span><br><span class="hljs-comment">     */</span><br>    String <span class="hljs-title function_">getDetail</span><span class="hljs-params">()</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 装修包</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DecorationPackageMenu</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IMenu</span> &#123;<br><br>    <span class="hljs-keyword">private</span> List&lt;Matter&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Matter&gt;();  <span class="hljs-comment">// 装修清单</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">price</span> <span class="hljs-operator">=</span> BigDecimal.ZERO;      <span class="hljs-comment">// 装修价格</span><br><br>    <span class="hljs-keyword">private</span> BigDecimal area;  <span class="hljs-comment">// 面积</span><br>    <span class="hljs-keyword">private</span> String grade;     <span class="hljs-comment">// 装修等级；豪华欧式、轻奢田园、现代简约</span><br><br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">DecorationPackageMenu</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">DecorationPackageMenu</span><span class="hljs-params">(Double area, String grade)</span> &#123;<br>        <span class="hljs-built_in">this</span>.area = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(area);<br>        <span class="hljs-built_in">this</span>.grade = grade;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> IMenu <span class="hljs-title function_">appendCeiling</span><span class="hljs-params">(Matter matter)</span> &#123;<br>        list.add(matter);<br>        price = price.add(area.multiply(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">&quot;0.2&quot;</span>)).multiply(matter.price()));<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> IMenu <span class="hljs-title function_">appendCoat</span><span class="hljs-params">(Matter matter)</span> &#123;<br>        list.add(matter);<br>        price = price.add(area.multiply(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">&quot;1.4&quot;</span>)).multiply(matter.price()));<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> IMenu <span class="hljs-title function_">appendFloor</span><span class="hljs-params">(Matter matter)</span> &#123;<br>        list.add(matter);<br>        price = price.add(area.multiply(matter.price()));<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> IMenu <span class="hljs-title function_">appendTile</span><span class="hljs-params">(Matter matter)</span> &#123;<br>        list.add(matter);<br>        price = price.add(area.multiply(matter.price()));<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getDetail</span><span class="hljs-params">()</span> &#123;<br><br>        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">detail</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>(<span class="hljs-string">&quot;\r\n-------------------------------------------------------\r\n&quot;</span> +<br>                <span class="hljs-string">&quot;装修清单&quot;</span> + <span class="hljs-string">&quot;\r\n&quot;</span> +<br>                <span class="hljs-string">&quot;套餐等级：&quot;</span> + grade + <span class="hljs-string">&quot;\r\n&quot;</span> +<br>                <span class="hljs-string">&quot;套餐价格：&quot;</span> + price.setScale(<span class="hljs-number">2</span>, BigDecimal.ROUND_HALF_UP) + <span class="hljs-string">&quot; 元\r\n&quot;</span> +<br>                <span class="hljs-string">&quot;房屋面积：&quot;</span> + area.doubleValue() + <span class="hljs-string">&quot; 平米\r\n&quot;</span> +<br>                <span class="hljs-string">&quot;材料清单：\r\n&quot;</span>);<br><br>        <span class="hljs-keyword">for</span> (Matter matter: list) &#123;<br>            detail.append(matter.scene()).append(<span class="hljs-string">&quot;：&quot;</span>).append(matter.brand()).append(<span class="hljs-string">&quot;、&quot;</span>).append(matter.model()).append(<span class="hljs-string">&quot;、平米价格：&quot;</span>).append(matter.price()).append(<span class="hljs-string">&quot; 元。\n&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> detail.toString();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Builder</span> &#123;<br><br>    <span class="hljs-keyword">public</span> IMenu <span class="hljs-title function_">levelOne</span><span class="hljs-params">(Double area)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DecorationPackageMenu</span>(area, <span class="hljs-string">&quot;豪华欧式&quot;</span>)<br>                .appendCeiling(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LevelTwoCeiling</span>())    <span class="hljs-comment">// 吊顶，二级顶</span><br>                .appendCoat(<span class="hljs-keyword">new</span> <span class="hljs-title class_">DuluxCoat</span>())             <span class="hljs-comment">// 涂料，多乐士</span><br>                .appendFloor(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ShengXiangFloor</span>());     <span class="hljs-comment">// 地板，圣象</span><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> IMenu <span class="hljs-title function_">levelTwo</span><span class="hljs-params">(Double area)</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DecorationPackageMenu</span>(area, <span class="hljs-string">&quot;轻奢田园&quot;</span>)<br>                .appendCeiling(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LevelTwoCeiling</span>())   <span class="hljs-comment">// 吊顶，二级顶</span><br>                .appendCoat(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LiBangCoat</span>())           <span class="hljs-comment">// 涂料，立邦</span><br>                .appendTile(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MarcoPoloTile</span>());       <span class="hljs-comment">// 地砖，马可波罗</span><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> IMenu <span class="hljs-title function_">levelThree</span><span class="hljs-params">(Double area)</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DecorationPackageMenu</span>(area, <span class="hljs-string">&quot;现代简约&quot;</span>)<br>                .appendCeiling(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LevelOneCeiling</span>())   <span class="hljs-comment">// 吊顶，一级顶</span><br>                .appendCoat(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LiBangCoat</span>())           <span class="hljs-comment">// 涂料，立邦</span><br>                .appendTile(<span class="hljs-keyword">new</span> <span class="hljs-title class_">DongPengTile</span>());        <span class="hljs-comment">// 地砖，东鹏</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="原型模式"><a href="#原型模式" class="headerlink" title="原型模式"></a>原型模式</h2><blockquote>
<p>用于创建重复的对象，同时又能保证性能。这种类型的设计模式属于创建型模式，它提供了一种创建对象的最佳方式</p>
</blockquote>
<ul>
<li>上机考试多套试，每人题目和答案乱序排列场景</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Topic</span> &#123;<br><br>    <span class="hljs-keyword">private</span> Map&lt;String, String&gt; option;  <span class="hljs-comment">// 选项；A、B、C、D</span><br>    <span class="hljs-keyword">private</span> String key;           <span class="hljs-comment">// 答案；B</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Topic</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Topic</span><span class="hljs-params">(Map&lt;String, String&gt; option, String key)</span> &#123;<br>        <span class="hljs-built_in">this</span>.option = option;<br>        <span class="hljs-built_in">this</span>.key = key;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Map&lt;String, String&gt; <span class="hljs-title function_">getOption</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> option;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setOption</span><span class="hljs-params">(Map&lt;String, String&gt; option)</span> &#123;<br>        <span class="hljs-built_in">this</span>.option = option;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getKey</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> key;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setKey</span><span class="hljs-params">(String key)</span> &#123;<br>        <span class="hljs-built_in">this</span>.key = key;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TopicRandomUtil</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 乱序Map元素，记录对应答案key</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> option 题目</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key    答案</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> Topic 乱序后 &#123;A=c., B=d., C=a., D=b.&#125;</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">public</span> Topic <span class="hljs-title function_">random</span><span class="hljs-params">(Map&lt;String, String&gt; option, String key)</span> &#123;<br>        Set&lt;String&gt; keySet = option.keySet();<br>        ArrayList&lt;String&gt; keyList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;String&gt;(keySet);<br>        Collections.shuffle(keyList);<br>        HashMap&lt;String, String&gt; optionNew = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;String, String&gt;();<br>        <span class="hljs-type">int</span> <span class="hljs-variable">idx</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">keyNew</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;</span>;<br>        <span class="hljs-keyword">for</span> (String next : keySet) &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">randomKey</span> <span class="hljs-operator">=</span> keyList.get(idx++);<br>            <span class="hljs-keyword">if</span> (key.equals(next)) &#123;<br>                keyNew = randomKey;<br>            &#125;<br>            optionNew.put(randomKey, option.get(next));<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Topic</span>(optionNew, keyNew);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 题库</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">QuestionBank</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Cloneable</span>&#123;<br><br>    <span class="hljs-keyword">private</span> String candidate; <span class="hljs-comment">// 考生</span><br>    <span class="hljs-keyword">private</span> String number;    <span class="hljs-comment">// 考号</span><br><br>    <span class="hljs-keyword">private</span> ArrayList&lt;ChoiceQuestion&gt; choiceQuestionList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>    <span class="hljs-keyword">private</span> ArrayList&lt;AnswerQuestion&gt; answerQuestionList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br><br>    <span class="hljs-keyword">public</span> QuestionBank <span class="hljs-title function_">append</span><span class="hljs-params">(ChoiceQuestion choiceQuestion)</span> &#123;<br>        choiceQuestionList.add(choiceQuestion);<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> QuestionBank <span class="hljs-title function_">append</span><span class="hljs-params">(AnswerQuestion answerQuestion)</span> &#123;<br>        answerQuestionList.add(answerQuestion);<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">clone</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> CloneNotSupportedException &#123;<br>        <span class="hljs-type">QuestionBank</span> <span class="hljs-variable">questionBank</span> <span class="hljs-operator">=</span> (QuestionBank) <span class="hljs-built_in">super</span>.clone();<br>        questionBank.choiceQuestionList = (ArrayList&lt;ChoiceQuestion&gt;) choiceQuestionList.clone();<br>        questionBank.answerQuestionList = (ArrayList&lt;AnswerQuestion&gt;) answerQuestionList.clone();<br><br>        <span class="hljs-comment">// 题目乱序</span><br>        Collections.shuffle(questionBank.choiceQuestionList);<br>        Collections.shuffle(questionBank.answerQuestionList);<br><br>        <span class="hljs-comment">// 答案乱序</span><br>        ArrayList&lt;ChoiceQuestion&gt; choiceQuestionList = questionBank.choiceQuestionList;<br>        <span class="hljs-keyword">for</span> (ChoiceQuestion question : choiceQuestionList) &#123;<br>            <span class="hljs-type">Topic</span> <span class="hljs-variable">random</span> <span class="hljs-operator">=</span> TopicRandomUtil.random(question.getOption(), question.getKey());<br>            question.setOption(random.getOption());<br>            question.setKey(random.getKey());<br>        &#125;<br>        <span class="hljs-keyword">return</span> questionBank;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setCandidate</span><span class="hljs-params">(String candidate)</span> &#123;<br>        <span class="hljs-built_in">this</span>.candidate = candidate;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setNumber</span><span class="hljs-params">(String number)</span> &#123;<br>        <span class="hljs-built_in">this</span>.number = number;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br><br>        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">detail</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>(<span class="hljs-string">&quot;考生：&quot;</span> + candidate + <span class="hljs-string">&quot;\r\n&quot;</span> +<br>                <span class="hljs-string">&quot;考号：&quot;</span> + number + <span class="hljs-string">&quot;\r\n&quot;</span> +<br>                <span class="hljs-string">&quot;--------------------------------------------\r\n&quot;</span> +<br>                <span class="hljs-string">&quot;一、选择题&quot;</span> + <span class="hljs-string">&quot;\r\n\n&quot;</span>);<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">idx</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; idx &lt; choiceQuestionList.size(); idx++) &#123;<br>            detail.append(<span class="hljs-string">&quot;第&quot;</span>).append(idx + <span class="hljs-number">1</span>).append(<span class="hljs-string">&quot;题：&quot;</span>).append(choiceQuestionList.get(idx).getName()).append(<span class="hljs-string">&quot;\r\n&quot;</span>);<br>            Map&lt;String, String&gt; option = choiceQuestionList.get(idx).getOption();<br>            <span class="hljs-keyword">for</span> (String key : option.keySet()) &#123;<br>                detail.append(key).append(<span class="hljs-string">&quot;：&quot;</span>).append(option.get(key)).append(<span class="hljs-string">&quot;\r\n&quot;</span>);;<br>            &#125;<br>            detail.append(<span class="hljs-string">&quot;答案：&quot;</span>).append(choiceQuestionList.get(idx).getKey()).append(<span class="hljs-string">&quot;\r\n\n&quot;</span>);<br>        &#125;<br><br>        detail.append(<span class="hljs-string">&quot;二、问答题&quot;</span> + <span class="hljs-string">&quot;\r\n\n&quot;</span>);<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">idx</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; idx &lt; answerQuestionList.size(); idx++) &#123;<br>            detail.append(<span class="hljs-string">&quot;第&quot;</span>).append(idx + <span class="hljs-number">1</span>).append(<span class="hljs-string">&quot;题：&quot;</span>).append(answerQuestionList.get(idx).getName()).append(<span class="hljs-string">&quot;\r\n&quot;</span>);<br>            detail.append(<span class="hljs-string">&quot;答案：&quot;</span>).append(answerQuestionList.get(idx).getKey()).append(<span class="hljs-string">&quot;\r\n\n&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> detail.toString();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 题库管理</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">QuestionBankController</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">QuestionBank</span> <span class="hljs-variable">questionBank</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">QuestionBank</span>();<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">QuestionBankController</span><span class="hljs-params">()</span> &#123;<br>        questionBank.append(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ChoiceQuestion</span>(<span class="hljs-string">&quot;JAVA所定义的版本中不包括&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;String, String&gt;() &#123;&#123;<br>            put(<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-string">&quot;JAVA2 EE&quot;</span>);<br>            put(<span class="hljs-string">&quot;B&quot;</span>, <span class="hljs-string">&quot;JAVA2 Card&quot;</span>);<br>            put(<span class="hljs-string">&quot;C&quot;</span>, <span class="hljs-string">&quot;JAVA2 ME&quot;</span>);<br>            put(<span class="hljs-string">&quot;D&quot;</span>, <span class="hljs-string">&quot;JAVA2 HE&quot;</span>);<br>            put(<span class="hljs-string">&quot;E&quot;</span>, <span class="hljs-string">&quot;JAVA2 SE&quot;</span>);<br>        &#125;&#125;, <span class="hljs-string">&quot;D&quot;</span>)).append(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ChoiceQuestion</span>(<span class="hljs-string">&quot;下列说法正确的是&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;String, String&gt;() &#123;&#123;<br>            put(<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-string">&quot;JAVA程序的main方法必须写在类里面&quot;</span>);<br>            put(<span class="hljs-string">&quot;B&quot;</span>, <span class="hljs-string">&quot;JAVA程序中可以有多个main方法&quot;</span>);<br>            put(<span class="hljs-string">&quot;C&quot;</span>, <span class="hljs-string">&quot;JAVA程序中类名必须与文件名一样&quot;</span>);<br>            put(<span class="hljs-string">&quot;D&quot;</span>, <span class="hljs-string">&quot;JAVA程序的main方法中如果只有一条语句，可以不用&#123;&#125;(大括号)括起来&quot;</span>);<br>        &#125;&#125;, <span class="hljs-string">&quot;A&quot;</span>)).append(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ChoiceQuestion</span>(<span class="hljs-string">&quot;变量命名规范说法正确的是&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;String, String&gt;() &#123;&#123;<br>            put(<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-string">&quot;变量由字母、下划线、数字、$符号随意组成；&quot;</span>);<br>            put(<span class="hljs-string">&quot;B&quot;</span>, <span class="hljs-string">&quot;变量不能以数字作为开头；&quot;</span>);<br>            put(<span class="hljs-string">&quot;C&quot;</span>, <span class="hljs-string">&quot;A和a在java中是同一个变量；&quot;</span>);<br>            put(<span class="hljs-string">&quot;D&quot;</span>, <span class="hljs-string">&quot;不同类型的变量，可以起相同的名字；&quot;</span>);<br>        &#125;&#125;, <span class="hljs-string">&quot;B&quot;</span>)).append(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ChoiceQuestion</span>(<span class="hljs-string">&quot;以下()不是合法的标识符&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;String, String&gt;() &#123;&#123;<br>            put(<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-string">&quot;STRING&quot;</span>);<br>            put(<span class="hljs-string">&quot;B&quot;</span>, <span class="hljs-string">&quot;x3x;&quot;</span>);<br>            put(<span class="hljs-string">&quot;C&quot;</span>, <span class="hljs-string">&quot;void&quot;</span>);<br>            put(<span class="hljs-string">&quot;D&quot;</span>, <span class="hljs-string">&quot;de$f&quot;</span>);<br>        &#125;&#125;, <span class="hljs-string">&quot;C&quot;</span>)).append(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ChoiceQuestion</span>(<span class="hljs-string">&quot;表达式(11+3*8)/4%3的值是&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;String, String&gt;() &#123;&#123;<br>            put(<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-string">&quot;31&quot;</span>);<br>            put(<span class="hljs-string">&quot;B&quot;</span>, <span class="hljs-string">&quot;0&quot;</span>);<br>            put(<span class="hljs-string">&quot;C&quot;</span>, <span class="hljs-string">&quot;1&quot;</span>);<br>            put(<span class="hljs-string">&quot;D&quot;</span>, <span class="hljs-string">&quot;2&quot;</span>);<br>        &#125;&#125;, <span class="hljs-string">&quot;D&quot;</span>))<br>                .append(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AnswerQuestion</span>(<span class="hljs-string">&quot;小红马和小黑马生的小马几条腿&quot;</span>, <span class="hljs-string">&quot;4条腿&quot;</span>))<br>                .append(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AnswerQuestion</span>(<span class="hljs-string">&quot;铁棒打头疼还是木棒打头疼&quot;</span>, <span class="hljs-string">&quot;头最疼&quot;</span>))<br>                .append(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AnswerQuestion</span>(<span class="hljs-string">&quot;什么床不能睡觉&quot;</span>, <span class="hljs-string">&quot;牙床&quot;</span>))<br>                .append(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AnswerQuestion</span>(<span class="hljs-string">&quot;为什么好马不吃回头草&quot;</span>, <span class="hljs-string">&quot;后面的草没了&quot;</span>));<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">createPaper</span><span class="hljs-params">(String candidate, String number)</span> <span class="hljs-keyword">throws</span> CloneNotSupportedException &#123;<br>        <span class="hljs-type">QuestionBank</span> <span class="hljs-variable">questionBankClone</span> <span class="hljs-operator">=</span> (QuestionBank) questionBank.clone();<br>        questionBankClone.setCandidate(candidate);<br>        questionBankClone.setNumber(number);<br>        <span class="hljs-keyword">return</span> questionBankClone.toString();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApiTest</span> &#123;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test_QuestionBank</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> CloneNotSupportedException &#123;<br>        <span class="hljs-type">QuestionBankController</span> <span class="hljs-variable">questionBankController</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">QuestionBankController</span>();<br>        System.out.println(questionBankController.createPaper(<span class="hljs-string">&quot;花花&quot;</span>, <span class="hljs-string">&quot;1000001921032&quot;</span>));<br>        System.out.println(questionBankController.createPaper(<span class="hljs-string">&quot;豆豆&quot;</span>, <span class="hljs-string">&quot;1000001921051&quot;</span>));<br>        System.out.println(questionBankController.createPaper(<span class="hljs-string">&quot;大宝&quot;</span>, <span class="hljs-string">&quot;1000001921987&quot;</span>));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="单例模式"><a href="#单例模式" class="headerlink" title="单例模式"></a>单例模式</h2><blockquote>
<p>最简单的设计模式之一。这种类型的设计模式属于创建型模式，它提供了一种创建对象的最佳方式</p>
</blockquote>
<ul>
<li>7种单例模式案例，推荐枚举单例模式</li>
</ul>
<p><strong>原则</strong></p>
<ul>
<li>私有构造（阻止类被通过常规方法实例化）</li>
<li>以静态方法或者枚举返回实例（保证实例的唯一性）</li>
<li>确保实例只有一个，尤其是多线程环境（保证在创建实例时的线程安全）</li>
<li>确保反序列化时不会重新构建对象（在有序列化反序列化的场景下防止单例被莫名破坏，造成未考虑到的后果）</li>
</ul>
<p><strong>手段</strong></p>
<ul>
<li>主动处理<ul>
<li>synchronized</li>
<li>volatitle</li>
<li>cas</li>
</ul>
</li>
<li>JVM机制<ul>
<li>由静态初始化器（在静态字段上或static{}块中的初始化器）初始化数据时</li>
<li>访问final字段时</li>
<li>在创建线程之前创建对象时</li>
<li>线程可以看见它将要处理的对象时</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * 饿汉模式(线程安全)</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton_03</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">Singleton_03</span> <span class="hljs-variable">instance</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton_03</span>();<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Singleton_03</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Singleton_03 <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> instance;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * 懒汉模式(线程不安全)</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton_01</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Singleton_01 instance;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Singleton_01</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Singleton_01 <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> != instance) <span class="hljs-keyword">return</span> instance;<br>        instance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton_01</span>();<br>        <span class="hljs-keyword">return</span> instance;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * 双重锁校验</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton_05</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">volatile</span> Singleton_05 instance;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Singleton_05</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Singleton_05 <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span>&#123;<br>       <span class="hljs-keyword">if</span>(<span class="hljs-literal">null</span> != instance) <span class="hljs-keyword">return</span> instance;<br>       <span class="hljs-keyword">synchronized</span> (Singleton_05.class)&#123;<br>           <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> == instance)&#123;<br>               instance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton_05</span>();<br>           &#125;<br>       &#125;<br>       <span class="hljs-keyword">return</span> instance;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * 类的内部类</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton_04</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SingletonHolder</span> &#123;<br>        <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">Singleton_04</span> <span class="hljs-variable">instance</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton_04</span>();<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Singleton_04</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Singleton_04 <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> SingletonHolder.instance;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * CAS</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton_06</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> AtomicReference&lt;Singleton_06&gt; INSTANCE = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicReference</span>&lt;Singleton_06&gt;();<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Singleton_06 instance;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Singleton_06</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Singleton_06 <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">for</span> (; ; ) &#123;<br>            <span class="hljs-type">Singleton_06</span> <span class="hljs-variable">instance</span> <span class="hljs-operator">=</span> INSTANCE.get();<br>            <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> != instance) <span class="hljs-keyword">return</span> instance;<br>            INSTANCE.compareAndSet(<span class="hljs-literal">null</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton_06</span>());<br>            <span class="hljs-keyword">return</span> INSTANCE.get();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * 枚举单例</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">Singleton_07</span> &#123;<br><br>    INSTANCE;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;hi~&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="适配器模式"><a href="#适配器模式" class="headerlink" title="适配器模式"></a>适配器模式</h2><blockquote>
<p>将一个类的接口适配成用户所期待的。一个适配允许通常因为接口不兼容而不能在一起工作的类工作在一起，做法是将类自己的接口包裹在一个已存在的类中</p>
</blockquote>
<ul>
<li>从多个MQ消息体中，抽取指定字段值场景</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 适配接口</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">OrderAdapterService</span> &#123;<br><br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">isFirst</span><span class="hljs-params">(String uId)</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 内部订单，判断首单逻辑</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InsideOrderServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">OrderAdapterService</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">OrderService</span> <span class="hljs-variable">orderService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderService</span>();<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isFirst</span><span class="hljs-params">(String uId)</span> &#123;<br>        <span class="hljs-keyword">return</span> orderService.queryUserOrderCount(uId) &lt;= <span class="hljs-number">1</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 第三方订单，判断首单逻辑</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">POPOrderAdapterServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">OrderAdapterService</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">POPOrderService</span> <span class="hljs-variable">popOrderService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">POPOrderService</span>();<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isFirst</span><span class="hljs-params">(String uId)</span> &#123;<br>        <span class="hljs-keyword">return</span> popOrderService.isFirstOrder(uId);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 字段</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RebateInfo</span> &#123;<br><br>    <span class="hljs-keyword">private</span> String userId;<br>    <span class="hljs-keyword">private</span> String bizId;<br>    <span class="hljs-keyword">private</span> String bizTime;<br>    <span class="hljs-keyword">private</span> String desc;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getUserId</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> userId;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUserId</span><span class="hljs-params">(String userId)</span> &#123;<br>        <span class="hljs-built_in">this</span>.userId = userId;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getBizId</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> bizId;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setBizId</span><span class="hljs-params">(String bizId)</span> &#123;<br>        <span class="hljs-built_in">this</span>.bizId = bizId;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getBizTime</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> bizTime;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setBizTime</span><span class="hljs-params">(String bizTime)</span> &#123;<br>        <span class="hljs-built_in">this</span>.bizTime = bizTime;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getDesc</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> desc;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setDesc</span><span class="hljs-params">(String desc)</span> &#123;<br>        <span class="hljs-built_in">this</span>.desc = desc;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 适配器</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MQAdapter</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> RebateInfo <span class="hljs-title function_">filter</span><span class="hljs-params">(String strJson, Map&lt;String, String&gt; link)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-keyword">return</span> filter(JSON.parseObject(strJson, Map.class), link);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> RebateInfo <span class="hljs-title function_">filter</span><span class="hljs-params">(Map obj, Map&lt;String, String&gt; link)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">RebateInfo</span> <span class="hljs-variable">rebateInfo</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RebateInfo</span>();<br>        <span class="hljs-keyword">for</span> (String key : link.keySet()) &#123;<br>            <span class="hljs-type">Object</span> <span class="hljs-variable">val</span> <span class="hljs-operator">=</span> obj.get(link.get(key));<br>            RebateInfo.class.getMethod(<span class="hljs-string">&quot;set&quot;</span> + key.substring(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>).toUpperCase() + key.substring(<span class="hljs-number">1</span>), String.class).invoke(rebateInfo, val.toString());<br>        &#125;<br>        <span class="hljs-keyword">return</span> rebateInfo;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApiTest</span> &#123;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test_MQAdapter</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">SimpleDateFormat</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleDateFormat</span>(<span class="hljs-string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);<br>        <span class="hljs-type">Date</span> <span class="hljs-variable">parse</span> <span class="hljs-operator">=</span> s.parse(<span class="hljs-string">&quot;2020-06-01 23:20:16&quot;</span>);<br><br>        <span class="hljs-type">create_account</span> <span class="hljs-variable">create_account</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">create_account</span>();<br>        create_account.setNumber(<span class="hljs-string">&quot;100001&quot;</span>);<br>        create_account.setAddress(<span class="hljs-string">&quot;江苏省.连云港市.海州区.大学里职业技术学院&quot;</span>);<br>        create_account.setAccountDate(parse);<br>        create_account.setDesc(<span class="hljs-string">&quot;在校开户&quot;</span>);<br><br>        HashMap&lt;String, String&gt; link01 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;String, String&gt;();<br>        link01.put(<span class="hljs-string">&quot;userId&quot;</span>, <span class="hljs-string">&quot;number&quot;</span>);<br>        link01.put(<span class="hljs-string">&quot;bizId&quot;</span>, <span class="hljs-string">&quot;number&quot;</span>);<br>        link01.put(<span class="hljs-string">&quot;bizTime&quot;</span>, <span class="hljs-string">&quot;accountDate&quot;</span>);<br>        link01.put(<span class="hljs-string">&quot;desc&quot;</span>, <span class="hljs-string">&quot;desc&quot;</span>);<br><br>        <span class="hljs-type">RebateInfo</span> <span class="hljs-variable">rebateInfo01</span> <span class="hljs-operator">=</span> MQAdapter.filter(create_account.toString(), link01);<br>        System.out.println(<span class="hljs-string">&quot;mq.create_account(适配前)&quot;</span> + create_account.toString());<br>        System.out.println(<span class="hljs-string">&quot;mq.create_account(适配后)&quot;</span> + JSON.toJSONString(rebateInfo01));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="桥接模式"><a href="#桥接模式" class="headerlink" title="桥接模式"></a>桥接模式</h2><blockquote>
<p>是一种结构型设计模式，可将一个大类或一系列紧密相关的类拆分为抽象和实现两个独立的层次结构，从而能在开发时分别使用</p>
</blockquote>
<ul>
<li>多支付渠道（微信、支付宝）与多支付模式（刷脸、指纹）场景</li>
</ul>
<p><strong>支付模式</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">IPayMode</span> &#123;<br><br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">security</span><span class="hljs-params">(String uId)</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PayCypher</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IPayMode</span>&#123;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(PayCypher.class);<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">security</span><span class="hljs-params">(String uId)</span> &#123;<br>        logger.info(<span class="hljs-string">&quot;密码支付，风控校验环境安全&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PayFaceMode</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IPayMode</span>&#123;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(PayCypher.class);<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">security</span><span class="hljs-params">(String uId)</span> &#123;<br>        logger.info(<span class="hljs-string">&quot;人脸支付，风控校验脸部识别&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PayFingerprintMode</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IPayMode</span>&#123;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(PayCypher.class);<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">security</span><span class="hljs-params">(String uId)</span> &#123;<br>        logger.info(<span class="hljs-string">&quot;指纹支付，风控校验指纹信息&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<p><strong>支付渠道</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Pay</span> &#123;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(Pay.class);<br><br>    <span class="hljs-keyword">protected</span> IPayMode payMode;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Pay</span><span class="hljs-params">(IPayMode payMode)</span> &#123;<br>        <span class="hljs-built_in">this</span>.payMode = payMode;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> String <span class="hljs-title function_">transfer</span><span class="hljs-params">(String uId, String tradeId, BigDecimal amount)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WxPay</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Pay</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">WxPay</span><span class="hljs-params">(IPayMode payMode)</span> &#123;<br>        <span class="hljs-built_in">super</span>(payMode);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">transfer</span><span class="hljs-params">(String uId, String tradeId, BigDecimal amount)</span> &#123;<br>        logger.info(<span class="hljs-string">&quot;模拟微信渠道支付划账开始。uId：&#123;&#125; tradeId：&#123;&#125; amount：&#123;&#125;&quot;</span>, uId, tradeId, amount);<br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">security</span> <span class="hljs-operator">=</span> payMode.security(uId);<br>        logger.info(<span class="hljs-string">&quot;模拟微信渠道支付风控校验。uId：&#123;&#125; tradeId：&#123;&#125; security：&#123;&#125;&quot;</span>, uId, tradeId, security);<br>        <span class="hljs-keyword">if</span> (!security) &#123;<br>            logger.info(<span class="hljs-string">&quot;模拟微信渠道支付划账拦截。uId：&#123;&#125; tradeId：&#123;&#125; amount：&#123;&#125;&quot;</span>, uId, tradeId, amount);<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;0001&quot;</span>;<br>        &#125;<br>        logger.info(<span class="hljs-string">&quot;模拟微信渠道支付划账成功。uId：&#123;&#125; tradeId：&#123;&#125; amount：&#123;&#125;&quot;</span>, uId, tradeId, amount);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;0000&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ZfbPay</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Pay</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ZfbPay</span><span class="hljs-params">(IPayMode payMode)</span> &#123;<br>        <span class="hljs-built_in">super</span>(payMode);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">transfer</span><span class="hljs-params">(String uId, String tradeId, BigDecimal amount)</span> &#123;<br>        logger.info(<span class="hljs-string">&quot;模拟支付宝渠道支付划账开始。uId：&#123;&#125; tradeId：&#123;&#125; amount：&#123;&#125;&quot;</span>, uId, tradeId, amount);<br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">security</span> <span class="hljs-operator">=</span> payMode.security(uId);<br>        logger.info(<span class="hljs-string">&quot;模拟支付宝渠道支付风控校验。uId：&#123;&#125; tradeId：&#123;&#125; security：&#123;&#125;&quot;</span>, uId, tradeId, security);<br>        <span class="hljs-keyword">if</span> (!security) &#123;<br>            logger.info(<span class="hljs-string">&quot;模拟支付宝渠道支付划账拦截。uId：&#123;&#125; tradeId：&#123;&#125; amount：&#123;&#125;&quot;</span>, uId, tradeId, amount);<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;0001&quot;</span>;<br>        &#125;<br>        logger.info(<span class="hljs-string">&quot;模拟支付宝渠道支付划账成功。uId：&#123;&#125; tradeId：&#123;&#125; amount：&#123;&#125;&quot;</span>, uId, tradeId, amount);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;0000&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * 测试验证</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApiTest</span> &#123;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test_pay</span><span class="hljs-params">()</span> &#123;<br><br>        System.out.println(<span class="hljs-string">&quot;\r\n模拟测试场景；微信支付、人脸方式。&quot;</span>);<br>        <span class="hljs-type">Pay</span> <span class="hljs-variable">wxPay</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WxPay</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PayFaceMode</span>());<br>        wxPay.transfer(<span class="hljs-string">&quot;weixin_1092033111&quot;</span>, <span class="hljs-string">&quot;100000109893&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-number">100</span>));<br><br>        System.out.println(<span class="hljs-string">&quot;\r\n模拟测试场景；支付宝支付、指纹方式。&quot;</span>);<br>        <span class="hljs-type">Pay</span> <span class="hljs-variable">zfbPay</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ZfbPay</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PayFingerprintMode</span>());<br>        zfbPay.transfer(<span class="hljs-string">&quot;jlu19dlxo111&quot;</span>, <span class="hljs-string">&quot;100000109894&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-number">100</span>));<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="组合模式"><a href="#组合模式" class="headerlink" title="组合模式"></a>组合模式</h2><blockquote>
<p>也成为整体-部分模式，它的宗旨是通过将单个对象（叶子节点）和组合对象（树枝节点）用相同的接口进行表示，使得客户对单个对象和组合对象的使用具有一致性</p>
</blockquote>
<ul>
<li>营销差异化人群发券，决策树引擎搭建场景</li>
</ul>
<p><strong>充血模型</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 决策结果</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EngineResult</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> isSuccess; <span class="hljs-comment">//执行结果</span><br>    <span class="hljs-keyword">private</span> String userId;   <span class="hljs-comment">//用户ID</span><br>    <span class="hljs-keyword">private</span> Long treeId;     <span class="hljs-comment">//规则树ID</span><br>    <span class="hljs-keyword">private</span> Long nodeId;   <span class="hljs-comment">//果实节点ID</span><br>    <span class="hljs-keyword">private</span> String nodeValue;<span class="hljs-comment">//果实节点值</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">EngineResult</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">EngineResult</span><span class="hljs-params">(<span class="hljs-type">boolean</span> isSuccess)</span> &#123;<br>        <span class="hljs-built_in">this</span>.isSuccess = isSuccess;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">EngineResult</span><span class="hljs-params">(String userId, Long treeId, Long nodeId, String nodeValue)</span> &#123;<br>        <span class="hljs-built_in">this</span>.isSuccess = <span class="hljs-literal">true</span>;<br>        <span class="hljs-built_in">this</span>.userId = userId;<br>        <span class="hljs-built_in">this</span>.treeId = treeId;<br>        <span class="hljs-built_in">this</span>.nodeId = nodeId;<br>        <span class="hljs-built_in">this</span>.nodeValue = nodeValue;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isSuccess</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> isSuccess;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setSuccess</span><span class="hljs-params">(<span class="hljs-type">boolean</span> success)</span> &#123;<br>        isSuccess = success;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getUserId</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> userId;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUserId</span><span class="hljs-params">(String userId)</span> &#123;<br>        <span class="hljs-built_in">this</span>.userId = userId;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getTreeId</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> treeId;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setTreeId</span><span class="hljs-params">(Long treeId)</span> &#123;<br>        <span class="hljs-built_in">this</span>.treeId = treeId;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getNodeId</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> nodeId;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setNodeId</span><span class="hljs-params">(Long nodeId)</span> &#123;<br>        <span class="hljs-built_in">this</span>.nodeId = nodeId;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getNodeValue</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> nodeValue;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setNodeValue</span><span class="hljs-params">(String nodeValue)</span> &#123;<br>        <span class="hljs-built_in">this</span>.nodeValue = nodeValue;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 规则树节点信息</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TreeNode</span> &#123;<br><br>    <span class="hljs-keyword">private</span> Long treeId;            <span class="hljs-comment">//规则树ID</span><br>    <span class="hljs-keyword">private</span> Long treeNodeId;        <span class="hljs-comment">//规则树节点ID</span><br>    <span class="hljs-keyword">private</span> Integer nodeType;       <span class="hljs-comment">//节点类型；1子叶、2果实</span><br>    <span class="hljs-keyword">private</span> String nodeValue;       <span class="hljs-comment">//节点值[nodeType=2]；果实值</span><br>    <span class="hljs-keyword">private</span> String ruleKey;         <span class="hljs-comment">//规则Key</span><br>    <span class="hljs-keyword">private</span> String ruleDesc;        <span class="hljs-comment">//规则描述</span><br>    <span class="hljs-keyword">private</span> List&lt;TreeNodeLink&gt; treeNodeLinkList; <span class="hljs-comment">//节点链路</span><br><br>    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getTreeId</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> treeId;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setTreeId</span><span class="hljs-params">(Long treeId)</span> &#123;<br>        <span class="hljs-built_in">this</span>.treeId = treeId;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getTreeNodeId</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> treeNodeId;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setTreeNodeId</span><span class="hljs-params">(Long treeNodeId)</span> &#123;<br>        <span class="hljs-built_in">this</span>.treeNodeId = treeNodeId;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">getNodeType</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> nodeType;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setNodeType</span><span class="hljs-params">(Integer nodeType)</span> &#123;<br>        <span class="hljs-built_in">this</span>.nodeType = nodeType;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getNodeValue</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> nodeValue;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setNodeValue</span><span class="hljs-params">(String nodeValue)</span> &#123;<br>        <span class="hljs-built_in">this</span>.nodeValue = nodeValue;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getRuleKey</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> ruleKey;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setRuleKey</span><span class="hljs-params">(String ruleKey)</span> &#123;<br>        <span class="hljs-built_in">this</span>.ruleKey = ruleKey;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getRuleDesc</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> ruleDesc;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setRuleDesc</span><span class="hljs-params">(String ruleDesc)</span> &#123;<br>        <span class="hljs-built_in">this</span>.ruleDesc = ruleDesc;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> List&lt;TreeNodeLink&gt; <span class="hljs-title function_">getTreeNodeLinkList</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> treeNodeLinkList;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setTreeNodeLinkList</span><span class="hljs-params">(List&lt;TreeNodeLink&gt; treeNodeLinkList)</span> &#123;<br>        <span class="hljs-built_in">this</span>.treeNodeLinkList = treeNodeLinkList;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 规则树线信息</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TreeNodeLink</span> &#123;<br><br>    <span class="hljs-keyword">private</span> Long nodeIdFrom;        <span class="hljs-comment">//节点From</span><br>    <span class="hljs-keyword">private</span> Long nodeIdTo;          <span class="hljs-comment">//节点To</span><br>    <span class="hljs-keyword">private</span> Integer ruleLimitType;  <span class="hljs-comment">//限定类型；1:=;2:&gt;;3:&lt;;4:&gt;=;5&lt;=;6:enum[枚举范围]</span><br>    <span class="hljs-keyword">private</span> String ruleLimitValue;  <span class="hljs-comment">//限定值</span><br><br>    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getNodeIdFrom</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> nodeIdFrom;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setNodeIdFrom</span><span class="hljs-params">(Long nodeIdFrom)</span> &#123;<br>        <span class="hljs-built_in">this</span>.nodeIdFrom = nodeIdFrom;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getNodeIdTo</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> nodeIdTo;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setNodeIdTo</span><span class="hljs-params">(Long nodeIdTo)</span> &#123;<br>        <span class="hljs-built_in">this</span>.nodeIdTo = nodeIdTo;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">getRuleLimitType</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> ruleLimitType;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setRuleLimitType</span><span class="hljs-params">(Integer ruleLimitType)</span> &#123;<br>        <span class="hljs-built_in">this</span>.ruleLimitType = ruleLimitType;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getRuleLimitValue</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> ruleLimitValue;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setRuleLimitValue</span><span class="hljs-params">(String ruleLimitValue)</span> &#123;<br>        <span class="hljs-built_in">this</span>.ruleLimitValue = ruleLimitValue;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 树根信息</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TreeRoot</span> &#123;<br><br>    <span class="hljs-keyword">private</span> Long treeId;         <span class="hljs-comment">//规则树ID</span><br>    <span class="hljs-keyword">private</span> Long treeRootNodeId; <span class="hljs-comment">//规则树根ID</span><br>    <span class="hljs-keyword">private</span> String treeName;     <span class="hljs-comment">//规则树名称</span><br><br>    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getTreeId</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> treeId;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setTreeId</span><span class="hljs-params">(Long treeId)</span> &#123;<br>        <span class="hljs-built_in">this</span>.treeId = treeId;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getTreeRootNodeId</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> treeRootNodeId;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setTreeRootNodeId</span><span class="hljs-params">(Long treeRootNodeId)</span> &#123;<br>        <span class="hljs-built_in">this</span>.treeRootNodeId = treeRootNodeId;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getTreeName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> treeName;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setTreeName</span><span class="hljs-params">(String treeName)</span> &#123;<br>        <span class="hljs-built_in">this</span>.treeName = treeName;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<p><strong>聚合对象</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 规则树聚合</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TreeRich</span> &#123;<br><br>    <span class="hljs-keyword">private</span> TreeRoot treeRoot;                          <span class="hljs-comment">//树根信息</span><br>    <span class="hljs-keyword">private</span> Map&lt;Long, TreeNode&gt; treeNodeMap;        <span class="hljs-comment">//树节点ID -&gt; 子节点</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">TreeRich</span><span class="hljs-params">(TreeRoot treeRoot, Map&lt;Long, TreeNode&gt; treeNodeMap)</span> &#123;<br>        <span class="hljs-built_in">this</span>.treeRoot = treeRoot;<br>        <span class="hljs-built_in">this</span>.treeNodeMap = treeNodeMap;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> TreeRoot <span class="hljs-title function_">getTreeRoot</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> treeRoot;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setTreeRoot</span><span class="hljs-params">(TreeRoot treeRoot)</span> &#123;<br>        <span class="hljs-built_in">this</span>.treeRoot = treeRoot;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Map&lt;Long, TreeNode&gt; <span class="hljs-title function_">getTreeNodeMap</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> treeNodeMap;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setTreeNodeMap</span><span class="hljs-params">(Map&lt;Long, TreeNode&gt; treeNodeMap)</span> &#123;<br>        <span class="hljs-built_in">this</span>.treeNodeMap = treeNodeMap;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<p><strong>逻辑处理类</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BaseLogic</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">LogicFilter</span>&#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">filter</span><span class="hljs-params">(String matterValue, List&lt;TreeNodeLink&gt; treeNodeLinkList)</span> &#123;<br>        <span class="hljs-keyword">for</span> (TreeNodeLink nodeLine : treeNodeLinkList) &#123;<br>            <span class="hljs-keyword">if</span> (decisionLogic(matterValue, nodeLine)) <span class="hljs-keyword">return</span> nodeLine.getNodeIdTo();<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0L</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> String <span class="hljs-title function_">matterValue</span><span class="hljs-params">(Long treeId, String userId, Map&lt;String, String&gt; decisionMatter)</span>;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">decisionLogic</span><span class="hljs-params">(String matterValue, TreeNodeLink nodeLink)</span> &#123;<br>        <span class="hljs-keyword">switch</span> (nodeLink.getRuleLimitType()) &#123;<br>            <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<br>                <span class="hljs-keyword">return</span> matterValue.equals(nodeLink.getRuleLimitValue());<br>            <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<br>                <span class="hljs-keyword">return</span> Double.parseDouble(matterValue) &gt; Double.parseDouble(nodeLink.getRuleLimitValue());<br>            <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<br>                <span class="hljs-keyword">return</span> Double.parseDouble(matterValue) &lt; Double.parseDouble(nodeLink.getRuleLimitValue());<br>            <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>:<br>                <span class="hljs-keyword">return</span> Double.parseDouble(matterValue) &lt;= Double.parseDouble(nodeLink.getRuleLimitValue());<br>            <span class="hljs-keyword">case</span> <span class="hljs-number">5</span>:<br>                <span class="hljs-keyword">return</span> Double.parseDouble(matterValue) &gt;= Double.parseDouble(nodeLink.getRuleLimitValue());<br>            <span class="hljs-keyword">default</span>:<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">LogicFilter</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 逻辑决策器</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> matterValue          决策值</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> treeNodeLineInfoList 决策节点</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 下一个节点Id</span><br><span class="hljs-comment">     */</span><br>    Long <span class="hljs-title function_">filter</span><span class="hljs-params">(String matterValue, List&lt;TreeNodeLink&gt; treeNodeLineInfoList)</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 获取决策值</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> decisionMatter 决策物料</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 决策值</span><br><span class="hljs-comment">     */</span><br>    String <span class="hljs-title function_">matterValue</span><span class="hljs-params">(Long treeId, String userId, Map&lt;String, String&gt; decisionMatter)</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserAgeFilter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseLogic</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">matterValue</span><span class="hljs-params">(Long treeId, String userId, Map&lt;String, String&gt; decisionMatter)</span> &#123;<br>        <span class="hljs-keyword">return</span> decisionMatter.get(<span class="hljs-string">&quot;age&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserGenderFilter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseLogic</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">matterValue</span><span class="hljs-params">(Long treeId, String userId, Map&lt;String, String&gt; decisionMatter)</span> &#123;<br>        <span class="hljs-keyword">return</span> decisionMatter.get(<span class="hljs-string">&quot;gender&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EngineBase</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">EngineConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IEngine</span>&#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(EngineBase.class);<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> EngineResult <span class="hljs-title function_">process</span><span class="hljs-params">(Long treeId, String userId, TreeRich treeRich, Map&lt;String, String&gt; decisionMatter)</span>;<br><br>    <span class="hljs-keyword">protected</span> TreeNode <span class="hljs-title function_">engineDecisionMaker</span><span class="hljs-params">(TreeRich treeRich, Long treeId, String userId, Map&lt;String, String&gt; decisionMatter)</span> &#123;<br>        <span class="hljs-type">TreeRoot</span> <span class="hljs-variable">treeRoot</span> <span class="hljs-operator">=</span> treeRich.getTreeRoot();<br>        Map&lt;Long, TreeNode&gt; treeNodeMap = treeRich.getTreeNodeMap();<br>        <span class="hljs-comment">// 规则树根ID</span><br>        <span class="hljs-type">Long</span> <span class="hljs-variable">rootNodeId</span> <span class="hljs-operator">=</span> treeRoot.getTreeRootNodeId();<br>        <span class="hljs-type">TreeNode</span> <span class="hljs-variable">treeNodeInfo</span> <span class="hljs-operator">=</span> treeNodeMap.get(rootNodeId);<br>        <span class="hljs-comment">//节点类型[NodeType]；1子叶、2果实</span><br>        <span class="hljs-keyword">while</span> (treeNodeInfo.getNodeType().equals(<span class="hljs-number">1</span>)) &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">ruleKey</span> <span class="hljs-operator">=</span> treeNodeInfo.getRuleKey();<br>            <span class="hljs-type">LogicFilter</span> <span class="hljs-variable">logicFilter</span> <span class="hljs-operator">=</span> logicFilterMap.get(ruleKey);<br>            <span class="hljs-type">String</span> <span class="hljs-variable">matterValue</span> <span class="hljs-operator">=</span> logicFilter.matterValue(treeId, userId, decisionMatter);<br>            <span class="hljs-type">Long</span> <span class="hljs-variable">nextNode</span> <span class="hljs-operator">=</span> logicFilter.filter(matterValue, treeNodeInfo.getTreeNodeLinkList());<br>            treeNodeInfo = treeNodeMap.get(nextNode);<br>            logger.info(<span class="hljs-string">&quot;决策树引擎=&gt;&#123;&#125; userId：&#123;&#125; treeId：&#123;&#125; treeNode：&#123;&#125; ruleKey：&#123;&#125; matterValue：&#123;&#125;&quot;</span>, treeRoot.getTreeName(), userId, treeId, treeNodeInfo.getTreeNodeId(), ruleKey, matterValue);<br>        &#125;<br>        <span class="hljs-keyword">return</span> treeNodeInfo;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EngineConfig</span> &#123;<br><br>    <span class="hljs-keyword">static</span> Map&lt;String, LogicFilter&gt; logicFilterMap;<br><br>    <span class="hljs-keyword">static</span> &#123;<br>        logicFilterMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();<br>        logicFilterMap.put(<span class="hljs-string">&quot;userAge&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserAgeFilter</span>());<br>        logicFilterMap.put(<span class="hljs-string">&quot;userGender&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserGenderFilter</span>());<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Map&lt;String, LogicFilter&gt; <span class="hljs-title function_">getLogicFilterMap</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> logicFilterMap;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setLogicFilterMap</span><span class="hljs-params">(Map&lt;String, LogicFilter&gt; logicFilterMap)</span> &#123;<br>        <span class="hljs-built_in">this</span>.logicFilterMap = logicFilterMap;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">IEngine</span> &#123;<br><br>    EngineResult <span class="hljs-title function_">process</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Long treeId, <span class="hljs-keyword">final</span> String userId, TreeRich treeRich, <span class="hljs-keyword">final</span> Map&lt;String, String&gt; decisionMatter)</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TreeEngineHandle</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">EngineBase</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> EngineResult <span class="hljs-title function_">process</span><span class="hljs-params">(Long treeId, String userId, TreeRich treeRich, Map&lt;String, String&gt; decisionMatter)</span> &#123;<br>        <span class="hljs-comment">// 决策流程</span><br>        <span class="hljs-type">TreeNode</span> <span class="hljs-variable">treeNode</span> <span class="hljs-operator">=</span> engineDecisionMaker(treeRich, treeId, userId, decisionMatter);<br>        <span class="hljs-comment">// 决策结果</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">EngineResult</span>(userId, treeId, treeNode.getTreeNodeId(), treeNode.getNodeValue());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * 测试</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApiTest</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(ApiTest.class);<br><br>    <span class="hljs-keyword">private</span> TreeRich treeRich;<br><br>    <span class="hljs-meta">@Before</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-comment">// 节点：1</span><br>        <span class="hljs-type">TreeNode</span> <span class="hljs-variable">treeNode_01</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TreeNode</span>();<br>        treeNode_01.setTreeId(<span class="hljs-number">10001L</span>);<br>        treeNode_01.setTreeNodeId(<span class="hljs-number">1L</span>);<br>        treeNode_01.setNodeType(<span class="hljs-number">1</span>);<br>        treeNode_01.setNodeValue(<span class="hljs-literal">null</span>);<br>        treeNode_01.setRuleKey(<span class="hljs-string">&quot;userGender&quot;</span>);<br>        treeNode_01.setRuleDesc(<span class="hljs-string">&quot;用户性别[男/女]&quot;</span>);<br><br>        <span class="hljs-comment">// 链接：1-&gt;11</span><br>        <span class="hljs-type">TreeNodeLink</span> <span class="hljs-variable">treeNodeLink_11</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TreeNodeLink</span>();<br>        treeNodeLink_11.setNodeIdFrom(<span class="hljs-number">1L</span>);<br>        treeNodeLink_11.setNodeIdTo(<span class="hljs-number">11L</span>);<br>        treeNodeLink_11.setRuleLimitType(<span class="hljs-number">1</span>);<br>        treeNodeLink_11.setRuleLimitValue(<span class="hljs-string">&quot;man&quot;</span>);<br><br>        <span class="hljs-comment">// 链接：1-&gt;12</span><br>        <span class="hljs-type">TreeNodeLink</span> <span class="hljs-variable">treeNodeLink_12</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TreeNodeLink</span>();<br>        treeNodeLink_12.setNodeIdFrom(<span class="hljs-number">1L</span>);<br>        treeNodeLink_12.setNodeIdTo(<span class="hljs-number">12L</span>);<br>        treeNodeLink_12.setRuleLimitType(<span class="hljs-number">1</span>);<br>        treeNodeLink_12.setRuleLimitValue(<span class="hljs-string">&quot;woman&quot;</span>);<br><br>        List&lt;TreeNodeLink&gt; treeNodeLinkList_1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        treeNodeLinkList_1.add(treeNodeLink_11);<br>        treeNodeLinkList_1.add(treeNodeLink_12);<br><br>        treeNode_01.setTreeNodeLinkList(treeNodeLinkList_1);<br><br>        <span class="hljs-comment">// 节点：11</span><br>        <span class="hljs-type">TreeNode</span> <span class="hljs-variable">treeNode_11</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TreeNode</span>();<br>        treeNode_11.setTreeId(<span class="hljs-number">10001L</span>);<br>        treeNode_11.setTreeNodeId(<span class="hljs-number">11L</span>);<br>        treeNode_11.setNodeType(<span class="hljs-number">1</span>);<br>        treeNode_11.setNodeValue(<span class="hljs-literal">null</span>);<br>        treeNode_11.setRuleKey(<span class="hljs-string">&quot;userAge&quot;</span>);<br>        treeNode_11.setRuleDesc(<span class="hljs-string">&quot;用户年龄&quot;</span>);<br><br>        <span class="hljs-comment">// 链接：11-&gt;111</span><br>        <span class="hljs-type">TreeNodeLink</span> <span class="hljs-variable">treeNodeLink_111</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TreeNodeLink</span>();<br>        treeNodeLink_111.setNodeIdFrom(<span class="hljs-number">11L</span>);<br>        treeNodeLink_111.setNodeIdTo(<span class="hljs-number">111L</span>);<br>        treeNodeLink_111.setRuleLimitType(<span class="hljs-number">3</span>);<br>        treeNodeLink_111.setRuleLimitValue(<span class="hljs-string">&quot;25&quot;</span>);<br><br>        <span class="hljs-comment">// 链接：11-&gt;112</span><br>        <span class="hljs-type">TreeNodeLink</span> <span class="hljs-variable">treeNodeLink_112</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TreeNodeLink</span>();<br>        treeNodeLink_112.setNodeIdFrom(<span class="hljs-number">11L</span>);<br>        treeNodeLink_112.setNodeIdTo(<span class="hljs-number">112L</span>);<br>        treeNodeLink_112.setRuleLimitType(<span class="hljs-number">5</span>);<br>        treeNodeLink_112.setRuleLimitValue(<span class="hljs-string">&quot;25&quot;</span>);<br><br>        List&lt;TreeNodeLink&gt; treeNodeLinkList_11 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        treeNodeLinkList_11.add(treeNodeLink_111);<br>        treeNodeLinkList_11.add(treeNodeLink_112);<br><br>        treeNode_11.setTreeNodeLinkList(treeNodeLinkList_11);<br><br>        <span class="hljs-comment">// 节点：12</span><br>        <span class="hljs-type">TreeNode</span> <span class="hljs-variable">treeNode_12</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TreeNode</span>();<br>        treeNode_12.setTreeId(<span class="hljs-number">10001L</span>);<br>        treeNode_12.setTreeNodeId(<span class="hljs-number">12L</span>);<br>        treeNode_12.setNodeType(<span class="hljs-number">1</span>);<br>        treeNode_12.setNodeValue(<span class="hljs-literal">null</span>);<br>        treeNode_12.setRuleKey(<span class="hljs-string">&quot;userAge&quot;</span>);<br>        treeNode_12.setRuleDesc(<span class="hljs-string">&quot;用户年龄&quot;</span>);<br><br>        <span class="hljs-comment">// 链接：12-&gt;121</span><br>        <span class="hljs-type">TreeNodeLink</span> <span class="hljs-variable">treeNodeLink_121</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TreeNodeLink</span>();<br>        treeNodeLink_121.setNodeIdFrom(<span class="hljs-number">12L</span>);<br>        treeNodeLink_121.setNodeIdTo(<span class="hljs-number">121L</span>);<br>        treeNodeLink_121.setRuleLimitType(<span class="hljs-number">3</span>);<br>        treeNodeLink_121.setRuleLimitValue(<span class="hljs-string">&quot;25&quot;</span>);<br><br>        <span class="hljs-comment">// 链接：12-&gt;122</span><br>        <span class="hljs-type">TreeNodeLink</span> <span class="hljs-variable">treeNodeLink_122</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TreeNodeLink</span>();<br>        treeNodeLink_122.setNodeIdFrom(<span class="hljs-number">12L</span>);<br>        treeNodeLink_122.setNodeIdTo(<span class="hljs-number">122L</span>);<br>        treeNodeLink_122.setRuleLimitType(<span class="hljs-number">5</span>);<br>        treeNodeLink_122.setRuleLimitValue(<span class="hljs-string">&quot;25&quot;</span>);<br><br>        List&lt;TreeNodeLink&gt; treeNodeLinkList_12 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        treeNodeLinkList_12.add(treeNodeLink_121);<br>        treeNodeLinkList_12.add(treeNodeLink_122);<br><br>        treeNode_12.setTreeNodeLinkList(treeNodeLinkList_12);<br><br>        <span class="hljs-comment">// 节点：111</span><br>        <span class="hljs-type">TreeNode</span> <span class="hljs-variable">treeNode_111</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TreeNode</span>();<br>        treeNode_111.setTreeId(<span class="hljs-number">10001L</span>);<br>        treeNode_111.setTreeNodeId(<span class="hljs-number">111L</span>);<br>        treeNode_111.setNodeType(<span class="hljs-number">2</span>);<br>        treeNode_111.setNodeValue(<span class="hljs-string">&quot;果实A&quot;</span>);<br><br>        <span class="hljs-comment">// 节点：112</span><br>        <span class="hljs-type">TreeNode</span> <span class="hljs-variable">treeNode_112</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TreeNode</span>();<br>        treeNode_112.setTreeId(<span class="hljs-number">10001L</span>);<br>        treeNode_112.setTreeNodeId(<span class="hljs-number">112L</span>);<br>        treeNode_112.setNodeType(<span class="hljs-number">2</span>);<br>        treeNode_112.setNodeValue(<span class="hljs-string">&quot;果实B&quot;</span>);<br><br>        <span class="hljs-comment">// 节点：121</span><br>        <span class="hljs-type">TreeNode</span> <span class="hljs-variable">treeNode_121</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TreeNode</span>();<br>        treeNode_121.setTreeId(<span class="hljs-number">10001L</span>);<br>        treeNode_121.setTreeNodeId(<span class="hljs-number">121L</span>);<br>        treeNode_121.setNodeType(<span class="hljs-number">2</span>);<br>        treeNode_121.setNodeValue(<span class="hljs-string">&quot;果实C&quot;</span>);<br><br>        <span class="hljs-comment">// 节点：122</span><br>        <span class="hljs-type">TreeNode</span> <span class="hljs-variable">treeNode_122</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TreeNode</span>();<br>        treeNode_122.setTreeId(<span class="hljs-number">10001L</span>);<br>        treeNode_122.setTreeNodeId(<span class="hljs-number">122L</span>);<br>        treeNode_122.setNodeType(<span class="hljs-number">2</span>);<br>        treeNode_122.setNodeValue(<span class="hljs-string">&quot;果实D&quot;</span>);<br><br>        <span class="hljs-comment">// 树根</span><br>        <span class="hljs-type">TreeRoot</span> <span class="hljs-variable">treeRoot</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TreeRoot</span>();<br>        treeRoot.setTreeId(<span class="hljs-number">10001L</span>);<br>        treeRoot.setTreeRootNodeId(<span class="hljs-number">1L</span>);<br>        treeRoot.setTreeName(<span class="hljs-string">&quot;规则决策树&quot;</span>);<br><br>        Map&lt;Long, TreeNode&gt; treeNodeMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        treeNodeMap.put(<span class="hljs-number">1L</span>, treeNode_01);<br>        treeNodeMap.put(<span class="hljs-number">11L</span>, treeNode_11);<br>        treeNodeMap.put(<span class="hljs-number">12L</span>, treeNode_12);<br>        treeNodeMap.put(<span class="hljs-number">111L</span>, treeNode_111);<br>        treeNodeMap.put(<span class="hljs-number">112L</span>, treeNode_112);<br>        treeNodeMap.put(<span class="hljs-number">121L</span>, treeNode_121);<br>        treeNodeMap.put(<span class="hljs-number">122L</span>, treeNode_122);<br><br>        treeRich = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TreeRich</span>(treeRoot, treeNodeMap);<br>    &#125;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test_tree</span><span class="hljs-params">()</span> &#123;<br>        logger.info(<span class="hljs-string">&quot;决策树组合结构信息：\r\n&quot;</span> + JSON.toJSONString(treeRich));<br><br>        <span class="hljs-type">IEngine</span> <span class="hljs-variable">treeEngineHandle</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TreeEngineHandle</span>();<br><br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * 测试数据</span><br><span class="hljs-comment">         * 果实A：gender=man、age=22</span><br><span class="hljs-comment">         * 果实B：gender=man、age=29</span><br><span class="hljs-comment">         * 果实C：gender=woman、age=22</span><br><span class="hljs-comment">         * 果实D：gender=woman、age=29</span><br><span class="hljs-comment">         */</span><br>        Map&lt;String, String&gt; decisionMatter = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        decisionMatter.put(<span class="hljs-string">&quot;gender&quot;</span>, <span class="hljs-string">&quot;man&quot;</span>);<br>        decisionMatter.put(<span class="hljs-string">&quot;age&quot;</span>, <span class="hljs-string">&quot;29&quot;</span>);<br><br>        <span class="hljs-type">EngineResult</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> treeEngineHandle.process(<span class="hljs-number">10001L</span>, <span class="hljs-string">&quot;Oli09pLkdjh&quot;</span>, treeRich, decisionMatter);<br>        logger.info(<span class="hljs-string">&quot;测试结果：&#123;&#125;&quot;</span>, JSON.toJSONString(result));<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="装饰器模式"><a href="#装饰器模式" class="headerlink" title="装饰器模式"></a>装饰器模式</h2><blockquote>
<p>在不改变现有对象结构的情况下，动态地给该对象增加一些职责（即增加其额外功能）的模式，它属于对象结构型模式</p>
</blockquote>
<ul>
<li>SSO单点登录功能扩展，增加拦截用户访问方法范围场景</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SsoDecorator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerInterceptor</span>&#123;<br><br>    <span class="hljs-keyword">private</span> HandlerInterceptor handlerInterceptor;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">SsoDecorator</span><span class="hljs-params">()</span>&#123;&#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SsoDecorator</span><span class="hljs-params">(HandlerInterceptor handlerInterceptor)</span> &#123;<br>        <span class="hljs-built_in">this</span>.handlerInterceptor = handlerInterceptor;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">preHandle</span><span class="hljs-params">(String request, String response, Object handler)</span> &#123;<br>        <span class="hljs-keyword">return</span> handlerInterceptor.preHandle(request, response, handler);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoginSsoDecorator</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">SsoDecorator</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(LoginSsoDecorator.class);<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Map&lt;String, String&gt; authMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;String, String&gt;();<br><br>    <span class="hljs-keyword">static</span> &#123;<br>        authMap.put(<span class="hljs-string">&quot;huahua&quot;</span>, <span class="hljs-string">&quot;queryUserInfo&quot;</span>);<br>        authMap.put(<span class="hljs-string">&quot;doudou&quot;</span>, <span class="hljs-string">&quot;queryUserInfo&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">LoginSsoDecorator</span><span class="hljs-params">(HandlerInterceptor handlerInterceptor)</span> &#123;<br>        <span class="hljs-built_in">super</span>(handlerInterceptor);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">preHandle</span><span class="hljs-params">(String request, String response, Object handler)</span> &#123;<br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">success</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">super</span>.preHandle(request, response, handler);<br>        <span class="hljs-keyword">if</span> (!success) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> request.substring(<span class="hljs-number">8</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">method</span> <span class="hljs-operator">=</span> authMap.get(userId);<br>        logger.info(<span class="hljs-string">&quot;模拟单点登录方法访问拦截校验：&#123;&#125; &#123;&#125;&quot;</span>, userId, method);<br>        <span class="hljs-comment">// 模拟方法校验</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;queryUserInfo&quot;</span>.equals(method);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * 测试</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApiTest</span> &#123;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test_LoginSsoDecorator</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">LoginSsoDecorator</span> <span class="hljs-variable">ssoDecorator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LoginSsoDecorator</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">SsoInterceptor</span>());<br>        <span class="hljs-type">String</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;1successhuahua&quot;</span>;<br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">success</span> <span class="hljs-operator">=</span> ssoDecorator.preHandle(request, <span class="hljs-string">&quot;ewcdqwt40liuiu&quot;</span>, <span class="hljs-string">&quot;t&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;登录校验：&quot;</span> + request + (success ? <span class="hljs-string">&quot; 放行&quot;</span> : <span class="hljs-string">&quot; 拦截&quot;</span>));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="外观模式"><a href="#外观模式" class="headerlink" title="外观模式"></a>外观模式</h2><blockquote>
<p>隐藏系统的复杂性，并向客户端提供一个客户端可以访问系统的接口。这种类型的设计模式属于结构型模式，它向现有的系统添加一个接口，来隐藏系统的复杂性</p>
</blockquote>
<ul>
<li>基于SpringBoot开发门面模式中间件，统一控制接口白名单场景</li>
</ul>
<p><strong>切面处理白名单</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 切面定义</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DoJoinPoint</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(DoJoinPoint.class);<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> StarterService starterService;<br><br>    <span class="hljs-meta">@Pointcut(&quot;@annotation(cn.bugstack.design.door.annotation.DoDoor)&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">aopPoint</span><span class="hljs-params">()</span> &#123;<br><br>    &#125;<br><br>    <span class="hljs-meta">@Around(&quot;aopPoint()&quot;)</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">doRouter</span><span class="hljs-params">(ProceedingJoinPoint jp)</span> <span class="hljs-keyword">throws</span> Throwable &#123;<br>        <span class="hljs-type">Method</span> <span class="hljs-variable">method</span> <span class="hljs-operator">=</span> getMethod(jp);<br>        <span class="hljs-type">DoDoor</span> <span class="hljs-variable">door</span> <span class="hljs-operator">=</span> method.getAnnotation(DoDoor.class);<br><br>        <span class="hljs-type">String</span> <span class="hljs-variable">keyValue</span> <span class="hljs-operator">=</span> getFiledValue(door.key(), jp.getArgs());<br>        logger.info(<span class="hljs-string">&quot;itstack door handler method：&#123;&#125; value：&#123;&#125;&quot;</span>, method.getName(), keyValue);<br>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> == keyValue || <span class="hljs-string">&quot;&quot;</span>.equals(keyValue)) <span class="hljs-keyword">return</span> jp.proceed();<br><br>        String[] split = starterService.split(<span class="hljs-string">&quot;,&quot;</span>);<br><br>        <span class="hljs-comment">// 白名单过滤</span><br>        <span class="hljs-keyword">for</span> (String str : split) &#123;<br>            <span class="hljs-keyword">if</span> (keyValue.equals(str)) &#123;<br>                <span class="hljs-keyword">return</span> jp.proceed();<br>            &#125;<br>        &#125;<br>        <span class="hljs-comment">// 拦截</span><br>        <span class="hljs-keyword">return</span> returnObject(door, method);<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> Method <span class="hljs-title function_">getMethod</span><span class="hljs-params">(JoinPoint jp)</span> <span class="hljs-keyword">throws</span> NoSuchMethodException &#123;<br>        <span class="hljs-type">Signature</span> <span class="hljs-variable">sig</span> <span class="hljs-operator">=</span> jp.getSignature();<br>        <span class="hljs-type">MethodSignature</span> <span class="hljs-variable">methodSignature</span> <span class="hljs-operator">=</span> (MethodSignature) sig;<br>        <span class="hljs-keyword">return</span> getClass(jp).getMethod(methodSignature.getName(), methodSignature.getParameterTypes());<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> Class&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Object</span>&gt; getClass(JoinPoint jp) <span class="hljs-keyword">throws</span> NoSuchMethodException &#123;<br>        <span class="hljs-keyword">return</span> jp.getTarget().getClass();<br>    &#125;<br><br>    <span class="hljs-comment">//返回对象</span><br>    <span class="hljs-keyword">private</span> Object <span class="hljs-title function_">returnObject</span><span class="hljs-params">(DoDoor doGate, Method method)</span> <span class="hljs-keyword">throws</span> IllegalAccessException, InstantiationException &#123;<br>        Class&lt;?&gt; returnType = method.getReturnType();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">returnJson</span> <span class="hljs-operator">=</span> doGate.returnJson();<br>        <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;&quot;</span>.equals(returnJson)) &#123;<br>            <span class="hljs-keyword">return</span> returnType.newInstance();<br>        &#125;<br>        <span class="hljs-keyword">return</span> JSON.parseObject(returnJson, returnType);<br>    &#125;<br><br>    <span class="hljs-comment">//获取属性值</span><br>    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">getFiledValue</span><span class="hljs-params">(String filed, Object[] args)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">filedValue</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">for</span> (Object arg : args) &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> == filedValue || <span class="hljs-string">&quot;&quot;</span>.equals(filedValue)) &#123;<br>                    filedValue = BeanUtils.getProperty(arg, filed);<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    <span class="hljs-keyword">break</span>;<br>                &#125;<br>            &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                <span class="hljs-keyword">if</span> (args.length == <span class="hljs-number">1</span>) &#123;<br>                    <span class="hljs-keyword">return</span> args[<span class="hljs-number">0</span>].toString();<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> filedValue;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<p><strong>门面自定义注解</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 注解</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="hljs-meta">@Target(ElementType.METHOD)</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> DoDoor &#123;<br><br>    String <span class="hljs-title function_">key</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-string">&quot;&quot;</span>;<br><br>    String <span class="hljs-title function_">returnJson</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-string">&quot;&quot;</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>



<p><strong>获取白名单配置</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 切面定义</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@ConditionalOnClass(StarterService.class)</span><br><span class="hljs-meta">@EnableConfigurationProperties(StarterServiceProperties.class)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StarterAutoConfigure</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> StarterServiceProperties properties;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-meta">@ConditionalOnMissingBean</span><br>    <span class="hljs-meta">@ConditionalOnProperty(prefix = &quot;itstack.door&quot;, value = &quot;enabled&quot;, havingValue = &quot;true&quot;)</span><br>    StarterService <span class="hljs-title function_">starterService</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StarterService</span>(properties.getUserStr());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 切面定义</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * itstack:</span><br><span class="hljs-comment"> *   door:</span><br><span class="hljs-comment"> *     enabled: true</span><br><span class="hljs-comment"> *     userStr: 1001,aaaa,ccc #白名单用户ID，多个逗号隔开</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StarterService</span> &#123;<br><br>    <span class="hljs-keyword">private</span> String userStr;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">StarterService</span><span class="hljs-params">(String userStr)</span> &#123;<br>        <span class="hljs-built_in">this</span>.userStr = userStr;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String[] split(String separatorChar) &#123;<br>        <span class="hljs-keyword">return</span> StringUtils.split(<span class="hljs-built_in">this</span>.userStr, separatorChar);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 切面定义</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@ConfigurationProperties(&quot;itstack.door&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StarterServiceProperties</span> &#123;<br><br>    <span class="hljs-keyword">private</span> String userStr;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getUserStr</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> userStr;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUserStr</span><span class="hljs-params">(String userStr)</span> &#123;<br>        <span class="hljs-built_in">this</span>.userStr = userStr;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="享元模式"><a href="#享元模式" class="headerlink" title="享元模式"></a>享元模式</h2><blockquote>
<p>主要用于减少创建对象的数量，以减少内存占用和提高性能。这种类型的设计模式属于结构型模式，它提供了减少对象数量从而改善应用所需的对象结构的方式</p>
</blockquote>
<ul>
<li>基于Redis秒杀，提供活动与库存信息查询场景</li>
</ul>
<p><strong>定义基本信息</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Activity</span> &#123;<br><br>    <span class="hljs-comment">/** 活动ID */</span><br>    <span class="hljs-keyword">private</span> Long id;<br>    <span class="hljs-comment">/** 活动名称 */</span><br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-comment">/** 活动描述 */</span><br>    <span class="hljs-keyword">private</span> String desc;<br>    <span class="hljs-comment">/** 开始时间 */</span><br>    <span class="hljs-keyword">private</span> Date startTime;<br>    <span class="hljs-comment">/** 结束时间 */</span><br>    <span class="hljs-keyword">private</span> Date stopTime;<br>    <span class="hljs-comment">/** 活动库存 */</span><br>    <span class="hljs-keyword">private</span> Stock stock;<br><br>    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> id;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> &#123;<br>        <span class="hljs-built_in">this</span>.id = id;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getDesc</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> desc;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setDesc</span><span class="hljs-params">(String desc)</span> &#123;<br>        <span class="hljs-built_in">this</span>.desc = desc;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Date <span class="hljs-title function_">getStartTime</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> startTime;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setStartTime</span><span class="hljs-params">(Date startTime)</span> &#123;<br>        <span class="hljs-built_in">this</span>.startTime = startTime;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Date <span class="hljs-title function_">getStopTime</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> stopTime;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setStopTime</span><span class="hljs-params">(Date stopTime)</span> &#123;<br>        <span class="hljs-built_in">this</span>.stopTime = stopTime;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Stock <span class="hljs-title function_">getStock</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> stock;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setStock</span><span class="hljs-params">(Stock stock)</span> &#123;<br>        <span class="hljs-built_in">this</span>.stock = stock;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Stock</span> &#123;<br><br>    <span class="hljs-comment">/** 库存总量 */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> total;<br>    <span class="hljs-comment">/** 库存已用 */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> used;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Stock</span><span class="hljs-params">(<span class="hljs-type">int</span> total, <span class="hljs-type">int</span> used)</span> &#123;<br>        <span class="hljs-built_in">this</span>.total = total;<br>        <span class="hljs-built_in">this</span>.used = used;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getTotal</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> total;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setTotal</span><span class="hljs-params">(<span class="hljs-type">int</span> total)</span> &#123;<br>        <span class="hljs-built_in">this</span>.total = total;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getUsed</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> used;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUsed</span><span class="hljs-params">(<span class="hljs-type">int</span> used)</span> &#123;<br>        <span class="hljs-built_in">this</span>.used = used;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<p><strong>模拟Redis</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisUtils</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">ScheduledExecutorService</span> <span class="hljs-variable">scheduledExecutorService</span> <span class="hljs-operator">=</span> Executors.newScheduledThreadPool(<span class="hljs-number">1</span>);<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">stock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(<span class="hljs-number">0</span>);<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">RedisUtils</span><span class="hljs-params">()</span> &#123;<br>        scheduledExecutorService.scheduleAtFixedRate(() -&gt; &#123;<br>            <span class="hljs-comment">// 模拟库存消耗</span><br>            stock.addAndGet(<span class="hljs-number">1</span>);<br>        &#125;, <span class="hljs-number">0</span>, <span class="hljs-number">100000</span>, TimeUnit.MICROSECONDS);<br><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getStockUsed</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> stock.get();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ActivityFactory</span> &#123;<br><br>    <span class="hljs-keyword">static</span> Map&lt;Long, Activity&gt; activityMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Activity <span class="hljs-title function_">getActivity</span><span class="hljs-params">(Long id)</span>&#123;<br>        <span class="hljs-type">Activity</span> <span class="hljs-variable">activity</span> <span class="hljs-operator">=</span> activityMap.get(id);<br>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> == activity) &#123;<br>            <span class="hljs-comment">// 模拟从实际业务应用从接口中获取活动信息</span><br>            activity = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Activity</span>();<br>            activity.setId(<span class="hljs-number">10001L</span>);<br>            activity.setName(<span class="hljs-string">&quot;图书嗨乐&quot;</span>);<br>            activity.setDesc(<span class="hljs-string">&quot;图书优惠券分享激励分享活动第二期&quot;</span>);<br>            activity.setStartTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>            activity.setStopTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>            activityMap.put(id, activity);<br>        &#125;<br>        <span class="hljs-keyword">return</span> activity;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ActivityController</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">RedisUtils</span> <span class="hljs-variable">redisUtils</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RedisUtils</span>();<br><br>    <span class="hljs-keyword">public</span> Activity <span class="hljs-title function_">queryActivityInfo</span><span class="hljs-params">(Long id)</span> &#123;<br>        <span class="hljs-type">Activity</span> <span class="hljs-variable">activity</span> <span class="hljs-operator">=</span> ActivityFactory.getActivity(id);<br>        <span class="hljs-comment">// 模拟从Redis中获取库存变化信息</span><br>        <span class="hljs-type">Stock</span> <span class="hljs-variable">stock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Stock</span>(<span class="hljs-number">1000</span>, redisUtils.getStockUsed());<br>        activity.setStock(stock);<br>        <span class="hljs-keyword">return</span> activity;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * 测试</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApiTest</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(ApiTest.class);<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">ActivityController</span> <span class="hljs-variable">activityController</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ActivityController</span>();<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test_queryActivityInfo</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">idx</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; idx &lt; <span class="hljs-number">10</span>; idx++) &#123;<br>            <span class="hljs-type">Long</span> <span class="hljs-variable">req</span> <span class="hljs-operator">=</span> <span class="hljs-number">10001L</span>;<br>            <span class="hljs-type">Activity</span> <span class="hljs-variable">activity</span> <span class="hljs-operator">=</span> activityController.queryActivityInfo(req);<br>            logger.info(<span class="hljs-string">&quot;测试结果：&#123;&#125; &#123;&#125;&quot;</span>, req, JSON.toJSONString(activity));<br>            Thread.sleep(<span class="hljs-number">1200</span>);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="代理模式"><a href="#代理模式" class="headerlink" title="代理模式"></a>代理模式</h2><blockquote>
<p>一个类代表另一个类的功能。这种类型的设计模式属于结构型模式。在代理模式中，创建具有现有对象的对象，以便向外界提供功能接口</p>
</blockquote>
<ul>
<li>模拟mybatis-spring中定义的DAO接口，使用代理类方式操作数据库原理实现场景</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">IUserDao</span> &#123;<br><br>    <span class="hljs-meta">@Select(&quot;select userName from user where id = #&#123;uId&#125;&quot;)</span><br>    String <span class="hljs-title function_">queryUserInfo</span><span class="hljs-params">(String uId)</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Documented</span><br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="hljs-meta">@Target(&#123;ElementType.METHOD&#125;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> Select &#123;<br><br>    String <span class="hljs-title function_">value</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-string">&quot;&quot;</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MapperFactoryBean</span>&lt;T&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">FactoryBean</span>&lt;T&gt; &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(MapperFactoryBean.class);<br><br>    <span class="hljs-keyword">private</span> Class&lt;T&gt; mapperInterface;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MapperFactoryBean</span><span class="hljs-params">(Class&lt;T&gt; mapperInterface)</span> &#123;<br>        <span class="hljs-built_in">this</span>.mapperInterface = mapperInterface;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> T <span class="hljs-title function_">getObject</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">InvocationHandler</span> <span class="hljs-variable">handler</span> <span class="hljs-operator">=</span> (proxy, method, args) -&gt; &#123;<br>            <span class="hljs-type">Select</span> <span class="hljs-variable">select</span> <span class="hljs-operator">=</span> method.getAnnotation(Select.class);<br>            logger.info(<span class="hljs-string">&quot;SQL：&#123;&#125;&quot;</span>, select.value().replace(<span class="hljs-string">&quot;#&#123;uId&#125;&quot;</span>, args[<span class="hljs-number">0</span>].toString()));<br>            <span class="hljs-keyword">return</span> args[<span class="hljs-number">0</span>] + <span class="hljs-string">&quot; 沉淀、分享、成长，让自己和他人都能有所收获！&quot;</span>;<br>        &#125;;<br>        <span class="hljs-keyword">return</span> (T) Proxy.newProxyInstance(<span class="hljs-built_in">this</span>.getClass().getClassLoader(), <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;mapperInterface&#125;, handler);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Class&lt;?&gt; getObjectType() &#123;<br>        <span class="hljs-keyword">return</span> mapperInterface;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isSingleton</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RegisterBeanFactory</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">BeanDefinitionRegistryPostProcessor</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">postProcessBeanDefinitionRegistry</span><span class="hljs-params">(BeanDefinitionRegistry beanDefinitionRegistry)</span> <span class="hljs-keyword">throws</span> BeansException &#123;<br>        <span class="hljs-type">GenericBeanDefinition</span> <span class="hljs-variable">beanDefinition</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GenericBeanDefinition</span>();<br>        beanDefinition.setBeanClass(MapperFactoryBean.class);<br>        beanDefinition.setScope(<span class="hljs-string">&quot;singleton&quot;</span>);<br>        beanDefinition.getConstructorArgumentValues().addGenericArgumentValue(IUserDao.class);<br><br>        <span class="hljs-type">BeanDefinitionHolder</span> <span class="hljs-variable">definitionHolder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanDefinitionHolder</span>(beanDefinition, <span class="hljs-string">&quot;userDao&quot;</span>);<br>        BeanDefinitionReaderUtils.registerBeanDefinition(definitionHolder, beanDefinitionRegistry);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">postProcessBeanFactory</span><span class="hljs-params">(ConfigurableListableBeanFactory configurableListableBeanFactory)</span> <span class="hljs-keyword">throws</span> BeansException &#123;<br>        <span class="hljs-comment">// left</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="责任链模式"><a href="#责任链模式" class="headerlink" title="责任链模式"></a>责任链模式</h2><blockquote>
<p>为了避免请求发送者与多个请求处理者耦合在一起，于是将所有请求的处理者通过前一对象记住其下一个对象的引用而连成一条链；当有请求发生时，可将请求沿着这条链传递，直到有对象处理它为止</p>
</blockquote>
<ul>
<li>模拟618电商大促期间，项目上线流程多级负责人审批场景</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 责任链审核抽象类</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AuthLink</span> &#123;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(AuthLink.class);<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-type">SimpleDateFormat</span> <span class="hljs-variable">f</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleDateFormat</span>(<span class="hljs-string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);<br>    <span class="hljs-keyword">protected</span> String levelUserId;<br>    <span class="hljs-keyword">protected</span> String levelUserName;<br>    <span class="hljs-keyword">protected</span> AuthLink next;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">AuthLink</span><span class="hljs-params">(String levelUserId, String levelUserName)</span> &#123;<br>        <span class="hljs-built_in">this</span>.levelUserId = levelUserId;<br>        <span class="hljs-built_in">this</span>.levelUserName = levelUserName;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> AuthLink <span class="hljs-title function_">getNext</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> next;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> AuthLink <span class="hljs-title function_">appendNext</span><span class="hljs-params">(AuthLink next)</span> &#123;<br>        <span class="hljs-built_in">this</span>.next = next;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> AuthInfo <span class="hljs-title function_">doAuth</span><span class="hljs-params">(String uId, String orderId, Date authDate)</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AuthInfo</span> &#123;<br><br>    <span class="hljs-keyword">private</span> String code;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> <span class="hljs-variable">info</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">AuthInfo</span><span class="hljs-params">(String code, String ...infos)</span> &#123;<br>        <span class="hljs-built_in">this</span>.code = code;<br>        <span class="hljs-keyword">for</span> (String str:infos)&#123;<br>            <span class="hljs-built_in">this</span>.info = <span class="hljs-built_in">this</span>.info.concat(str);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getCode</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> code;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setCode</span><span class="hljs-params">(String code)</span> &#123;<br>        <span class="hljs-built_in">this</span>.code = code;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getInfo</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> info;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setInfo</span><span class="hljs-params">(String info)</span> &#123;<br>        <span class="hljs-built_in">this</span>.info = info;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<p><strong>实现类</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 一级负责人</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Level1AuthLink</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AuthLink</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Date</span> <span class="hljs-variable">beginDate</span> <span class="hljs-operator">=</span> f.parse(<span class="hljs-string">&quot;2020-06-11 00:00:00&quot;</span>);<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Date</span> <span class="hljs-variable">endDate</span> <span class="hljs-operator">=</span> f.parse(<span class="hljs-string">&quot;2020-06-20 23:59:59&quot;</span>);<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Level1AuthLink</span><span class="hljs-params">(String levelUserId, String levelUserName)</span> <span class="hljs-keyword">throws</span> ParseException &#123;<br>        <span class="hljs-built_in">super</span>(levelUserId, levelUserName);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> AuthInfo <span class="hljs-title function_">doAuth</span><span class="hljs-params">(String uId, String orderId, Date authDate)</span> &#123;<br>        <span class="hljs-type">Date</span> <span class="hljs-variable">date</span> <span class="hljs-operator">=</span> AuthService.queryAuthInfo(levelUserId, orderId);<br>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> == date) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AuthInfo</span>(<span class="hljs-string">&quot;0001&quot;</span>, <span class="hljs-string">&quot;单号：&quot;</span>, orderId, <span class="hljs-string">&quot; 状态：待一级审批负责人 &quot;</span>, levelUserName);<br>        &#125;<br>        <span class="hljs-type">AuthLink</span> <span class="hljs-variable">next</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">super</span>.getNext();<br>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> == next) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AuthInfo</span>(<span class="hljs-string">&quot;0000&quot;</span>, <span class="hljs-string">&quot;单号：&quot;</span>, orderId, <span class="hljs-string">&quot; 状态：三级审批负责人完成&quot;</span>, <span class="hljs-string">&quot; 时间：&quot;</span>, f.format(date), <span class="hljs-string">&quot; 审批人：&quot;</span>, levelUserName);<br>        &#125;<br>        <span class="hljs-keyword">if</span> (authDate.before(beginDate) || authDate.after(endDate)) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AuthInfo</span>(<span class="hljs-string">&quot;0000&quot;</span>, <span class="hljs-string">&quot;单号：&quot;</span>, orderId, <span class="hljs-string">&quot; 状态：三级审批负责人完成&quot;</span>, <span class="hljs-string">&quot; 时间：&quot;</span>, f.format(date), <span class="hljs-string">&quot; 审批人：&quot;</span>, levelUserName);<br>        &#125;<br>        <span class="hljs-keyword">return</span> next.doAuth(uId, orderId, authDate);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 二级负责人</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Level2AuthLink</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AuthLink</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Date</span> <span class="hljs-variable">beginDate</span> <span class="hljs-operator">=</span> f.parse(<span class="hljs-string">&quot;2020-06-01 00:00:00&quot;</span>);<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Date</span> <span class="hljs-variable">endDate</span> <span class="hljs-operator">=</span> f.parse(<span class="hljs-string">&quot;2020-06-25 23:59:59&quot;</span>);<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Level2AuthLink</span><span class="hljs-params">(String levelUserId, String levelUserName)</span> <span class="hljs-keyword">throws</span> ParseException &#123;<br>        <span class="hljs-built_in">super</span>(levelUserId, levelUserName);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> AuthInfo <span class="hljs-title function_">doAuth</span><span class="hljs-params">(String uId, String orderId, Date authDate)</span> &#123;<br>        <span class="hljs-type">Date</span> <span class="hljs-variable">date</span> <span class="hljs-operator">=</span> AuthService.queryAuthInfo(levelUserId, orderId);<br>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> == date) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AuthInfo</span>(<span class="hljs-string">&quot;0001&quot;</span>, <span class="hljs-string">&quot;单号：&quot;</span>, orderId, <span class="hljs-string">&quot; 状态：待二级审批负责人 &quot;</span>, levelUserName);<br>        &#125;<br>        <span class="hljs-type">AuthLink</span> <span class="hljs-variable">next</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">super</span>.getNext();<br>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> == next) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AuthInfo</span>(<span class="hljs-string">&quot;0000&quot;</span>, <span class="hljs-string">&quot;单号：&quot;</span>, orderId, <span class="hljs-string">&quot; 状态：二级审批完成负责人&quot;</span>, <span class="hljs-string">&quot; 时间：&quot;</span>, f.format(date), <span class="hljs-string">&quot; 审批人：&quot;</span>, levelUserName);<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (authDate.before(beginDate) || authDate.after(endDate)) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AuthInfo</span>(<span class="hljs-string">&quot;0000&quot;</span>, <span class="hljs-string">&quot;单号：&quot;</span>, orderId, <span class="hljs-string">&quot; 状态：二级审批完成负责人&quot;</span>, <span class="hljs-string">&quot; 时间：&quot;</span>, f.format(date), <span class="hljs-string">&quot; 审批人：&quot;</span>, levelUserName);<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> next.doAuth(uId, orderId, authDate);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 三级负责人</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Level3AuthLink</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AuthLink</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Level3AuthLink</span><span class="hljs-params">(String levelUserId, String levelUserName)</span> &#123;<br>        <span class="hljs-built_in">super</span>(levelUserId, levelUserName);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> AuthInfo <span class="hljs-title function_">doAuth</span><span class="hljs-params">(String uId, String orderId, Date authDate)</span> &#123;<br>        <span class="hljs-type">Date</span> <span class="hljs-variable">date</span> <span class="hljs-operator">=</span> AuthService.queryAuthInfo(levelUserId, orderId);<br>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> == date) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AuthInfo</span>(<span class="hljs-string">&quot;0001&quot;</span>, <span class="hljs-string">&quot;单号：&quot;</span>, orderId, <span class="hljs-string">&quot; 状态：待三级审批负责人 &quot;</span>, levelUserName);<br>        &#125;<br>        <span class="hljs-type">AuthLink</span> <span class="hljs-variable">next</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">super</span>.getNext();<br>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> == next) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AuthInfo</span>(<span class="hljs-string">&quot;0000&quot;</span>, <span class="hljs-string">&quot;单号：&quot;</span>, orderId, <span class="hljs-string">&quot; 状态：一级审批完成负责人&quot;</span>, <span class="hljs-string">&quot; 时间：&quot;</span>, f.format(date), <span class="hljs-string">&quot; 审批人：&quot;</span>, levelUserName);<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> next.doAuth(uId, orderId, authDate);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 测试</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApiTest</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(ApiTest.class);<br><br>    <span class="hljs-meta">@org</span>.junit.Test<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test_AuthLink</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> ParseException &#123;<br><br>        <span class="hljs-type">AuthLink</span> <span class="hljs-variable">authLink</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Level3AuthLink</span>(<span class="hljs-string">&quot;1000013&quot;</span>, <span class="hljs-string">&quot;王工&quot;</span>)<br>                .appendNext(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Level2AuthLink</span>(<span class="hljs-string">&quot;1000012&quot;</span>, <span class="hljs-string">&quot;张经理&quot;</span>)<br>                        .appendNext(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Level1AuthLink</span>(<span class="hljs-string">&quot;1000011&quot;</span>, <span class="hljs-string">&quot;段总&quot;</span>)));<br><br>        <span class="hljs-type">SimpleDateFormat</span> <span class="hljs-variable">f</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleDateFormat</span>(<span class="hljs-string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);<br>        <span class="hljs-type">Date</span> <span class="hljs-variable">currentDate</span> <span class="hljs-operator">=</span> f.parse(<span class="hljs-string">&quot;2020-06-18 23:49:46&quot;</span>);<br><br>        logger.info(<span class="hljs-string">&quot;测试结果：&#123;&#125;&quot;</span>, JSON.toJSONString(authLink.doAuth(<span class="hljs-string">&quot;小傅哥&quot;</span>, <span class="hljs-string">&quot;1000998004813441&quot;</span>, currentDate)));<br><br>        <span class="hljs-comment">// 模拟三级负责人审批</span><br>        AuthService.auth(<span class="hljs-string">&quot;1000013&quot;</span>, <span class="hljs-string">&quot;1000998004813441&quot;</span>);<br>        logger.info(<span class="hljs-string">&quot;测试结果：&#123;&#125;&quot;</span>, <span class="hljs-string">&quot;模拟三级负责人审批，王工&quot;</span>);<br>        logger.info(<span class="hljs-string">&quot;测试结果：&#123;&#125;&quot;</span>, JSON.toJSONString(authLink.doAuth(<span class="hljs-string">&quot;小傅哥&quot;</span>, <span class="hljs-string">&quot;1000998004813441&quot;</span>, currentDate)));<br><br>        <span class="hljs-comment">// 模拟二级负责人审批</span><br>        AuthService.auth(<span class="hljs-string">&quot;1000012&quot;</span>, <span class="hljs-string">&quot;1000998004813441&quot;</span>);<br>        logger.info(<span class="hljs-string">&quot;测试结果：&#123;&#125;&quot;</span>, <span class="hljs-string">&quot;模拟二级负责人审批，张经理&quot;</span>);<br>        logger.info(<span class="hljs-string">&quot;测试结果：&#123;&#125;&quot;</span>, JSON.toJSONString(authLink.doAuth(<span class="hljs-string">&quot;小傅哥&quot;</span>, <span class="hljs-string">&quot;1000998004813441&quot;</span>, currentDate)));<br><br>        <span class="hljs-comment">// 模拟一级负责人审批</span><br>        AuthService.auth(<span class="hljs-string">&quot;1000011&quot;</span>, <span class="hljs-string">&quot;1000998004813441&quot;</span>);<br>        logger.info(<span class="hljs-string">&quot;测试结果：&#123;&#125;&quot;</span>, <span class="hljs-string">&quot;模拟一级负责人审批，段总&quot;</span>);<br>        logger.info(<span class="hljs-string">&quot;测试结果：&#123;&#125;&quot;</span>, JSON.toJSONString(authLink.doAuth(<span class="hljs-string">&quot;小傅哥&quot;</span>, <span class="hljs-string">&quot;1000998004813441&quot;</span>, currentDate)));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="命令模式"><a href="#命令模式" class="headerlink" title="命令模式"></a>命令模式</h2><blockquote>
<p>将一个请求封装为一个对象，使发出请求的责任和执行请求过程分隔开。这样两者之间通过命令对象进行沟通，便于将命令对象进行储存、传递、调用、增加与管理</p>
</blockquote>
<ul>
<li>模拟高档餐厅八大菜系，小二点单厨师烹饪场景</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 烹饪接口</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ICook</span> &#123;<br><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">doCooking</span><span class="hljs-params">()</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GuangDongCook</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ICook</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(ICook.class);<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doCooking</span><span class="hljs-params">()</span> &#123;<br>        logger.info(<span class="hljs-string">&quot;广东厨师，烹饪鲁菜，宫廷菜系，以孔府风味为龙头&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JiangSuCook</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ICook</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(ICook.class);<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doCooking</span><span class="hljs-params">()</span> &#123;<br>        logger.info(<span class="hljs-string">&quot;江苏厨师，烹饪苏菜，宫廷菜系，古今国宴上最受人欢迎的菜系。&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ShanDongCook</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ICook</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(ICook.class);<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doCooking</span><span class="hljs-params">()</span> &#123;<br>        logger.info(<span class="hljs-string">&quot;山东厨师，烹饪鲁菜，宫廷菜系，以孔府风味为龙头&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SiChuanCook</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ICook</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(ICook.class);<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doCooking</span><span class="hljs-params">()</span> &#123;<br>        logger.info(<span class="hljs-string">&quot;四川厨师，烹饪川菜，中国最有特色的菜系，也是民间喜欢的菜系。&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 菜系，菜系：山东（鲁菜） 四川（川菜） 江苏（苏菜） 广东（粤菜） 福建（闽菜） 浙江（浙菜） 湖南（湘菜） 安徽（徽菜）</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ICuisine</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 烹调、制作</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">cook</span><span class="hljs-params">()</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 广东（粤菜）</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GuangDoneCuisine</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ICuisine</span> &#123;<br><br>    <span class="hljs-keyword">private</span> ICook cook;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">GuangDoneCuisine</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">GuangDoneCuisine</span><span class="hljs-params">(ICook cook)</span> &#123;<br>        <span class="hljs-built_in">this</span>.cook = cook;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cook</span><span class="hljs-params">()</span> &#123;<br>        cook.doCooking();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 江苏（苏菜）</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JiangSuCuisine</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ICuisine</span> &#123;<br><br>    <span class="hljs-keyword">private</span> ICook cook;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">JiangSuCuisine</span><span class="hljs-params">(ICook cook)</span> &#123;<br>        <span class="hljs-built_in">this</span>.cook = cook;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cook</span><span class="hljs-params">()</span> &#123;<br>        cook.doCooking();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 山东（鲁菜）</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ShanDongCuisine</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ICuisine</span> &#123;<br><br>    <span class="hljs-keyword">private</span> ICook cook;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ShanDongCuisine</span><span class="hljs-params">(ICook cook)</span> &#123;<br>        <span class="hljs-built_in">this</span>.cook = cook;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cook</span><span class="hljs-params">()</span> &#123;<br>        cook.doCooking();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 四川（川菜）</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SiChuanCuisine</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ICuisine</span> &#123;<br><br>    <span class="hljs-keyword">private</span> ICook cook;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SiChuanCuisine</span><span class="hljs-params">(ICook cook)</span> &#123;<br>        <span class="hljs-built_in">this</span>.cook = cook;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cook</span><span class="hljs-params">()</span> &#123;<br>        cook.doCooking();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 负责点餐</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">XiaoEr</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(XiaoEr.class);<br><br>    <span class="hljs-keyword">private</span> List&lt;ICuisine&gt; cuisineList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;ICuisine&gt;();<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">order</span><span class="hljs-params">(ICuisine cuisine)</span> &#123;<br>        cuisineList.add(cuisine);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">placeOrder</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">for</span> (ICuisine cuisine : cuisineList) &#123;<br>            cuisine.cook();<br>        &#125;<br>        cuisineList.clear();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApiTest</span> &#123;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test_xiaoEr</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-comment">// 菜系 + 厨师；广东（粤菜）、江苏（苏菜）、山东（鲁菜）、四川（川菜）</span><br>        <span class="hljs-type">ICuisine</span> <span class="hljs-variable">guangDoneCuisine</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GuangDoneCuisine</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">GuangDongCook</span>());<br>        <span class="hljs-type">JiangSuCuisine</span> <span class="hljs-variable">jiangSuCuisine</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JiangSuCuisine</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">JiangSuCook</span>());<br>        <span class="hljs-type">ShanDongCuisine</span> <span class="hljs-variable">shanDongCuisine</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ShanDongCuisine</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ShanDongCook</span>());<br>        <span class="hljs-type">SiChuanCuisine</span> <span class="hljs-variable">siChuanCuisine</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SiChuanCuisine</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">SiChuanCook</span>());<br><br>        <span class="hljs-comment">// 点单</span><br>        <span class="hljs-type">XiaoEr</span> <span class="hljs-variable">xiaoEr</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">XiaoEr</span>();<br>        xiaoEr.order(guangDoneCuisine);<br>        xiaoEr.order(jiangSuCuisine);<br>        xiaoEr.order(shanDongCuisine);<br>        xiaoEr.order(siChuanCuisine);<br><br>        xiaoEr.placeOrder();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="迭代器模式"><a href="#迭代器模式" class="headerlink" title="迭代器模式"></a>迭代器模式</h2><blockquote>
<p>提供一种方法顺序访问一个聚合对象中的各种元素，而又不暴露该对象的内部表示</p>
</blockquote>
<ul>
<li>模拟公司组织架构树结构关系，深度迭代遍历人员信息输出场景</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 雇员</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Employee</span> &#123;<br><br>    <span class="hljs-comment">// ID</span><br>    <span class="hljs-keyword">private</span> String uId;<br>    <span class="hljs-comment">// 姓名</span><br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-comment">// 备注</span><br>    <span class="hljs-keyword">private</span> String desc;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Employee</span><span class="hljs-params">(String uId, String name)</span> &#123;<br>        <span class="hljs-built_in">this</span>.uId = uId;<br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Employee</span><span class="hljs-params">(String uId, String name, String desc)</span> &#123;<br>        <span class="hljs-built_in">this</span>.uId = uId;<br>        <span class="hljs-built_in">this</span>.name = name;<br>        <span class="hljs-built_in">this</span>.desc = desc;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getuId</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> uId;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setuId</span><span class="hljs-params">(String uId)</span> &#123;<br>        <span class="hljs-built_in">this</span>.uId = uId;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getDesc</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> desc;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setDesc</span><span class="hljs-params">(String desc)</span> &#123;<br>        <span class="hljs-built_in">this</span>.desc = desc;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<p><strong>定义接口</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Iterator</span>&lt;E&gt; &#123;<br><br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">hasNext</span><span class="hljs-params">()</span>;<br><br>    E <span class="hljs-title function_">next</span><span class="hljs-params">()</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Iterable</span>&lt;E&gt; &#123;<br><br>    Iterator&lt;E&gt; <span class="hljs-title function_">iterator</span><span class="hljs-params">()</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Collection</span>&lt;E, T&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Iterable</span> &#123;<br><br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">add</span><span class="hljs-params">(E e)</span>;<br><br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">remove</span><span class="hljs-params">(E e)</span>;<br><br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">addLink</span><span class="hljs-params">(String key, T t)</span>;<br><br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">removeLink</span><span class="hljs-params">(String key)</span>;<br><br>    Iterator&lt;E&gt; <span class="hljs-title function_">iterator</span><span class="hljs-params">()</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>



<p><strong>链路</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Link</span> &#123;<br><br>    <span class="hljs-keyword">private</span> String fromId;<br>    <span class="hljs-keyword">private</span> String toId;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Link</span><span class="hljs-params">(String fromId, String toId)</span> &#123;<br>        <span class="hljs-built_in">this</span>.fromId = fromId;<br>        <span class="hljs-built_in">this</span>.toId = toId;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getFromId</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> fromId;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setFromId</span><span class="hljs-params">(String fromId)</span> &#123;<br>        <span class="hljs-built_in">this</span>.fromId = fromId;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getToId</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> toId;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setToId</span><span class="hljs-params">(String toId)</span> &#123;<br>        <span class="hljs-built_in">this</span>.toId = toId;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 遍历操作</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GroupStructure</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Collection</span>&lt;Employee, Link&gt; &#123;<br><br>    <span class="hljs-keyword">private</span> String groupId;<br>    <span class="hljs-keyword">private</span> String groupName;<br><br>    <span class="hljs-keyword">private</span> Map&lt;String, Employee&gt; employeeMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();<br>    <span class="hljs-keyword">private</span> Map&lt;String, List&lt;Link&gt;&gt; linkMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();<br>    <span class="hljs-keyword">private</span> Map&lt;String, String&gt; invertedMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">GroupStructure</span><span class="hljs-params">(String groupId, String groupName)</span> &#123;<br>        <span class="hljs-built_in">this</span>.groupId = groupId;<br>        <span class="hljs-built_in">this</span>.groupName = groupName;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">add</span><span class="hljs-params">(Employee employee)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span> != employeeMap.put(employee.getuId(), employee);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">remove</span><span class="hljs-params">(Employee employee)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span> != employeeMap.remove(employee.getuId());<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">addLink</span><span class="hljs-params">(String key, Link link)</span> &#123;<br>        invertedMap.put(link.getToId(), link.getFromId());<br>        <span class="hljs-keyword">if</span> (linkMap.containsKey(key))&#123;<br>            <span class="hljs-keyword">return</span> linkMap.get(key).add(link);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            LinkedList&lt;Link&gt; links = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedList</span>&lt;&gt;();<br>            links.add(link);<br>            linkMap.put(key, links);<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">removeLink</span><span class="hljs-params">(String key)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span> != linkMap.remove(key);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Iterator&lt;Employee&gt; <span class="hljs-title function_">iterator</span><span class="hljs-params">()</span> &#123;<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Iterator</span>&lt;Employee&gt;() &#123;<br><br>            HashMap&lt;String, Integer&gt; keyMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br><br>            <span class="hljs-type">int</span> <span class="hljs-variable">totalIdx</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>            <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> <span class="hljs-variable">fromId</span> <span class="hljs-operator">=</span> groupId;<br>            <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> <span class="hljs-variable">toId</span> <span class="hljs-operator">=</span> groupId;<br><br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">hasNext</span><span class="hljs-params">()</span> &#123;<br>                <span class="hljs-keyword">return</span> totalIdx &lt; employeeMap.size();<br>            &#125;<br><br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> Employee <span class="hljs-title function_">next</span><span class="hljs-params">()</span> &#123;<br><br>                List&lt;Link&gt; links = linkMap.get(toId);<br>                <span class="hljs-type">int</span> <span class="hljs-variable">cursorIdx</span> <span class="hljs-operator">=</span> getCursorIdx(toId);<br><br>                <span class="hljs-comment">// 同级节点扫描</span><br>                <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> == links)&#123;<br>                    cursorIdx = getCursorIdx(fromId);<br>                    links = linkMap.get(fromId);<br>                &#125;<br><br>                <span class="hljs-comment">// 上级节点扫描</span><br>                <span class="hljs-keyword">while</span> (cursorIdx &gt; links.size() - <span class="hljs-number">1</span>)&#123;<br>                    fromId = invertedMap.get(fromId);<br>                    cursorIdx = getCursorIdx(fromId);<br>                    links = linkMap.get(fromId);<br>                &#125;<br><br>                <span class="hljs-comment">// 获取节点</span><br>                <span class="hljs-type">Link</span> <span class="hljs-variable">link</span> <span class="hljs-operator">=</span> links.get(cursorIdx);<br>                toId = link.getToId();<br>                fromId = link.getFromId();<br>                totalIdx++;<br><br>                <span class="hljs-keyword">return</span> employeeMap.get(link.getToId());<br>            &#125;<br><br>            <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getCursorIdx</span><span class="hljs-params">(String key)</span> &#123;<br>                <span class="hljs-type">int</span> <span class="hljs-variable">idx</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>                <span class="hljs-keyword">if</span> (keyMap.containsKey(key)) &#123;<br>                    idx = keyMap.get(key);<br>                    keyMap.put(key, ++idx);<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    keyMap.put(key, idx);<br>                &#125;<br>                <span class="hljs-keyword">return</span> idx;<br>            &#125;<br>        &#125;;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 遍历测试</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApiTest</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(ApiTest.class);<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test_iterator</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">GroupStructure</span> <span class="hljs-variable">groupStructure</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GroupStructure</span>(<span class="hljs-string">&quot;1&quot;</span>, <span class="hljs-string">&quot;小傅哥&quot;</span>);<br>        groupStructure.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Employee</span>(<span class="hljs-string">&quot;2&quot;</span>, <span class="hljs-string">&quot;花花&quot;</span>, <span class="hljs-string">&quot;二级部门&quot;</span>));<br>        groupStructure.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Employee</span>(<span class="hljs-string">&quot;3&quot;</span>, <span class="hljs-string">&quot;豆包&quot;</span>, <span class="hljs-string">&quot;二级部门&quot;</span>));<br>        groupStructure.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Employee</span>(<span class="hljs-string">&quot;4&quot;</span>, <span class="hljs-string">&quot;蹦蹦&quot;</span>, <span class="hljs-string">&quot;三级部门&quot;</span>));<br>        groupStructure.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Employee</span>(<span class="hljs-string">&quot;5&quot;</span>, <span class="hljs-string">&quot;大烧&quot;</span>, <span class="hljs-string">&quot;三级部门&quot;</span>));<br>        groupStructure.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Employee</span>(<span class="hljs-string">&quot;6&quot;</span>, <span class="hljs-string">&quot;虎哥&quot;</span>, <span class="hljs-string">&quot;四级部门&quot;</span>));<br>        groupStructure.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Employee</span>(<span class="hljs-string">&quot;7&quot;</span>, <span class="hljs-string">&quot;玲姐&quot;</span>, <span class="hljs-string">&quot;四级部门&quot;</span>));<br>        groupStructure.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Employee</span>(<span class="hljs-string">&quot;8&quot;</span>, <span class="hljs-string">&quot;秋雅&quot;</span>, <span class="hljs-string">&quot;四级部门&quot;</span>));<br><br>        groupStructure.addLink(<span class="hljs-string">&quot;1&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Link</span>(<span class="hljs-string">&quot;1&quot;</span>, <span class="hljs-string">&quot;2&quot;</span>));<br>        groupStructure.addLink(<span class="hljs-string">&quot;1&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Link</span>(<span class="hljs-string">&quot;1&quot;</span>, <span class="hljs-string">&quot;3&quot;</span>));<br><br>        groupStructure.addLink(<span class="hljs-string">&quot;2&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Link</span>(<span class="hljs-string">&quot;2&quot;</span>, <span class="hljs-string">&quot;4&quot;</span>));<br>        groupStructure.addLink(<span class="hljs-string">&quot;2&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Link</span>(<span class="hljs-string">&quot;2&quot;</span>, <span class="hljs-string">&quot;5&quot;</span>));<br><br>        groupStructure.addLink(<span class="hljs-string">&quot;5&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Link</span>(<span class="hljs-string">&quot;5&quot;</span>, <span class="hljs-string">&quot;6&quot;</span>));<br>        groupStructure.addLink(<span class="hljs-string">&quot;5&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Link</span>(<span class="hljs-string">&quot;5&quot;</span>, <span class="hljs-string">&quot;7&quot;</span>));<br>        groupStructure.addLink(<span class="hljs-string">&quot;5&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Link</span>(<span class="hljs-string">&quot;5&quot;</span>, <span class="hljs-string">&quot;8&quot;</span>));<br><br>        Iterator&lt;Employee&gt; iterator = groupStructure.iterator();<br>        <span class="hljs-keyword">while</span> (iterator.hasNext()) &#123;<br>            <span class="hljs-type">Employee</span> <span class="hljs-variable">employee</span> <span class="hljs-operator">=</span> iterator.next();<br>            logger.info(<span class="hljs-string">&quot;&#123;&#125; 雇员 ID：&#123;&#125; Name：&#123;&#125;&quot;</span>, employee.getDesc(), employee.getuId(), employee.getName());<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="中介者模式"><a href="#中介者模式" class="headerlink" title="中介者模式"></a>中介者模式</h2><blockquote>
<p> 定义一个中介对象来封装一系列对象之间的交互，使原有对象之间的耦合松散，且可以独立地改变它们之间的交互。中介者模式又叫调停模式，它是迪米特法则的典型应用</p>
</blockquote>
<ul>
<li>按照Mybatis原理手写ORM框架，给JDBC方式操作数据库增加中介者场景</li>
</ul>
<p><strong>po</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">School</span> &#123;<br><br>    <span class="hljs-keyword">private</span> Long id;<br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> String address;<br>    <span class="hljs-keyword">private</span> Date createTime;<br>    <span class="hljs-keyword">private</span> Date updateTime;<br><br>    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> id;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> &#123;<br>        <span class="hljs-built_in">this</span>.id = id;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getAddress</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> address;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAddress</span><span class="hljs-params">(String address)</span> &#123;<br>        <span class="hljs-built_in">this</span>.address = address;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Date <span class="hljs-title function_">getCreateTime</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> createTime;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setCreateTime</span><span class="hljs-params">(Date createTime)</span> &#123;<br>        <span class="hljs-built_in">this</span>.createTime = createTime;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Date <span class="hljs-title function_">getUpdateTime</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> updateTime;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUpdateTime</span><span class="hljs-params">(Date updateTime)</span> &#123;<br>        <span class="hljs-built_in">this</span>.updateTime = updateTime;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;<br><br>    <span class="hljs-keyword">private</span> Long id;<br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> Integer age;<br>    <span class="hljs-keyword">private</span> Date createTime;<br>    <span class="hljs-keyword">private</span> Date updateTime;<br><br>    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> id;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> &#123;<br>        <span class="hljs-built_in">this</span>.id = id;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> age;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(Integer age)</span> &#123;<br>        <span class="hljs-built_in">this</span>.age = age;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Date <span class="hljs-title function_">getCreateTime</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> createTime;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setCreateTime</span><span class="hljs-params">(Date createTime)</span> &#123;<br>        <span class="hljs-built_in">this</span>.createTime = createTime;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Date <span class="hljs-title function_">getUpdateTime</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> updateTime;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUpdateTime</span><span class="hljs-params">(Date updateTime)</span> &#123;<br>        <span class="hljs-built_in">this</span>.updateTime = updateTime;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<p><strong>dao</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ISchoolDao</span> &#123;<br><br>    School <span class="hljs-title function_">querySchoolInfoById</span><span class="hljs-params">(Long treeId)</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">IUserDao</span> &#123;<br><br>     User <span class="hljs-title function_">queryUserInfoById</span><span class="hljs-params">(Long id)</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>



<p><strong>ORM框架</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 配置类</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Configuration</span> &#123;<br><br>    <span class="hljs-keyword">protected</span> Connection connection;<br>    <span class="hljs-keyword">protected</span> Map&lt;String, String&gt; dataSource;<br>    <span class="hljs-keyword">protected</span> Map&lt;String, XNode&gt; mapperElement;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setConnection</span><span class="hljs-params">(Connection connection)</span> &#123;<br>        <span class="hljs-built_in">this</span>.connection = connection;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setDataSource</span><span class="hljs-params">(Map&lt;String, String&gt; dataSource)</span> &#123;<br>        <span class="hljs-built_in">this</span>.dataSource = dataSource;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setMapperElement</span><span class="hljs-params">(Map&lt;String, XNode&gt; mapperElement)</span> &#123;<br>        <span class="hljs-built_in">this</span>.mapperElement = mapperElement;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">SqlSession</span> &#123;<br><br>    &lt;T&gt; T <span class="hljs-title function_">selectOne</span><span class="hljs-params">(String statement)</span>;<br><br>    &lt;T&gt; T <span class="hljs-title function_">selectOne</span><span class="hljs-params">(String statement, Object parameter)</span>;<br><br>    &lt;T&gt; List&lt;T&gt; <span class="hljs-title function_">selectList</span><span class="hljs-params">(String statement)</span>;<br><br>    &lt;T&gt; List&lt;T&gt; <span class="hljs-title function_">selectList</span><span class="hljs-params">(String statement, Object parameter)</span>;<br><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DefaultSqlSession</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">SqlSession</span> &#123;<br><br>    <span class="hljs-keyword">private</span> Connection connection;<br>    <span class="hljs-keyword">private</span> Map&lt;String, XNode&gt; mapperElement;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">DefaultSqlSession</span><span class="hljs-params">(Connection connection, Map&lt;String, XNode&gt; mapperElement)</span> &#123;<br>        <span class="hljs-built_in">this</span>.connection = connection;<br>        <span class="hljs-built_in">this</span>.mapperElement = mapperElement;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> &lt;T&gt; T <span class="hljs-title function_">selectOne</span><span class="hljs-params">(String statement)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">XNode</span> <span class="hljs-variable">xNode</span> <span class="hljs-operator">=</span> mapperElement.get(statement);<br>            <span class="hljs-type">PreparedStatement</span> <span class="hljs-variable">preparedStatement</span> <span class="hljs-operator">=</span> connection.prepareStatement(xNode.getSql());<br>            <span class="hljs-type">ResultSet</span> <span class="hljs-variable">resultSet</span> <span class="hljs-operator">=</span> preparedStatement.executeQuery();<br>            List&lt;T&gt; objects = resultSet2Obj(resultSet, Class.forName(xNode.getResultType()));<br>            <span class="hljs-keyword">return</span> objects.get(<span class="hljs-number">0</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> &lt;T&gt; T <span class="hljs-title function_">selectOne</span><span class="hljs-params">(String statement, Object parameter)</span> &#123;<br>        <span class="hljs-type">XNode</span> <span class="hljs-variable">xNode</span> <span class="hljs-operator">=</span> mapperElement.get(statement);<br>        Map&lt;Integer, String&gt; parameterMap = xNode.getParameter();<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">PreparedStatement</span> <span class="hljs-variable">preparedStatement</span> <span class="hljs-operator">=</span> connection.prepareStatement(xNode.getSql());<br>            buildParameter(preparedStatement, parameter, parameterMap);<br>            <span class="hljs-type">ResultSet</span> <span class="hljs-variable">resultSet</span> <span class="hljs-operator">=</span> preparedStatement.executeQuery();<br>            List&lt;T&gt; objects = resultSet2Obj(resultSet, Class.forName(xNode.getResultType()));<br>            <span class="hljs-keyword">return</span> objects.get(<span class="hljs-number">0</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> &lt;T&gt; List&lt;T&gt; <span class="hljs-title function_">selectList</span><span class="hljs-params">(String statement)</span> &#123;<br>        <span class="hljs-type">XNode</span> <span class="hljs-variable">xNode</span> <span class="hljs-operator">=</span> mapperElement.get(statement);<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">PreparedStatement</span> <span class="hljs-variable">preparedStatement</span> <span class="hljs-operator">=</span> connection.prepareStatement(xNode.getSql());<br>            <span class="hljs-type">ResultSet</span> <span class="hljs-variable">resultSet</span> <span class="hljs-operator">=</span> preparedStatement.executeQuery();<br>            <span class="hljs-keyword">return</span> resultSet2Obj(resultSet, Class.forName(xNode.getResultType()));<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> &lt;T&gt; List&lt;T&gt; <span class="hljs-title function_">selectList</span><span class="hljs-params">(String statement, Object parameter)</span> &#123;<br>        <span class="hljs-type">XNode</span> <span class="hljs-variable">xNode</span> <span class="hljs-operator">=</span> mapperElement.get(statement);<br>        Map&lt;Integer, String&gt; parameterMap = xNode.getParameter();<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">PreparedStatement</span> <span class="hljs-variable">preparedStatement</span> <span class="hljs-operator">=</span> connection.prepareStatement(xNode.getSql());<br>            buildParameter(preparedStatement, parameter, parameterMap);<br>            <span class="hljs-type">ResultSet</span> <span class="hljs-variable">resultSet</span> <span class="hljs-operator">=</span> preparedStatement.executeQuery();<br>            <span class="hljs-keyword">return</span> resultSet2Obj(resultSet, Class.forName(xNode.getResultType()));<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">buildParameter</span><span class="hljs-params">(PreparedStatement preparedStatement, Object parameter, Map&lt;Integer, String&gt; parameterMap)</span> <span class="hljs-keyword">throws</span> SQLException, IllegalAccessException &#123;<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">size</span> <span class="hljs-operator">=</span> parameterMap.size();<br>        <span class="hljs-comment">// 单个参数</span><br>        <span class="hljs-keyword">if</span> (parameter <span class="hljs-keyword">instanceof</span> Long) &#123;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt;= size; i++) &#123;<br>                preparedStatement.setLong(i, Long.parseLong(parameter.toString()));<br>            &#125;<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (parameter <span class="hljs-keyword">instanceof</span> Integer) &#123;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt;= size; i++) &#123;<br>                preparedStatement.setInt(i, Integer.parseInt(parameter.toString()));<br>            &#125;<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (parameter <span class="hljs-keyword">instanceof</span> String) &#123;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt;= size; i++) &#123;<br>                preparedStatement.setString(i, parameter.toString());<br>            &#125;<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br><br>        Map&lt;String, Object&gt; fieldMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        <span class="hljs-comment">// 对象参数</span><br>        Field[] declaredFields = parameter.getClass().getDeclaredFields();<br>        <span class="hljs-keyword">for</span> (Field field : declaredFields) &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> field.getName();<br>            field.setAccessible(<span class="hljs-literal">true</span>);<br>            <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> field.get(parameter);<br>            field.setAccessible(<span class="hljs-literal">false</span>);<br>            fieldMap.put(name, obj);<br>        &#125;<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt;= size; i++) &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">parameterDefine</span> <span class="hljs-operator">=</span> parameterMap.get(i);<br>            <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> fieldMap.get(parameterDefine);<br><br>            <span class="hljs-keyword">if</span> (obj <span class="hljs-keyword">instanceof</span> Short) &#123;<br>                preparedStatement.setShort(i, Short.parseShort(obj.toString()));<br>                <span class="hljs-keyword">continue</span>;<br>            &#125;<br><br>            <span class="hljs-keyword">if</span> (obj <span class="hljs-keyword">instanceof</span> Integer) &#123;<br>                preparedStatement.setInt(i, Integer.parseInt(obj.toString()));<br>                <span class="hljs-keyword">continue</span>;<br>            &#125;<br><br>            <span class="hljs-keyword">if</span> (obj <span class="hljs-keyword">instanceof</span> Long) &#123;<br>                preparedStatement.setLong(i, Long.parseLong(obj.toString()));<br>                <span class="hljs-keyword">continue</span>;<br>            &#125;<br><br>            <span class="hljs-keyword">if</span> (obj <span class="hljs-keyword">instanceof</span> String) &#123;<br>                preparedStatement.setString(i, obj.toString());<br>                <span class="hljs-keyword">continue</span>;<br>            &#125;<br><br>            <span class="hljs-keyword">if</span> (obj <span class="hljs-keyword">instanceof</span> Date) &#123;<br>                preparedStatement.setDate(i, (java.sql.Date) obj);<br>            &#125;<br><br>        &#125;<br><br>    &#125;<br><br>    <span class="hljs-keyword">private</span> &lt;T&gt; List&lt;T&gt; <span class="hljs-title function_">resultSet2Obj</span><span class="hljs-params">(ResultSet resultSet, Class&lt;?&gt; clazz)</span> &#123;<br>        List&lt;T&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">ResultSetMetaData</span> <span class="hljs-variable">metaData</span> <span class="hljs-operator">=</span> resultSet.getMetaData();<br>            <span class="hljs-type">int</span> <span class="hljs-variable">columnCount</span> <span class="hljs-operator">=</span> metaData.getColumnCount();<br>            <span class="hljs-comment">// 每次遍历行值</span><br>            <span class="hljs-keyword">while</span> (resultSet.next()) &#123;<br>                <span class="hljs-type">T</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> (T) clazz.newInstance();<br>                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt;= columnCount; i++) &#123;<br>                    <span class="hljs-type">Object</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> resultSet.getObject(i);<br>                    <span class="hljs-type">String</span> <span class="hljs-variable">columnName</span> <span class="hljs-operator">=</span> metaData.getColumnName(i);<br>                    <span class="hljs-type">String</span> <span class="hljs-variable">setMethod</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;set&quot;</span> + columnName.substring(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>).toUpperCase() + columnName.substring(<span class="hljs-number">1</span>);<br>                    Method method;<br>                    <span class="hljs-keyword">if</span> (value <span class="hljs-keyword">instanceof</span> Timestamp) &#123;<br>                        method = clazz.getMethod(setMethod, Date.class);<br>                    &#125; <span class="hljs-keyword">else</span> &#123;<br>                        method = clazz.getMethod(setMethod, value.getClass());<br>                    &#125;<br>                    method.invoke(obj, value);<br>                &#125;<br>                list.add(obj);<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        <span class="hljs-keyword">return</span> list;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> == connection) <span class="hljs-keyword">return</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            connection.close();<br>        &#125; <span class="hljs-keyword">catch</span> (SQLException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">SqlSessionFactory</span> &#123;<br><br>    SqlSession <span class="hljs-title function_">openSession</span><span class="hljs-params">()</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DefaultSqlSessionFactory</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">SqlSessionFactory</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Configuration configuration;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">DefaultSqlSessionFactory</span><span class="hljs-params">(Configuration configuration)</span> &#123;<br>        <span class="hljs-built_in">this</span>.configuration = configuration;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> SqlSession <span class="hljs-title function_">openSession</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultSqlSession</span>(configuration.connection, configuration.mapperElement);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<p><strong>构建者</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SqlSessionFactoryBuilder</span> &#123;<br><br>    <span class="hljs-keyword">public</span> DefaultSqlSessionFactory <span class="hljs-title function_">build</span><span class="hljs-params">(Reader reader)</span> &#123;<br>        <span class="hljs-type">SAXReader</span> <span class="hljs-variable">saxReader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SAXReader</span>();<br>        <span class="hljs-keyword">try</span> &#123;<br>            saxReader.setEntityResolver(<span class="hljs-keyword">new</span> <span class="hljs-title class_">XMLMapperEntityResolver</span>());<br>            <span class="hljs-type">Document</span> <span class="hljs-variable">document</span> <span class="hljs-operator">=</span> saxReader.read(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InputSource</span>(reader));<br>            <span class="hljs-type">Configuration</span> <span class="hljs-variable">configuration</span> <span class="hljs-operator">=</span> parseConfiguration(document.getRootElement());<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultSqlSessionFactory</span>(configuration);<br>        &#125; <span class="hljs-keyword">catch</span> (DocumentException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> Configuration <span class="hljs-title function_">parseConfiguration</span><span class="hljs-params">(Element root)</span> &#123;<br>        <span class="hljs-type">Configuration</span> <span class="hljs-variable">configuration</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>();<br>        configuration.setDataSource(dataSource(root.selectNodes(<span class="hljs-string">&quot;//dataSource&quot;</span>)));<br>        configuration.setConnection(connection(configuration.dataSource));<br>        configuration.setMapperElement(mapperElement(root.selectNodes(<span class="hljs-string">&quot;mappers&quot;</span>)));<br>        <span class="hljs-keyword">return</span> configuration;<br>    &#125;<br><br>    <span class="hljs-comment">// 获取数据源配置信息</span><br>    <span class="hljs-keyword">private</span> Map&lt;String, String&gt; <span class="hljs-title function_">dataSource</span><span class="hljs-params">(List&lt;Element&gt; list)</span> &#123;<br>        Map&lt;String, String&gt; dataSource = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;(<span class="hljs-number">4</span>);<br>        <span class="hljs-type">Element</span> <span class="hljs-variable">element</span> <span class="hljs-operator">=</span> list.get(<span class="hljs-number">0</span>);<br>        <span class="hljs-type">List</span> <span class="hljs-variable">content</span> <span class="hljs-operator">=</span> element.content();<br>        <span class="hljs-keyword">for</span> (Object o : content) &#123;<br>            <span class="hljs-type">Element</span> <span class="hljs-variable">e</span> <span class="hljs-operator">=</span> (Element) o;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> e.attributeValue(<span class="hljs-string">&quot;name&quot;</span>);<br>            <span class="hljs-type">String</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> e.attributeValue(<span class="hljs-string">&quot;value&quot;</span>);<br>            dataSource.put(name, value);<br>        &#125;<br>        <span class="hljs-keyword">return</span> dataSource;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> Connection <span class="hljs-title function_">connection</span><span class="hljs-params">(Map&lt;String, String&gt; dataSource)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            Class.forName(dataSource.get(<span class="hljs-string">&quot;driver&quot;</span>));<br>            <span class="hljs-keyword">return</span> DriverManager.getConnection(dataSource.get(<span class="hljs-string">&quot;url&quot;</span>), dataSource.get(<span class="hljs-string">&quot;username&quot;</span>), dataSource.get(<span class="hljs-string">&quot;password&quot;</span>));<br>        &#125; <span class="hljs-keyword">catch</span> (ClassNotFoundException | SQLException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// 获取SQL语句信息</span><br>    <span class="hljs-keyword">private</span> Map&lt;String, XNode&gt; <span class="hljs-title function_">mapperElement</span><span class="hljs-params">(List&lt;Element&gt; list)</span> &#123;<br>        Map&lt;String, XNode&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br><br>        <span class="hljs-type">Element</span> <span class="hljs-variable">element</span> <span class="hljs-operator">=</span> list.get(<span class="hljs-number">0</span>);<br>        <span class="hljs-type">List</span> <span class="hljs-variable">content</span> <span class="hljs-operator">=</span> element.content();<br>        <span class="hljs-keyword">for</span> (Object o : content) &#123;<br>            <span class="hljs-type">Element</span> <span class="hljs-variable">e</span> <span class="hljs-operator">=</span> (Element) o;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">resource</span> <span class="hljs-operator">=</span> e.attributeValue(<span class="hljs-string">&quot;resource&quot;</span>);<br><br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-type">Reader</span> <span class="hljs-variable">reader</span> <span class="hljs-operator">=</span> Resources.getResourceAsReader(resource);<br>                <span class="hljs-type">SAXReader</span> <span class="hljs-variable">saxReader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SAXReader</span>();<br>                <span class="hljs-type">Document</span> <span class="hljs-variable">document</span> <span class="hljs-operator">=</span> saxReader.read(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InputSource</span>(reader));<br>                <span class="hljs-type">Element</span> <span class="hljs-variable">root</span> <span class="hljs-operator">=</span> document.getRootElement();<br>                <span class="hljs-comment">//命名空间</span><br>                <span class="hljs-type">String</span> <span class="hljs-variable">namespace</span> <span class="hljs-operator">=</span> root.attributeValue(<span class="hljs-string">&quot;namespace&quot;</span>);<br><br>                <span class="hljs-comment">// SELECT</span><br>                List&lt;Element&gt; selectNodes = root.selectNodes(<span class="hljs-string">&quot;select&quot;</span>);<br>                <span class="hljs-keyword">for</span> (Element node : selectNodes) &#123;<br>                    <span class="hljs-type">String</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> node.attributeValue(<span class="hljs-string">&quot;id&quot;</span>);<br>                    <span class="hljs-type">String</span> <span class="hljs-variable">parameterType</span> <span class="hljs-operator">=</span> node.attributeValue(<span class="hljs-string">&quot;parameterType&quot;</span>);<br>                    <span class="hljs-type">String</span> <span class="hljs-variable">resultType</span> <span class="hljs-operator">=</span> node.attributeValue(<span class="hljs-string">&quot;resultType&quot;</span>);<br>                    <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> node.getText();<br><br>                    <span class="hljs-comment">// ? 匹配</span><br>                    Map&lt;Integer, String&gt; parameter = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>                    <span class="hljs-type">Pattern</span> <span class="hljs-variable">pattern</span> <span class="hljs-operator">=</span> Pattern.compile(<span class="hljs-string">&quot;(#\\&#123;(.*?)&#125;)&quot;</span>);<br>                    <span class="hljs-type">Matcher</span> <span class="hljs-variable">matcher</span> <span class="hljs-operator">=</span> pattern.matcher(sql);<br>                    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; matcher.find(); i++) &#123;<br>                        <span class="hljs-type">String</span> <span class="hljs-variable">g1</span> <span class="hljs-operator">=</span> matcher.group(<span class="hljs-number">1</span>);<br>                        <span class="hljs-type">String</span> <span class="hljs-variable">g2</span> <span class="hljs-operator">=</span> matcher.group(<span class="hljs-number">2</span>);<br>                        parameter.put(i, g2);<br>                        sql = sql.replace(g1, <span class="hljs-string">&quot;?&quot;</span>);<br>                    &#125;<br><br>                    <span class="hljs-type">XNode</span> <span class="hljs-variable">xNode</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">XNode</span>();<br>                    xNode.setNamespace(namespace);<br>                    xNode.setId(id);<br>                    xNode.setParameterType(parameterType);<br>                    xNode.setResultType(resultType);<br>                    xNode.setSql(sql);<br>                    xNode.setParameter(parameter);<br><br>                    map.put(namespace + <span class="hljs-string">&quot;.&quot;</span> + id, xNode);<br>                &#125;<br>            &#125; <span class="hljs-keyword">catch</span> (Exception ex) &#123;<br>                ex.printStackTrace();<br>            &#125;<br><br>        &#125;<br>        <span class="hljs-keyword">return</span> map;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">mapper</span> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="hljs-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;cn.bugstack.design.dao.ISchoolDao&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;querySchoolInfoById&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;cn.bugstack.design.po.School&quot;</span>&gt;</span><br>        SELECT id, name, address, createTime, updateTime<br>        FROM school<br>        where id = #&#123;id&#125;<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br>    <br><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span><br></code></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">mapper</span> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="hljs-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;cn.bugstack.design.dao.IUserDao&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;queryUserInfoById&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;java.lang.Long&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;cn.bugstack.design.po.User&quot;</span>&gt;</span><br>        SELECT id, name, age, createTime, updateTime<br>        FROM user<br>        where id = #&#123;id&#125;<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;queryUserList&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;cn.bugstack.design.po.User&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;cn.bugstack.design.po.User&quot;</span>&gt;</span><br>        SELECT id, name, age, createTime, updateTime<br>        FROM user<br>        where age = #&#123;age&#125;<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br>    <br><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span><br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Resources</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Reader <span class="hljs-title function_">getResourceAsReader</span><span class="hljs-params">(String resource)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InputStreamReader</span>(getResourceAsStream(resource));<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> InputStream <span class="hljs-title function_">getResourceAsStream</span><span class="hljs-params">(String resource)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        ClassLoader[] classLoaders = getClassLoaders();<br>        <span class="hljs-keyword">for</span> (ClassLoader classLoader : classLoaders) &#123;<br>            <span class="hljs-type">InputStream</span> <span class="hljs-variable">inputStream</span> <span class="hljs-operator">=</span> classLoader.getResourceAsStream(resource);<br>            <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> != inputStream) &#123;<br>                <span class="hljs-keyword">return</span> inputStream;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IOException</span>(<span class="hljs-string">&quot;Could not find resource &quot;</span> + resource);<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ClassLoader[] getClassLoaders() &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassLoader</span>[]&#123;<br>                ClassLoader.getSystemClassLoader(),<br>                Thread.currentThread().getContextClassLoader()&#125;;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">XNode</span> &#123;<br><br>    <span class="hljs-keyword">private</span> String namespace;<br>    <span class="hljs-keyword">private</span> String id;<br>    <span class="hljs-keyword">private</span> String parameterType;<br>    <span class="hljs-keyword">private</span> String resultType;<br>    <span class="hljs-keyword">private</span> String sql;<br>    <span class="hljs-keyword">private</span> Map&lt;Integer, String&gt; parameter;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getNamespace</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> namespace;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setNamespace</span><span class="hljs-params">(String namespace)</span> &#123;<br>        <span class="hljs-built_in">this</span>.namespace = namespace;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> id;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(String id)</span> &#123;<br>        <span class="hljs-built_in">this</span>.id = id;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getParameterType</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> parameterType;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setParameterType</span><span class="hljs-params">(String parameterType)</span> &#123;<br>        <span class="hljs-built_in">this</span>.parameterType = parameterType;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getResultType</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> resultType;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setResultType</span><span class="hljs-params">(String resultType)</span> &#123;<br>        <span class="hljs-built_in">this</span>.resultType = resultType;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getSql</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> sql;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setSql</span><span class="hljs-params">(String sql)</span> &#123;<br>        <span class="hljs-built_in">this</span>.sql = sql;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Map&lt;Integer, String&gt; <span class="hljs-title function_">getParameter</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> parameter;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setParameter</span><span class="hljs-params">(Map&lt;Integer, String&gt; parameter)</span> &#123;<br>        <span class="hljs-built_in">this</span>.parameter = parameter;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<p><strong>测试</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApiTest</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(ApiTest.class);<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test_queryUserInfoById</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">resource</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;mybatis-config-datasource.xml&quot;</span>;<br>        Reader reader;<br>        <span class="hljs-keyword">try</span> &#123;<br>            reader = Resources.getResourceAsReader(resource);<br>            <span class="hljs-type">SqlSessionFactory</span> <span class="hljs-variable">sqlMapper</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SqlSessionFactoryBuilder</span>().build(reader);<br><br>            <span class="hljs-type">SqlSession</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sqlMapper.openSession();<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> session.selectOne(<span class="hljs-string">&quot;cn.bugstack.design.dao.IUserDao.queryUserInfoById&quot;</span>, <span class="hljs-number">1L</span>);<br>                logger.info(<span class="hljs-string">&quot;测试结果：&#123;&#125;&quot;</span>, JSON.toJSONString(user));<br>            &#125; <span class="hljs-keyword">finally</span> &#123;<br>                session.close();<br>                reader.close();<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125;<br><br>    &#125;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test_queryUserList</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">resource</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;mybatis-config-datasource.xml&quot;</span>;<br>        Reader reader;<br>        <span class="hljs-keyword">try</span> &#123;<br>            reader = Resources.getResourceAsReader(resource);<br>            <span class="hljs-type">SqlSessionFactory</span> <span class="hljs-variable">sqlMapper</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SqlSessionFactoryBuilder</span>().build(reader);<br><br>            <span class="hljs-type">SqlSession</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sqlMapper.openSession();<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-type">User</span> <span class="hljs-variable">req</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();<br>                req.setAge(<span class="hljs-number">18</span>);<br>                List&lt;User&gt; userList = session.selectList(<span class="hljs-string">&quot;cn.bugstack.design.dao.IUserDao.queryUserList&quot;</span>, req);<br>                logger.info(<span class="hljs-string">&quot;测试结果：&#123;&#125;&quot;</span>, JSON.toJSONString(userList));<br>            &#125; <span class="hljs-keyword">finally</span> &#123;<br>                session.close();<br>                reader.close();<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="备忘录模式"><a href="#备忘录模式" class="headerlink" title="备忘录模式"></a>备忘录模式</h2><blockquote>
<p>在不破坏封装性的前提下，捕获一个对象的内部状态，并在该对象之外保存这个状态，以便以后当需要时能够将该对象恢复到原先保存的状态</p>
</blockquote>
<ul>
<li>模拟互联网系统上线过程中，配置文件回滚场景</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 配置文件</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigFile</span> &#123;<br><br>    <span class="hljs-comment">// 版本号</span><br>    <span class="hljs-keyword">private</span> String versionNo;<br>    <span class="hljs-comment">// 内容</span><br>    <span class="hljs-keyword">private</span> String content;<br>    <span class="hljs-comment">// 时间</span><br>    <span class="hljs-keyword">private</span> Date dateTime;<br>    <span class="hljs-comment">// 操作人</span><br>    <span class="hljs-keyword">private</span> String operator;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ConfigFile</span><span class="hljs-params">(String versionNo, String content, Date dateTime, String operator)</span> &#123;<br>        <span class="hljs-built_in">this</span>.versionNo = versionNo;<br>        <span class="hljs-built_in">this</span>.content = content;<br>        <span class="hljs-built_in">this</span>.dateTime = dateTime;<br>        <span class="hljs-built_in">this</span>.operator = operator;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getVersionNo</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> versionNo;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setVersionNo</span><span class="hljs-params">(String versionNo)</span> &#123;<br>        <span class="hljs-built_in">this</span>.versionNo = versionNo;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getContent</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> content;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setContent</span><span class="hljs-params">(String content)</span> &#123;<br>        <span class="hljs-built_in">this</span>.content = content;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Date <span class="hljs-title function_">getDateTime</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> dateTime;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setDateTime</span><span class="hljs-params">(Date dateTime)</span> &#123;<br>        <span class="hljs-built_in">this</span>.dateTime = dateTime;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getOperator</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> operator;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setOperator</span><span class="hljs-params">(String operator)</span> &#123;<br>        <span class="hljs-built_in">this</span>.operator = operator;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 管理员</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Admin</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">cursorIdx</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">private</span> List&lt;ConfigMemento&gt; mementoList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>    <span class="hljs-keyword">private</span> Map&lt;String, ConfigMemento&gt; mementoMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">append</span><span class="hljs-params">(ConfigMemento memento)</span> &#123;<br>        mementoList.add(memento);<br>        mementoMap.put(memento.getConfigFile().getVersionNo(), memento);<br>        cursorIdx++;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> ConfigMemento <span class="hljs-title function_">undo</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (--cursorIdx &lt;= <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> mementoList.get(<span class="hljs-number">0</span>);<br>        <span class="hljs-keyword">return</span> mementoList.get(cursorIdx);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> ConfigMemento <span class="hljs-title function_">redo</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (++cursorIdx &gt; mementoList.size()) <span class="hljs-keyword">return</span> mementoList.get(mementoList.size() - <span class="hljs-number">1</span>);<br>        <span class="hljs-keyword">return</span> mementoList.get(cursorIdx);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> ConfigMemento <span class="hljs-title function_">get</span><span class="hljs-params">(String versionNo)</span> &#123;<br>        <span class="hljs-keyword">return</span> mementoMap.get(versionNo);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<p><strong>创建备忘录</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 备忘录</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigMemento</span> &#123;<br><br>    <span class="hljs-keyword">private</span> ConfigFile configFile;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ConfigMemento</span><span class="hljs-params">(ConfigFile configFile)</span> &#123;<br>        <span class="hljs-built_in">this</span>.configFile = configFile;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> ConfigFile <span class="hljs-title function_">getConfigFile</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> configFile;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setConfigFile</span><span class="hljs-params">(ConfigFile configFile)</span> &#123;<br>        <span class="hljs-built_in">this</span>.configFile = configFile;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 记录者</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigOriginator</span> &#123;<br><br>    <span class="hljs-keyword">private</span> ConfigFile configFile;<br><br>    <span class="hljs-keyword">public</span> ConfigFile <span class="hljs-title function_">getConfigFile</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> configFile;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setConfigFile</span><span class="hljs-params">(ConfigFile configFile)</span> &#123;<br>        <span class="hljs-built_in">this</span>.configFile = configFile;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> ConfigMemento <span class="hljs-title function_">saveMemento</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConfigMemento</span>(<span class="hljs-built_in">this</span>.configFile);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">getMemento</span><span class="hljs-params">(ConfigMemento configMemento)</span>&#123;<br>        <span class="hljs-built_in">this</span>.configFile = configMemento.getConfigFile();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 单元测试</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApiTest</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(ApiTest.class);<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">Admin</span> <span class="hljs-variable">admin</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Admin</span>();<br><br>        <span class="hljs-type">ConfigOriginator</span> <span class="hljs-variable">configOriginator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConfigOriginator</span>();<br><br>        configOriginator.setConfigFile(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ConfigFile</span>(<span class="hljs-string">&quot;1000001&quot;</span>, <span class="hljs-string">&quot;配置内容A=哈哈&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(), <span class="hljs-string">&quot;小傅哥&quot;</span>));<br>        admin.append(configOriginator.saveMemento()); <span class="hljs-comment">// 保存配置</span><br><br>        configOriginator.setConfigFile(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ConfigFile</span>(<span class="hljs-string">&quot;1000002&quot;</span>, <span class="hljs-string">&quot;配置内容A=嘻嘻&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(), <span class="hljs-string">&quot;小傅哥&quot;</span>));<br>        admin.append(configOriginator.saveMemento()); <span class="hljs-comment">// 保存配置</span><br><br>        configOriginator.setConfigFile(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ConfigFile</span>(<span class="hljs-string">&quot;1000003&quot;</span>, <span class="hljs-string">&quot;配置内容A=么么&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(), <span class="hljs-string">&quot;小傅哥&quot;</span>));<br>        admin.append(configOriginator.saveMemento()); <span class="hljs-comment">// 保存配置</span><br><br>        configOriginator.setConfigFile(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ConfigFile</span>(<span class="hljs-string">&quot;1000004&quot;</span>, <span class="hljs-string">&quot;配置内容A=嘿嘿&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(), <span class="hljs-string">&quot;小傅哥&quot;</span>));<br>        admin.append(configOriginator.saveMemento()); <span class="hljs-comment">// 保存配置</span><br><br>        <span class="hljs-comment">// 历史配置(回滚)</span><br>        configOriginator.getMemento(admin.undo());<br>        logger.info(<span class="hljs-string">&quot;历史配置(回滚)undo：&#123;&#125;&quot;</span>, JSON.toJSONString(configOriginator.getConfigFile()));<br><br>        <span class="hljs-comment">// 历史配置(回滚)</span><br>        configOriginator.getMemento(admin.undo());<br>        logger.info(<span class="hljs-string">&quot;历史配置(回滚)undo：&#123;&#125;&quot;</span>, JSON.toJSONString(configOriginator.getConfigFile()));<br><br>        <span class="hljs-comment">// 历史配置(前进)</span><br>        configOriginator.getMemento(admin.redo());<br>        logger.info(<span class="hljs-string">&quot;历史配置(前进)redo：&#123;&#125;&quot;</span>, JSON.toJSONString(configOriginator.getConfigFile()));<br><br>        <span class="hljs-comment">// 历史配置(获取)</span><br>        configOriginator.getMemento(admin.get(<span class="hljs-string">&quot;1000002&quot;</span>));<br>        logger.info(<span class="hljs-string">&quot;历史配置(获取)get：&#123;&#125;&quot;</span>, JSON.toJSONString(configOriginator.getConfigFile()));<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="观察者模式"><a href="#观察者模式" class="headerlink" title="观察者模式"></a>观察者模式</h2><blockquote>
<p>指多个对象间存在一对多的依赖关系，当一个对象的状态发生改变时，所有依赖于它的对象都得到通知并被自动更新。这种模式有时又称作发布-订阅模式、模型-视图模式，它是对象行为型模式</p>
</blockquote>
<ul>
<li>模型类似小客车指标摇号过程，监听消息通知用户中签场景</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LotteryResult</span> &#123;<br><br>    <span class="hljs-keyword">private</span> String uId;    <span class="hljs-comment">// 用户ID</span><br>    <span class="hljs-keyword">private</span> String msg;    <span class="hljs-comment">// 摇号信息</span><br>    <span class="hljs-keyword">private</span> Date dateTime; <span class="hljs-comment">// 业务时间</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">LotteryResult</span><span class="hljs-params">(String uId, String msg, Date dateTime)</span> &#123;<br>        <span class="hljs-built_in">this</span>.uId = uId;<br>        <span class="hljs-built_in">this</span>.msg = msg;<br>        <span class="hljs-built_in">this</span>.dateTime = dateTime;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getuId</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> uId;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setuId</span><span class="hljs-params">(String uId)</span> &#123;<br>        <span class="hljs-built_in">this</span>.uId = uId;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getMsg</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> msg;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setMsg</span><span class="hljs-params">(String msg)</span> &#123;<br>        <span class="hljs-built_in">this</span>.msg = msg;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Date <span class="hljs-title function_">getDateTime</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> dateTime;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setDateTime</span><span class="hljs-params">(Date dateTime)</span> &#123;<br>        <span class="hljs-built_in">this</span>.dateTime = dateTime;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 摇号服务抽象类，也可以创建接口，在用抽象类实现</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LotteryService</span> &#123;<br><br>    <span class="hljs-keyword">private</span> EventManager eventManager;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">LotteryService</span><span class="hljs-params">()</span> &#123;<br>        eventManager = <span class="hljs-keyword">new</span> <span class="hljs-title class_">EventManager</span>(EventManager.EventType.MQ, EventManager.EventType.Message);<br>        eventManager.subscribe(EventManager.EventType.MQ, <span class="hljs-keyword">new</span> <span class="hljs-title class_">MQEventListener</span>());<br>        eventManager.subscribe(EventManager.EventType.Message, <span class="hljs-keyword">new</span> <span class="hljs-title class_">MessageEventListener</span>());<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> LotteryResult <span class="hljs-title function_">draw</span><span class="hljs-params">(String uId)</span> &#123;<br>        <span class="hljs-type">LotteryResult</span> <span class="hljs-variable">lotteryResult</span> <span class="hljs-operator">=</span> doDraw(uId);<br>        eventManager.notify(EventManager.EventType.MQ, lotteryResult);<br>        eventManager.notify(EventManager.EventType.Message, lotteryResult);<br>        <span class="hljs-keyword">return</span> lotteryResult;<br>    &#125;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> LotteryResult <span class="hljs-title function_">doDraw</span><span class="hljs-params">(String uId)</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 摇号服务实现</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LotteryServiceImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">LotteryService</span>&#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">MinibusTargetService</span> <span class="hljs-variable">minibusTargetService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MinibusTargetService</span>();<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> LotteryResult <span class="hljs-title function_">doDraw</span><span class="hljs-params">(String uId)</span> &#123;<br>        <span class="hljs-comment">// 摇号</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">lottery</span> <span class="hljs-operator">=</span> minibusTargetService.lottery(uId);<br>        <span class="hljs-comment">// 结果</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LotteryResult</span>(uId, lottery, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<p><strong>事件</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@description</span> 事件管理者</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EventManager</span> &#123;<br><br>    Map&lt;Enum&lt;EventType&gt;, List&lt;EventListener&gt;&gt; listeners = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">EventManager</span><span class="hljs-params">(Enum&lt;EventType&gt;... operations)</span> &#123;<br>        <span class="hljs-keyword">for</span> (Enum&lt;EventType&gt; operation : operations) &#123;<br>            <span class="hljs-built_in">this</span>.listeners.put(operation, <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;());<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">EventType</span> &#123;<br>        MQ, Message<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 订阅</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> eventType 事件类型</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> listener  监听</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">subscribe</span><span class="hljs-params">(Enum&lt;EventType&gt; eventType, EventListener listener)</span> &#123;<br>        List&lt;EventListener&gt; users = listeners.get(eventType);<br>        users.add(listener);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 取消订阅</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> eventType 事件类型</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> listener  监听</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">unsubscribe</span><span class="hljs-params">(Enum&lt;EventType&gt; eventType, EventListener listener)</span> &#123;<br>        List&lt;EventListener&gt; users = listeners.get(eventType);<br>        users.remove(listener);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 通知</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> eventType 事件类型</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> result    结果</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">notify</span><span class="hljs-params">(Enum&lt;EventType&gt; eventType, LotteryResult result)</span> &#123;<br>        List&lt;EventListener&gt; users = listeners.get(eventType);<br>        <span class="hljs-keyword">for</span> (EventListener listener : users) &#123;<br>            listener.doEvent(result);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<p><strong>监听</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 监听接口</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">EventListener</span> &#123;<br><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">doEvent</span><span class="hljs-params">(LotteryResult result)</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 短信通知</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MessageEventListener</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">EventListener</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(MessageEventListener.class);<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doEvent</span><span class="hljs-params">(LotteryResult result)</span> &#123;<br>        logger.info(<span class="hljs-string">&quot;给用户 &#123;&#125; 发送短信通知(短信)：&#123;&#125;&quot;</span>, result.getuId(), result.getMsg());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MQEventListener</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">EventListener</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(MQEventListener.class);<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doEvent</span><span class="hljs-params">(LotteryResult result)</span> &#123;<br>        logger.info(<span class="hljs-string">&quot;记录用户 &#123;&#125; 摇号结果(MQ)：&#123;&#125;&quot;</span>, result.getuId(), result.getMsg());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 测试</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApiTest</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(ApiTest.class);<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test_draw</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">LotteryService</span> <span class="hljs-variable">lotteryService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LotteryServiceImpl</span>();<br>        <span class="hljs-type">LotteryResult</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> lotteryService.draw(<span class="hljs-string">&quot;1000000101010019&quot;</span>);<br>        logger.info(<span class="hljs-string">&quot;Result:&#123;&#125;&quot;</span>, JSON.toJSONString(result));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="状态模式"><a href="#状态模式" class="headerlink" title="状态模式"></a>状态模式</h2><blockquote>
<p>对有状态的对象，把复杂的 “判断逻辑” 提取到不同的状态对象中，允许状态对象在其内部状态发生改变时改变其行为</p>
</blockquote>
<ul>
<li>模拟系统营销活动，状态流程审核发布上线场景</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Result</span> &#123;<br><br>    <span class="hljs-keyword">private</span> String code; <span class="hljs-comment">// 编码</span><br>    <span class="hljs-keyword">private</span> String info; <span class="hljs-comment">// 描述</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Result</span><span class="hljs-params">(String code, String info)</span> &#123;<br>        <span class="hljs-built_in">this</span>.code = code;<br>        <span class="hljs-built_in">this</span>.info = info;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getCode</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> code;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setCode</span><span class="hljs-params">(String code)</span> &#123;<br>        <span class="hljs-built_in">this</span>.code = code;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getInfo</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> info;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setInfo</span><span class="hljs-params">(String info)</span> &#123;<br>        <span class="hljs-built_in">this</span>.info = info;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">State</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 活动提审</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> activityId    活动ID</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> currentStatus 当前状态</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 执行结果</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> Result <span class="hljs-title function_">arraignment</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 审核通过</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> activityId    活动ID</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> currentStatus 当前状态</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 执行结果</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> Result <span class="hljs-title function_">checkPass</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 审核拒绝</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> activityId    活动ID</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> currentStatus 当前状态</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 执行结果</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> Result <span class="hljs-title function_">checkRefuse</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 撤审撤销</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> activityId    活动ID</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> currentStatus 当前状态</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 执行结果</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> Result <span class="hljs-title function_">checkRevoke</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 活动关闭</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> activityId    活动ID</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> currentStatus 当前状态</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 执行结果</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> Result <span class="hljs-title function_">close</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 活动开启</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> activityId    活动ID</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> currentStatus 当前状态</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 执行结果</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> Result <span class="hljs-title function_">open</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 活动执行</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> activityId    活动ID</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> currentStatus 当前状态</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 执行结果</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> Result <span class="hljs-title function_">doing</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>



<p><strong>状态</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 待审核</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CheckState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">State</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">arraignment</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>(<span class="hljs-string">&quot;0001&quot;</span>, <span class="hljs-string">&quot;待审核状态不可重复提审&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">checkPass</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        ActivityService.execStatus(activityId, currentStatus, Status.Pass);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>(<span class="hljs-string">&quot;0000&quot;</span>, <span class="hljs-string">&quot;活动审核通过完成&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">checkRefuse</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        ActivityService.execStatus(activityId, currentStatus, Status.Refuse);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>(<span class="hljs-string">&quot;0000&quot;</span>, <span class="hljs-string">&quot;活动审核拒绝完成&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">checkRevoke</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        ActivityService.execStatus(activityId, currentStatus, Status.Editing);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>(<span class="hljs-string">&quot;0000&quot;</span>, <span class="hljs-string">&quot;活动审核撤销回到编辑中&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">close</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        ActivityService.execStatus(activityId, currentStatus, Status.Close);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>(<span class="hljs-string">&quot;0000&quot;</span>, <span class="hljs-string">&quot;活动审核关闭完成&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">open</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>(<span class="hljs-string">&quot;0001&quot;</span>, <span class="hljs-string">&quot;非关闭活动不可开启&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">doing</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>(<span class="hljs-string">&quot;0001&quot;</span>, <span class="hljs-string">&quot;待审核活动不可执行活动中变更&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 活动状态；活动关闭</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CloseState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">State</span> &#123;<br><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">arraignment</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>(<span class="hljs-string">&quot;0001&quot;</span>, <span class="hljs-string">&quot;活动关闭不可提审&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">checkPass</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>(<span class="hljs-string">&quot;0001&quot;</span>, <span class="hljs-string">&quot;活动关闭不可审核通过&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">checkRefuse</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>(<span class="hljs-string">&quot;0001&quot;</span>, <span class="hljs-string">&quot;活动关闭不可审核拒绝&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">checkRevoke</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>(<span class="hljs-string">&quot;0001&quot;</span>, <span class="hljs-string">&quot;活动关闭不可撤销审核&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">close</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>(<span class="hljs-string">&quot;0001&quot;</span>, <span class="hljs-string">&quot;活动关闭不可重复关闭&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">open</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        ActivityService.execStatus(activityId, currentStatus, Status.Open);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>(<span class="hljs-string">&quot;0000&quot;</span>, <span class="hljs-string">&quot;活动开启完成&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">doing</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>(<span class="hljs-string">&quot;0001&quot;</span>, <span class="hljs-string">&quot;活动关闭不可变更活动中&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 活动状态；活动中</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DoingState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">State</span> &#123;<br><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">arraignment</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>(<span class="hljs-string">&quot;0001&quot;</span>, <span class="hljs-string">&quot;活动中不可提审&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">checkPass</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>(<span class="hljs-string">&quot;0001&quot;</span>, <span class="hljs-string">&quot;活动中不可审核通过&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">checkRefuse</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>(<span class="hljs-string">&quot;0001&quot;</span>, <span class="hljs-string">&quot;活动中不可审核拒绝&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">checkRevoke</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>(<span class="hljs-string">&quot;0001&quot;</span>, <span class="hljs-string">&quot;活动中不可撤销审核&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">close</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        ActivityService.execStatus(activityId, currentStatus, Status.Close);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>(<span class="hljs-string">&quot;0000&quot;</span>, <span class="hljs-string">&quot;活动关闭成功&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">open</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>(<span class="hljs-string">&quot;0001&quot;</span>, <span class="hljs-string">&quot;活动中不可开启&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">doing</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>(<span class="hljs-string">&quot;0001&quot;</span>, <span class="hljs-string">&quot;活动中不可重复执行&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 活动状态；编辑中</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EditingState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">State</span> &#123;<br><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">arraignment</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        ActivityService.execStatus(activityId, currentStatus, Status.Check);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>(<span class="hljs-string">&quot;0000&quot;</span>, <span class="hljs-string">&quot;活动提审成功&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">checkPass</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>(<span class="hljs-string">&quot;0001&quot;</span>, <span class="hljs-string">&quot;编辑中不可审核通过&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">checkRefuse</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>(<span class="hljs-string">&quot;0001&quot;</span>, <span class="hljs-string">&quot;编辑中不可审核拒绝&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">checkRevoke</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>(<span class="hljs-string">&quot;0001&quot;</span>, <span class="hljs-string">&quot;编辑中不可撤销审核&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">close</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        ActivityService.execStatus(activityId, currentStatus, Status.Close);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>(<span class="hljs-string">&quot;0000&quot;</span>, <span class="hljs-string">&quot;活动关闭成功&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">open</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>(<span class="hljs-string">&quot;0001&quot;</span>, <span class="hljs-string">&quot;非关闭活动不可开启&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">doing</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>(<span class="hljs-string">&quot;0001&quot;</span>, <span class="hljs-string">&quot;编辑中活动不可执行活动中变更&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 活动状态；活动开启</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OpenState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">State</span> &#123;<br><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">arraignment</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>(<span class="hljs-string">&quot;0001&quot;</span>, <span class="hljs-string">&quot;活动开启不可提审&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">checkPass</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>(<span class="hljs-string">&quot;0001&quot;</span>, <span class="hljs-string">&quot;活动开启不可审核通过&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">checkRefuse</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>(<span class="hljs-string">&quot;0001&quot;</span>, <span class="hljs-string">&quot;活动开启不可审核拒绝&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">checkRevoke</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>(<span class="hljs-string">&quot;0001&quot;</span>, <span class="hljs-string">&quot;活动开启不可撤销审核&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">close</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        ActivityService.execStatus(activityId, currentStatus, Status.Close);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>(<span class="hljs-string">&quot;0000&quot;</span>, <span class="hljs-string">&quot;活动关闭完成&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">open</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>(<span class="hljs-string">&quot;0001&quot;</span>, <span class="hljs-string">&quot;活动不可重复开启&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">doing</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        ActivityService.execStatus(activityId, currentStatus, Status.Doing);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>(<span class="hljs-string">&quot;0000&quot;</span>, <span class="hljs-string">&quot;活动变更活动中完成&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 活动状态；审核通过</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PassState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">State</span> &#123;<br><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">arraignment</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>(<span class="hljs-string">&quot;0001&quot;</span>, <span class="hljs-string">&quot;已审核状态不可重复提审&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">checkPass</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>(<span class="hljs-string">&quot;0001&quot;</span>, <span class="hljs-string">&quot;已审核状态不可重复审核&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">checkRefuse</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        ActivityService.execStatus(activityId, currentStatus, Status.Refuse);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>(<span class="hljs-string">&quot;0000&quot;</span>, <span class="hljs-string">&quot;活动审核拒绝完成&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">checkRevoke</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>(<span class="hljs-string">&quot;0001&quot;</span>, <span class="hljs-string">&quot;审核通过不可撤销(可先拒绝审核)&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">close</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        ActivityService.execStatus(activityId, currentStatus, Status.Close);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>(<span class="hljs-string">&quot;0000&quot;</span>, <span class="hljs-string">&quot;活动审核关闭完成&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">open</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>(<span class="hljs-string">&quot;0001&quot;</span>, <span class="hljs-string">&quot;非关闭活动不可开启&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">doing</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        ActivityService.execStatus(activityId, currentStatus, Status.Doing);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>(<span class="hljs-string">&quot;0000&quot;</span>, <span class="hljs-string">&quot;活动变更活动中完成&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 活动状态；审核拒绝</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RefuseState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">State</span> &#123;<br><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">arraignment</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>(<span class="hljs-string">&quot;0001&quot;</span>, <span class="hljs-string">&quot;已审核状态不可重复提审&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">checkPass</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>(<span class="hljs-string">&quot;0001&quot;</span>, <span class="hljs-string">&quot;已审核状态不可重复审核&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">checkRefuse</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        ActivityService.execStatus(activityId, currentStatus, Status.Refuse);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>(<span class="hljs-string">&quot;0000&quot;</span>, <span class="hljs-string">&quot;活动审核拒绝不可重复审核&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">checkRevoke</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        ActivityService.execStatus(activityId, currentStatus, Status.Editing);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>(<span class="hljs-string">&quot;0000&quot;</span>, <span class="hljs-string">&quot;撤销审核完成&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">close</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        ActivityService.execStatus(activityId, currentStatus, Status.Close);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>(<span class="hljs-string">&quot;0000&quot;</span>, <span class="hljs-string">&quot;活动审核关闭完成&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">open</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>(<span class="hljs-string">&quot;0001&quot;</span>, <span class="hljs-string">&quot;非关闭活动不可开启&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">doing</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>(<span class="hljs-string">&quot;0001&quot;</span>, <span class="hljs-string">&quot;审核拒绝不可执行活动为进行中&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<p><strong>包装处理</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StateHandler</span> &#123;<br><br>    <span class="hljs-keyword">private</span> Map&lt;Enum&lt;Status&gt;, State&gt; stateMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">StateHandler</span><span class="hljs-params">()</span> &#123;<br>        stateMap.put(Status.Check, <span class="hljs-keyword">new</span> <span class="hljs-title class_">CheckState</span>());     <span class="hljs-comment">// 待审核</span><br>        stateMap.put(Status.Close, <span class="hljs-keyword">new</span> <span class="hljs-title class_">CloseState</span>());     <span class="hljs-comment">// 已关闭</span><br>        stateMap.put(Status.Doing, <span class="hljs-keyword">new</span> <span class="hljs-title class_">DoingState</span>());     <span class="hljs-comment">// 活动中</span><br>        stateMap.put(Status.Editing, <span class="hljs-keyword">new</span> <span class="hljs-title class_">EditingState</span>()); <span class="hljs-comment">// 编辑中</span><br>        stateMap.put(Status.Open, <span class="hljs-keyword">new</span> <span class="hljs-title class_">OpenState</span>());       <span class="hljs-comment">// 已开启</span><br>        stateMap.put(Status.Pass, <span class="hljs-keyword">new</span> <span class="hljs-title class_">PassState</span>());       <span class="hljs-comment">// 审核通过</span><br>        stateMap.put(Status.Refuse, <span class="hljs-keyword">new</span> <span class="hljs-title class_">RefuseState</span>());   <span class="hljs-comment">// 审核拒绝</span><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">arraignment</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> stateMap.get(currentStatus).arraignment(activityId, currentStatus);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">checkPass</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> stateMap.get(currentStatus).checkPass(activityId, currentStatus);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">checkRefuse</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> stateMap.get(currentStatus).checkRefuse(activityId, currentStatus);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">checkRevoke</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> stateMap.get(currentStatus).checkRevoke(activityId, currentStatus);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">close</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> stateMap.get(currentStatus).close(activityId, currentStatus);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">open</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> stateMap.get(currentStatus).open(activityId, currentStatus);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">doing</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> stateMap.get(currentStatus).doing(activityId, currentStatus);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 单元测试</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApiTest</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(ApiTest.class);<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test_Editing2Arraignment</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">activityId</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;100001&quot;</span>;<br>        ActivityService.init(activityId, Status.Editing);<br><br>        <span class="hljs-type">StateHandler</span> <span class="hljs-variable">stateHandler</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StateHandler</span>();<br>        <span class="hljs-type">Result</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> stateHandler.arraignment(activityId, Status.Editing);<br><br>        logger.info(<span class="hljs-string">&quot;测试结果(编辑中To提审活动)：&#123;&#125;&quot;</span>, JSON.toJSONString(result));<br>        logger.info(<span class="hljs-string">&quot;活动信息：&#123;&#125; 状态：&#123;&#125;&quot;</span>, JSON.toJSONString(ActivityService.queryActivityInfo(activityId)), JSON.toJSONString(ActivityService.queryActivityInfo(activityId).getStatus()));<br>    &#125;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test_Editing2Open</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">activityId</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;100001&quot;</span>;<br>        ActivityService.init(activityId, Status.Editing);<br><br>        <span class="hljs-type">StateHandler</span> <span class="hljs-variable">stateHandler</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StateHandler</span>();<br>        <span class="hljs-type">Result</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> stateHandler.open(activityId, Status.Editing);<br><br>        logger.info(<span class="hljs-string">&quot;测试结果(编辑中To开启活动)：&#123;&#125;&quot;</span>, JSON.toJSONString(result));<br>        logger.info(<span class="hljs-string">&quot;活动信息：&#123;&#125; 状态：&#123;&#125;&quot;</span>, JSON.toJSONString(ActivityService.queryActivityInfo(activityId)), JSON.toJSONString(ActivityService.queryActivityInfo(activityId).getStatus()));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="策略模式"><a href="#策略模式" class="headerlink" title="策略模式"></a>策略模式</h2><blockquote>
<p>指定义了一系列算法，并将每个算法封装起来，使它们可以相互替换，且算法的变化不会影响使用算法的客户。策略模式属于对象行为模式，它通过对算法进行封装，把使用算法的责任和算法的实现分割开来，并委派给不同的对象对这些算法进行管理</p>
</blockquote>
<ul>
<li>模拟多种营销类型优惠券，折扣金额计算策略场景</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 优惠券折扣计算接口</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ICouponDiscount</span>&lt;T&gt; &#123;<br><br>    BigDecimal <span class="hljs-title function_">discountAmount</span><span class="hljs-params">(T couponInfo, BigDecimal skuPrice)</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>



<p><strong>实现</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MJCouponDiscount</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ICouponDiscount</span>&lt;Map&lt;String,String&gt;&gt; &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 满减计算</span><br><span class="hljs-comment">     * 1. 判断满足x元后-n元，否则不减</span><br><span class="hljs-comment">     * 2. 最低支付金额1元</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> BigDecimal <span class="hljs-title function_">discountAmount</span><span class="hljs-params">(Map&lt;String, String&gt; couponInfo, BigDecimal skuPrice)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">x</span> <span class="hljs-operator">=</span> couponInfo.get(<span class="hljs-string">&quot;x&quot;</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> couponInfo.get(<span class="hljs-string">&quot;n&quot;</span>);<br><br>        <span class="hljs-comment">// 小于商品金额条件的，直接返回商品原价</span><br>        <span class="hljs-keyword">if</span> (skuPrice.compareTo(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(x)) &lt; <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> skuPrice;<br>        <span class="hljs-comment">// 减去优惠金额判断</span><br>        <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">discountAmount</span> <span class="hljs-operator">=</span> skuPrice.subtract(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(o));<br>        <span class="hljs-keyword">if</span> (discountAmount.compareTo(BigDecimal.ZERO) &lt; <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> BigDecimal.ONE;<br><br>        <span class="hljs-keyword">return</span> discountAmount;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NYGCouponDiscount</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ICouponDiscount</span>&lt;Double&gt; &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * n元购购买</span><br><span class="hljs-comment">     * 1. 无论原价多少钱都固定金额购买</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> BigDecimal <span class="hljs-title function_">discountAmount</span><span class="hljs-params">(Double couponInfo, BigDecimal skuPrice)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(couponInfo);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ZJCouponDiscount</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ICouponDiscount</span>&lt;Double&gt; &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 直减计算</span><br><span class="hljs-comment">     * 1. 使用商品价格减去优惠价格</span><br><span class="hljs-comment">     * 2. 最低支付金额1元</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> BigDecimal <span class="hljs-title function_">discountAmount</span><span class="hljs-params">(Double couponInfo, BigDecimal skuPrice)</span> &#123;<br>        <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">discountAmount</span> <span class="hljs-operator">=</span> skuPrice.subtract(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(couponInfo));<br>        <span class="hljs-keyword">if</span> (discountAmount.compareTo(BigDecimal.ZERO) &lt; <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> BigDecimal.ONE;<br>        <span class="hljs-keyword">return</span> discountAmount;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ZKCouponDiscount</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ICouponDiscount</span>&lt;Double&gt; &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 折扣计算</span><br><span class="hljs-comment">     * 1. 使用商品价格乘以折扣比例，为最后支付金额</span><br><span class="hljs-comment">     * 2. 保留两位小数</span><br><span class="hljs-comment">     * 3. 最低支付金额1元</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> BigDecimal <span class="hljs-title function_">discountAmount</span><span class="hljs-params">(Double couponInfo, BigDecimal skuPrice)</span> &#123;<br>        <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">discountAmount</span> <span class="hljs-operator">=</span> skuPrice.multiply(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(couponInfo)).setScale(<span class="hljs-number">2</span>, BigDecimal.ROUND_HALF_UP);<br>        <span class="hljs-keyword">if</span> (discountAmount.compareTo(BigDecimal.ZERO) &lt; <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> BigDecimal.ONE;<br>        <span class="hljs-keyword">return</span> discountAmount;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<p><strong>管理类</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Context</span>&lt;T&gt; &#123;<br><br>    <span class="hljs-keyword">private</span> ICouponDiscount&lt;T&gt; couponDiscount;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Context</span><span class="hljs-params">(ICouponDiscount&lt;T&gt; couponDiscount)</span> &#123;<br>        <span class="hljs-built_in">this</span>.couponDiscount = couponDiscount;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> BigDecimal <span class="hljs-title function_">discountAmount</span><span class="hljs-params">(T couponInfo, BigDecimal skuPrice)</span> &#123;<br>        <span class="hljs-keyword">return</span> couponDiscount.discountAmount(couponInfo, skuPrice);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 测试</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApiTest</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(ApiTest.class);<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test_zj</span><span class="hljs-params">()</span> &#123;<br>        Context&lt;Double&gt; context = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Context</span>&lt;&gt;(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ZJCouponDiscount</span>());<br>        <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">discountAmount</span> <span class="hljs-operator">=</span> context.discountAmount(<span class="hljs-number">10D</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-number">100</span>));<br>        logger.info(<span class="hljs-string">&quot;测试结果：直减优惠后金额 &#123;&#125;&quot;</span>, discountAmount);<br>    &#125;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test_mj</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// 满100减10，商品100元</span><br>        Context&lt;Map&lt;String,String&gt;&gt; context = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Context</span>&lt;Map&lt;String,String&gt;&gt;(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MJCouponDiscount</span>());<br>        Map&lt;String,String&gt; mapReq = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;String, String&gt;();<br>        mapReq.put(<span class="hljs-string">&quot;x&quot;</span>,<span class="hljs-string">&quot;100&quot;</span>);<br>        mapReq.put(<span class="hljs-string">&quot;n&quot;</span>,<span class="hljs-string">&quot;10&quot;</span>);<br>        <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">discountAmount</span> <span class="hljs-operator">=</span> context.discountAmount(mapReq, <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-number">100</span>));<br>        logger.info(<span class="hljs-string">&quot;测试结果：满减优惠后金额 &#123;&#125;&quot;</span>, discountAmount);<br>    &#125;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test_zk</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// 折扣9折，商品100元</span><br>        Context&lt;Double&gt; context = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Context</span>&lt;Double&gt;(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ZKCouponDiscount</span>());<br>        <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">discountAmount</span> <span class="hljs-operator">=</span> context.discountAmount(<span class="hljs-number">0.9D</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-number">100</span>));<br>        logger.info(<span class="hljs-string">&quot;测试结果：折扣9折后金额 &#123;&#125;&quot;</span>, discountAmount);<br>    &#125;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test_nyg</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// n元购；100-10，商品100元</span><br>        Context&lt;Double&gt; context = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Context</span>&lt;Double&gt;(<span class="hljs-keyword">new</span> <span class="hljs-title class_">NYGCouponDiscount</span>());<br>        <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">discountAmount</span> <span class="hljs-operator">=</span> context.discountAmount(<span class="hljs-number">90D</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-number">100</span>));<br>        logger.info(<span class="hljs-string">&quot;测试结果：n元购优惠后金额 &#123;&#125;&quot;</span>, discountAmount);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="模板模式"><a href="#模板模式" class="headerlink" title="模板模式"></a>模板模式</h2><blockquote>
<p>指定义一个操作中的算法骨架，而将算法的一些步骤延迟到子类中，使得子类可以不改变该算法结构的情况下重定义该算法的某些特定步骤。它是一种类行为型模式</p>
</blockquote>
<ul>
<li>模拟爬虫各类电商商品，生成营销推广海报场景</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 抽象模板</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NetMall</span> &#123;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(NetMall.class);<br><br>    String uId;   <span class="hljs-comment">// 用户ID</span><br>    String uPwd;  <span class="hljs-comment">// 用户密码</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">NetMall</span><span class="hljs-params">(String uId, String uPwd)</span> &#123;<br>        <span class="hljs-built_in">this</span>.uId = uId;<br>        <span class="hljs-built_in">this</span>.uPwd = uPwd;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 生成商品推广海报</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> skuUrl 商品地址(京东、淘宝、当当)</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 海报图片base64位信息</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">generateGoodsPoster</span><span class="hljs-params">(String skuUrl)</span> &#123;<br>        <span class="hljs-keyword">if</span> (!login(uId, uPwd)) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;             <span class="hljs-comment">// 1. 验证登录</span><br><br>        Map&lt;String, String&gt; reptile = reptile(skuUrl);  <span class="hljs-comment">// 2. 爬虫商品</span><br><br>        <span class="hljs-keyword">return</span> createBase64(reptile);                   <span class="hljs-comment">// 3. 组装海报</span><br>    &#125;<br><br>    <span class="hljs-comment">// 模拟登录</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> Boolean <span class="hljs-title function_">login</span><span class="hljs-params">(String uId, String uPwd)</span>;<br><br>    <span class="hljs-comment">// 爬虫提取商品信息(登录后的优惠价格)</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> Map&lt;String, String&gt; <span class="hljs-title function_">reptile</span><span class="hljs-params">(String skuUrl)</span>;<br><br>    <span class="hljs-comment">// 生成商品海报信息</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> String <span class="hljs-title function_">createBase64</span><span class="hljs-params">(Map&lt;String, String&gt; goodsInfo)</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpClient</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">doGet</span><span class="hljs-params">(String httpurl)</span> &#123;<br>        <span class="hljs-type">HttpURLConnection</span> <span class="hljs-variable">connection</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-type">InputStream</span> <span class="hljs-variable">is</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-type">BufferedReader</span> <span class="hljs-variable">br</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<span class="hljs-comment">// 返回结果字符串</span><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// 创建远程url连接对象</span><br>            <span class="hljs-type">URL</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">URL</span>(httpurl);<br>            <span class="hljs-comment">// 通过远程url连接对象打开一个连接，强转成httpURLConnection类</span><br>            connection = (HttpURLConnection) url.openConnection();<br>            <span class="hljs-comment">// 设置连接方式：get</span><br>            connection.setRequestMethod(<span class="hljs-string">&quot;GET&quot;</span>);<br>            <span class="hljs-comment">// 设置连接主机服务器的超时时间：15000毫秒</span><br>            connection.setConnectTimeout(<span class="hljs-number">15000</span>);<br>            <span class="hljs-comment">// 设置读取远程返回的数据时间：60000毫秒</span><br>            connection.setReadTimeout(<span class="hljs-number">60000</span>);<br>            <span class="hljs-comment">// 发送请求</span><br>            connection.connect();<br>            <span class="hljs-comment">// 通过connection连接，获取输入流</span><br>            <span class="hljs-keyword">if</span> (connection.getResponseCode() == <span class="hljs-number">200</span>) &#123;<br>                is = connection.getInputStream();<br>                <span class="hljs-comment">// 封装输入流is，并指定字符集</span><br>                br = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedReader</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InputStreamReader</span>(is, <span class="hljs-string">&quot;UTF-8&quot;</span>));<br>                <span class="hljs-comment">// 存放数据</span><br>                <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">sbf</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();<br>                <span class="hljs-type">String</span> <span class="hljs-variable">temp</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>                <span class="hljs-keyword">while</span> ((temp = br.readLine()) != <span class="hljs-literal">null</span>) &#123;<br>                    sbf.append(temp);<br>                    sbf.append(<span class="hljs-string">&quot;\r\n&quot;</span>);<br>                &#125;<br>                result = sbf.toString();<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (MalformedURLException e) &#123;<br>            e.printStackTrace();<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            e.printStackTrace();<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-comment">// 关闭资源</span><br>            <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> != br) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    br.close();<br>                &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>            &#125;<br><br>            <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> != is) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    is.close();<br>                &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>            &#125;<br><br>            <span class="hljs-keyword">assert</span> connection != <span class="hljs-literal">null</span>;<br>            connection.disconnect();<span class="hljs-comment">// 关闭远程连接</span><br>        &#125;<br><br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<p><strong>接口实现</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DangDangNetMall</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">NetMall</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">DangDangNetMall</span><span class="hljs-params">(String uId, String uPwd)</span> &#123;<br>        <span class="hljs-built_in">super</span>(uId, uPwd);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Boolean <span class="hljs-title function_">login</span><span class="hljs-params">(String uId, String uPwd)</span> &#123;<br>        logger.info(<span class="hljs-string">&quot;模拟当当用户登录 uId：&#123;&#125; uPwd：&#123;&#125;&quot;</span>, uId, uPwd);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Map&lt;String, String&gt; <span class="hljs-title function_">reptile</span><span class="hljs-params">(String skuUrl)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> HttpClient.doGet(skuUrl);<br>        <span class="hljs-type">Pattern</span> <span class="hljs-variable">p9</span> <span class="hljs-operator">=</span> Pattern.compile(<span class="hljs-string">&quot;(?&lt;=title\\&gt;).*(?=&lt;/title)&quot;</span>);<br>        <span class="hljs-type">Matcher</span> <span class="hljs-variable">m9</span> <span class="hljs-operator">=</span> p9.matcher(str);<br>        Map&lt;String, String&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;String, String&gt;();<br>        <span class="hljs-keyword">if</span> (m9.find()) &#123;<br>            map.put(<span class="hljs-string">&quot;name&quot;</span>, m9.group());<br>        &#125;<br>        map.put(<span class="hljs-string">&quot;price&quot;</span>, <span class="hljs-string">&quot;4548.00&quot;</span>);<br>        logger.info(<span class="hljs-string">&quot;模拟当当商品爬虫解析：&#123;&#125; | &#123;&#125; 元 &#123;&#125;&quot;</span>, map.get(<span class="hljs-string">&quot;name&quot;</span>), map.get(<span class="hljs-string">&quot;price&quot;</span>), skuUrl);<br>        <span class="hljs-keyword">return</span> map;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">createBase64</span><span class="hljs-params">(Map&lt;String, String&gt; goodsInfo)</span> &#123;<br>        <span class="hljs-type">BASE64Encoder</span> <span class="hljs-variable">encoder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BASE64Encoder</span>();<br>        logger.info(<span class="hljs-string">&quot;模拟生成当当商品base64海报&quot;</span>);<br>        <span class="hljs-keyword">return</span> encoder.encode(JSON.toJSONString(goodsInfo).getBytes());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 模拟JD商城</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JDNetMall</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">NetMall</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">JDNetMall</span><span class="hljs-params">(String uId, String uPwd)</span> &#123;<br>        <span class="hljs-built_in">super</span>(uId, uPwd);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Boolean <span class="hljs-title function_">login</span><span class="hljs-params">(String uId, String uPwd)</span> &#123;<br>        logger.info(<span class="hljs-string">&quot;模拟京东用户登录 uId：&#123;&#125; uPwd：&#123;&#125;&quot;</span>, uId, uPwd);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Map&lt;String, String&gt; <span class="hljs-title function_">reptile</span><span class="hljs-params">(String skuUrl)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> HttpClient.doGet(skuUrl);<br>        <span class="hljs-type">Pattern</span> <span class="hljs-variable">p9</span> <span class="hljs-operator">=</span> Pattern.compile(<span class="hljs-string">&quot;(?&lt;=title\\&gt;).*(?=&lt;/title)&quot;</span>);<br>        <span class="hljs-type">Matcher</span> <span class="hljs-variable">m9</span> <span class="hljs-operator">=</span> p9.matcher(str);<br>        Map&lt;String, String&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;String, String&gt;();<br>        <span class="hljs-keyword">if</span> (m9.find()) &#123;<br>            map.put(<span class="hljs-string">&quot;name&quot;</span>, m9.group());<br>        &#125;<br>        map.put(<span class="hljs-string">&quot;price&quot;</span>, <span class="hljs-string">&quot;5999.00&quot;</span>);<br>        logger.info(<span class="hljs-string">&quot;模拟京东商品爬虫解析：&#123;&#125; | &#123;&#125; 元 &#123;&#125;&quot;</span>, map.get(<span class="hljs-string">&quot;name&quot;</span>), map.get(<span class="hljs-string">&quot;price&quot;</span>), skuUrl);<br>        <span class="hljs-keyword">return</span> map;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">createBase64</span><span class="hljs-params">(Map&lt;String, String&gt; goodsInfo)</span> &#123;<br>        <span class="hljs-type">BASE64Encoder</span> <span class="hljs-variable">encoder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BASE64Encoder</span>();<br>        logger.info(<span class="hljs-string">&quot;模拟生成京东商品base64海报&quot;</span>);<br>        <span class="hljs-keyword">return</span> encoder.encode(JSON.toJSONString(goodsInfo).getBytes());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TaoBaoNetMall</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">NetMall</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">TaoBaoNetMall</span><span class="hljs-params">(String uId, String uPwd)</span> &#123;<br>        <span class="hljs-built_in">super</span>(uId, uPwd);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Boolean <span class="hljs-title function_">login</span><span class="hljs-params">(String uId, String uPwd)</span> &#123;<br>        logger.info(<span class="hljs-string">&quot;模拟淘宝用户登录 uId：&#123;&#125; uPwd：&#123;&#125;&quot;</span>, uId, uPwd);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Map&lt;String, String&gt; <span class="hljs-title function_">reptile</span><span class="hljs-params">(String skuUrl)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> HttpClient.doGet(skuUrl);<br>        <span class="hljs-type">Pattern</span> <span class="hljs-variable">p9</span> <span class="hljs-operator">=</span> Pattern.compile(<span class="hljs-string">&quot;(?&lt;=title\\&gt;).*(?=&lt;/title)&quot;</span>);<br>        <span class="hljs-type">Matcher</span> <span class="hljs-variable">m9</span> <span class="hljs-operator">=</span> p9.matcher(str);<br>        Map&lt;String, String&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;String, String&gt;();<br>        <span class="hljs-keyword">if</span> (m9.find()) &#123;<br>            map.put(<span class="hljs-string">&quot;name&quot;</span>, m9.group());<br>        &#125;<br>        map.put(<span class="hljs-string">&quot;price&quot;</span>, <span class="hljs-string">&quot;4799.00&quot;</span>);<br>        logger.info(<span class="hljs-string">&quot;模拟淘宝商品爬虫解析：&#123;&#125; | &#123;&#125; 元 &#123;&#125;&quot;</span>, map.get(<span class="hljs-string">&quot;name&quot;</span>), map.get(<span class="hljs-string">&quot;price&quot;</span>), skuUrl);<br>        <span class="hljs-keyword">return</span> map;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">createBase64</span><span class="hljs-params">(Map&lt;String, String&gt; goodsInfo)</span> &#123;<br>        <span class="hljs-type">BASE64Encoder</span> <span class="hljs-variable">encoder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BASE64Encoder</span>();<br>        logger.info(<span class="hljs-string">&quot;模拟生成淘宝商品base64海报&quot;</span>);<br>        <span class="hljs-keyword">return</span> encoder.encode(JSON.toJSONString(goodsInfo).getBytes());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 测试类</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApiTest</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(ApiTest.class);<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 测试链接</span><br><span class="hljs-comment">     * 京东；https://item.jd.com/100008348542.html</span><br><span class="hljs-comment">     * 淘宝；https://detail.tmall.com/item.htm</span><br><span class="hljs-comment">     * 当当；http://product.dangdang.com/1509704171.html</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test_NetMall</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">NetMall</span> <span class="hljs-variable">netMall</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JDNetMall</span>(<span class="hljs-string">&quot;1000001&quot;</span>,<span class="hljs-string">&quot;*******&quot;</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">base64</span> <span class="hljs-operator">=</span> netMall.generateGoodsPoster(<span class="hljs-string">&quot;https://item.jd.com/100008348542.html&quot;</span>);<br>        logger.info(<span class="hljs-string">&quot;测试结果：&#123;&#125;&quot;</span>, base64);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="访问者模式"><a href="#访问者模式" class="headerlink" title="访问者模式"></a>访问者模式</h2><blockquote>
<p>指将作用于某种数据结构中的各元素的操作分离出来封装成独立的类，使其在不改变数据结构的前提下可以添加作用于这些元素的新的操作，为数据结构中的每个元素提供多种访问方式</p>
</blockquote>
<ul>
<li>模拟家长与校长，对学生和老师的不同视角信息的访问场景</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 用户类</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;<br><br>    <span class="hljs-keyword">public</span> String name;      <span class="hljs-comment">// 姓名</span><br>    <span class="hljs-keyword">public</span> String identity;  <span class="hljs-comment">// 身份；重点班、普通班 | 特级教师、普通教师、实习教师</span><br>    <span class="hljs-keyword">public</span> String clazz;     <span class="hljs-comment">// 班级</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">User</span><span class="hljs-params">(String name, String identity, String clazz)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>        <span class="hljs-built_in">this</span>.identity = identity;<br>        <span class="hljs-built_in">this</span>.clazz = clazz;<br>    &#125;<br><br>    <span class="hljs-comment">// 核心访问方法</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">accept</span><span class="hljs-params">(Visitor visitor)</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 学生</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">User</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">(String name, String identity, String clazz)</span> &#123;<br>        <span class="hljs-built_in">super</span>(name, identity, clazz);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">accept</span><span class="hljs-params">(Visitor visitor)</span> &#123;<br>        visitor.visit(<span class="hljs-built_in">this</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">ranking</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> (<span class="hljs-type">int</span>) (Math.random() * <span class="hljs-number">100</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">count</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">105</span> - <span class="hljs-keyword">new</span> <span class="hljs-title class_">Random</span>().nextInt(<span class="hljs-number">10</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 老师</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Teacher</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">User</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Teacher</span><span class="hljs-params">(String name, String identity, String clazz)</span> &#123;<br>        <span class="hljs-built_in">super</span>(name, identity, clazz);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">accept</span><span class="hljs-params">(Visitor visitor)</span> &#123;<br>        visitor.visit(<span class="hljs-built_in">this</span>);<br>    &#125;<br><br>    <span class="hljs-comment">// 升本率</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">double</span> <span class="hljs-title function_">entranceRatio</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> BigDecimal.valueOf(Math.random() * <span class="hljs-number">100</span>).setScale(<span class="hljs-number">2</span>, BigDecimal.ROUND_HALF_UP).doubleValue();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<p><strong>访问者接口</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 访问者接口</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Visitor</span> &#123;<br><br>    <span class="hljs-comment">// 访问学生信息</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">visit</span><span class="hljs-params">(Student student)</span>;<br><br>    <span class="hljs-comment">// 访问老师信息</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">visit</span><span class="hljs-params">(Teacher teacher)</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>



<p><strong>接口实现</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 家长</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Parent</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Visitor</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(Parent.class);<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">visit</span><span class="hljs-params">(Student student)</span> &#123;<br>        logger.info(<span class="hljs-string">&quot;学生信息 姓名：&#123;&#125; 班级：&#123;&#125; 排名：&#123;&#125;&quot;</span>, student.name, student.clazz, student.ranking());<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">visit</span><span class="hljs-params">(Teacher teacher)</span> &#123;<br>        logger.info(<span class="hljs-string">&quot;老师信息 姓名：&#123;&#125; 班级：&#123;&#125; 级别：&#123;&#125;&quot;</span>, teacher.name, teacher.clazz, teacher.identity);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 校长</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Principal</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Visitor</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(Principal.class);<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">visit</span><span class="hljs-params">(Student student)</span> &#123;<br>        logger.info(<span class="hljs-string">&quot;学生信息 班级：&#123;&#125; 人数：&#123;&#125;&quot;</span>, student.clazz, student.count());<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">visit</span><span class="hljs-params">(Teacher teacher)</span> &#123;<br>        logger.info(<span class="hljs-string">&quot;学生信息 姓名：&#123;&#125; 班级：&#123;&#125; 升学率：&#123;&#125;&quot;</span>, teacher.name, teacher.clazz, teacher.entranceRatio());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<p><strong>数据视图</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 数据看板</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DataView</span> &#123;<br><br>    List&lt;User&gt; userList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;User&gt;();<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">DataView</span><span class="hljs-params">()</span> &#123;<br>        userList.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>(<span class="hljs-string">&quot;谢飞机&quot;</span>, <span class="hljs-string">&quot;重点班&quot;</span>, <span class="hljs-string">&quot;一年一班&quot;</span>));<br>        userList.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>(<span class="hljs-string">&quot;windy&quot;</span>, <span class="hljs-string">&quot;重点班&quot;</span>, <span class="hljs-string">&quot;一年一班&quot;</span>));<br>        userList.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>(<span class="hljs-string">&quot;大毛&quot;</span>, <span class="hljs-string">&quot;普通班&quot;</span>, <span class="hljs-string">&quot;二年三班&quot;</span>));<br>        userList.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>(<span class="hljs-string">&quot;Shing&quot;</span>, <span class="hljs-string">&quot;普通班&quot;</span>, <span class="hljs-string">&quot;三年四班&quot;</span>));<br>        userList.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Teacher</span>(<span class="hljs-string">&quot;BK&quot;</span>, <span class="hljs-string">&quot;特级教师&quot;</span>, <span class="hljs-string">&quot;一年一班&quot;</span>));<br>        userList.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Teacher</span>(<span class="hljs-string">&quot;娜娜Goddess&quot;</span>, <span class="hljs-string">&quot;特级教师&quot;</span>, <span class="hljs-string">&quot;一年一班&quot;</span>));<br>        userList.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Teacher</span>(<span class="hljs-string">&quot;dangdang&quot;</span>, <span class="hljs-string">&quot;普通教师&quot;</span>, <span class="hljs-string">&quot;二年三班&quot;</span>));<br>        userList.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Teacher</span>(<span class="hljs-string">&quot;泽东&quot;</span>, <span class="hljs-string">&quot;实习教师&quot;</span>, <span class="hljs-string">&quot;三年四班&quot;</span>));<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">show</span><span class="hljs-params">(Visitor visitor)</span> &#123;<br>        <span class="hljs-keyword">for</span> (User user : userList) &#123;<br>            user.accept(visitor);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<p><strong>测试</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApiTest</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(ApiTest.class);<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test_show</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-type">DataView</span> <span class="hljs-variable">dataView</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataView</span>();<br><br>        logger.info(<span class="hljs-string">&quot;\r\n家长视角访问：&quot;</span>);<br>        dataView.show(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Parent</span>());<br><br>        logger.info(<span class="hljs-string">&quot;\r\n校长视角访问：&quot;</span>);<br>        dataView.show(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Principal</span>());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>


                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" class="category-chain-item">设计模式</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/Design-Pattern/" class="print-no-link">#Design Pattern</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Relearning Design Pattern</div>
      <div>https://www.renkelin.vip/2024/07/29/Relearning-design-patterns/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>Author</div>
          <div>Kolin</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Posted on</div>
          <div>July 29, 2024</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>Licensed under</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - Attribution">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2024/09/23/RS/" title="Recommender System">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Recommender System</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2024/03/24/Design-patterns/" title="Design Pattern">
                        <span class="hidden-mobile">Design Pattern</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://lib.baomitu.com/valine/1.5.1/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"VNSy36PGiQCPwyRb6AukmG4w-gzGzoHsz","appKey":"yzHhLZjFMNqrtHhPeHVoWzF2","path":"window.location.pathname","placeholder":null,"avatar":"retro","meta":["nick","mail","link"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","highlight":false,"recordIP":false,"serverURLs":"","emojiCDN":null,"emojiMaps":null,"enableQQ":false},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          var imgSelector = '#valine .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>Table of Contents</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">Keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="mailto:renkelin00@gmail.com?subject=Interested+In+Your+Blog" target="_blank" rel="nofollow noopener"><span>Contact me</span></a> <i class="iconfont icon-love"></i> <a href="mailto:renkelin00@gmail.com?subject=Interested+In+Your+Blog" target="_blank" rel="nofollow noopener"><span>renkelin00@gmail.com</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        总访问量 
        <span id="busuanzi_value_site_pv"></span>
         次
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        总访客数 
        <span id="busuanzi_value_site_uv"></span>
         人
      </span>
    
    
  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">Blog works best with JavaScript enabled</div>
  </noscript>
</body>
</html>
